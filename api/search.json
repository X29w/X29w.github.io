[{"id":"6d1a44d72f500b2ae165cfd01771a531","title":"rollup","content":"rollupå‰ç«¯å·¥ç¨‹åŒ–å†ç¨‹\né™¤å±‘ä¼˜åŒ–(tree shaking)é™¤äº†å¯ä»¥ä½¿ç”¨ ES æ¨¡å—ä¹‹å¤–ï¼ŒRollup è¿˜å¯ä»¥é™æ€åˆ†æä½ å¯¼å…¥çš„ä»£ç ï¼Œå¹¶å°†æ’é™¤ä»»ä½•å®é™…ä¸Šæ²¡æœ‰ä½¿ç”¨çš„å†…å®¹ï¼Œä»ä¸Šé¢çš„å¼•å…¥å’Œæœ€åçš„æ‰“åŒ…ç»“æœå°±å¯ä»¥çœ‹åˆ°ï¼Œæ²¡æœ‰ä½¿ç”¨åˆ°çš„å†…å®¹ç›´æ¥è¢«åˆ é™¤äº†ã€‚\n\n\n\n\n\n\n\n\n\næ³¨æ„ï¼Œé™¤å±‘ä¼˜åŒ–çš„æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µé€šè¿‡é™æ€åˆ†æç¡®å®šä»£ç çš„ä½¿ç”¨æƒ…å†µï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶ã€‚\næ‰€ä»¥é™¤å±‘ä¼˜åŒ–ä¸€èˆ¬æ˜¯å»ºç«‹åœ¨ES6 æ¨¡å—åŒ–è¯­æ³•åŸºç¡€ä¹‹ä¸Šçš„ï¼ŒESM çš„å¯¼å…¥å¯¼å‡ºæ˜¯é™æ€çš„ã€‚\nCommonJS æ¨¡å—çš„å¯¼å…¥å’Œå¯¼å‡ºæ˜¯åŠ¨æ€çš„ï¼Œæ— æ³•åœ¨ç¼–è¯‘é˜¶æ®µé™æ€ç¡®å®šä»£ç çš„ä½¿ç”¨æƒ…å†µã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé™¤å±‘ä¼˜åŒ–å·¥å…·æ— æ³•åœ¨ CommonJS æ¨¡å—ä¸­è¿›è¡Œç²¾ç¡®çš„é™¤å±‘ï¼Œå› ä¸ºæ— æ³•é™æ€åˆ†ææ¨¡å—é—´çš„å¯¼å…¥å’Œå¯¼å‡ºå…³ç³»ã€‚\nç„¶è€Œï¼Œä¸€äº›æ„å»ºå·¥å…·ï¼ˆå¦‚ Webpackï¼‰ä¼šå°è¯•é€šè¿‡é™æ€åˆ†æå’Œå¯å‘å¼æ–¹æ³•å¯¹ CommonJS æ¨¡å—è¿›è¡Œè¿‘ä¼¼çš„é™¤å±‘ä¼˜åŒ–ã€‚å®ƒä»¬ä¼šå°½å¯èƒ½åœ°è¯†åˆ«å‡ºé‚£äº›å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µç¡®å®šæœªè¢«ä½¿ç”¨çš„ä»£ç ï¼Œå¹¶è¿›è¡Œå‰”é™¤ã€‚ä½†è¿™ç§å¤„ç†æ–¹å¼å¯èƒ½ä¸å¦‚å¯¹ ES6 æ¨¡å—çš„ä¼˜åŒ–æ•ˆæœå¥½ï¼Œä¸”æœ‰ä¸€å®šçš„é™åˆ¶ã€‚\né™¤å±‘ä¼˜åŒ–çš„åŸç†ï¼š\n\né™æ€åˆ†æï¼šå¯¹ JavaScript ä»£ç è¿›è¡Œé™æ€åˆ†æï¼Œè¯†åˆ«å‡ºæ¨¡å—çš„å¯¼å…¥å’Œå¯¼å‡ºå…³ç³»ã€‚\næ ‡è®°æœªä½¿ç”¨ä»£ç ï¼šæ ‡è®°å‡ºåœ¨å¯¼å…¥å’Œå¯¼å‡ºå…³ç³»ä¸Šæ²¡æœ‰è¢«ä½¿ç”¨çš„ä»£ç ã€‚è¿™äº›ä»£ç å¯èƒ½æ˜¯æ¨¡å—çš„å¯¼å‡ºå‡½æ•°ã€å˜é‡ã€ç±»ç­‰ã€‚\nå‰”é™¤æœªä½¿ç”¨ä»£ç ï¼šæ ¹æ®æ ‡è®°ç»“æœï¼Œæ„å»ºå·¥å…·ä¼šå°†æœªè¢«ä½¿ç”¨çš„ä»£ç ä»æœ€ç»ˆçš„æ‰“åŒ…ç»“æœä¸­å‰”é™¤ï¼Œåªä¿ç•™è¢«ä½¿ç”¨çš„éƒ¨åˆ†ã€‚\n\nç”±äºæ˜¯é™æ€åˆ†æï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„è‡ªå·±çš„å†™æ³•ï¼Œç®€å•æ¥è¯´ï¼Œå°½é‡çš„ä½¿ç”¨æœ€å°å¯¼å…¥ï¼Œæ¯”å¦‚ä½ å¯ä»¥æ¯”è¾ƒä¸€ä¸‹æˆ‘ä»¬è¿™é‡Œå¯¼å…¥ä»£ç ä¹‹åï¼Œæ‰“åŒ…çš„åŒºåˆ«ï¼š\n&#x2F;&#x2F; ç›´æ¥é»˜è®¤å¯¼å…¥æ•´ä¸ªå¯¹è±¡\nimport util from &quot;.&#x2F;util.js&quot;;\nconst r &#x3D; util.getRandomNum(1, 10)\nconsole.log(r)\nâ€‹\n&#x2F;&#x2F; å…·åå¯¼å…¥å…·ä½“çš„å‡½æ•°\nimport &#123; getRandomNum &#125; from &quot;.&#x2F;util.js&quot;;\nconst r &#x3D; getRandomNum(1, 10)\nconsole.log(r)\n\nä¸ webpack æ‰“åŒ…çš„åŒºåˆ«è¿™ä¸ªæ‰“åŒ…ç»“æœå…¶å®å°±å·²ç»å’Œæˆ‘ä»¬ç†ŸçŸ¥çš„webpackæœ‰äº†å¾ˆé²œæ˜çš„åŒºåˆ«ï¼Œæˆ‘ä»¬æŠŠ webpack å®‰è£…ä¸€ä¸‹è¯•è¯•\ncsharp ä»£ç è§£è¯»å¤åˆ¶ä»£ç pnpm add webpack webpack-cli -D\n\nè¿è¡Œ webpack-cliï¼š\ncss ä»£ç è§£è¯»å¤åˆ¶ä»£ç # --entry å…¥å£æ–‡ä»¶ -o æ‰“åŒ…æ–‡ä»¶å¤¹ä½ç½® --mode æ‰“åŒ…æ¨¡å¼\nnpx webpack --entry .&#x2F;src&#x2F;index.js -o dist --mode development\n\nå½“ç„¶æˆ‘ä»¬å¯ä»¥é€‰æ‹©ç”Ÿæˆæ¨¡å¼è¿›è¡Œæ‰“åŒ…\ncss ä»£ç è§£è¯»å¤åˆ¶ä»£ç npx webpack --entry .&#x2F;src&#x2F;index.js -o dist --mode production\n\n(() &#x3D;&gt; &#123;\n  &quot;use strict&quot;;\n  const o &#x3D;\n    ((t &#x3D; 1),\n    (a &#x3D; 10),\n    (t &#x3D; Math.ceil(t)),\n    (a &#x3D; Math.floor(a)),\n    Math.floor(Math.random() * (a - t + 1)) + t);\n  var t, a;\n  console.log(o);\n&#125;)();\n\nç°åœ¨æ‰“åŒ…å‡ºæ¥çš„å†…å®¹å°±ç›´æ¥æ˜¯å‹ç¼©ä¹‹åçš„ä»£ç äº†\né…ç½®æ–‡ä»¶Rollupé…ç½®æ–‡ä»¶æ˜¯ä¸€ä¸ª ES æ¨¡å—ã€‚é€šå¸¸ï¼Œå®ƒè¢«ç§°ä¸º rollup.config.js æˆ– rollup.config.mjsï¼Œå¹¶ä½äºé¡¹ç›®çš„æ ¹ç›®å½•ä¸­ã€‚å®ƒå¯¼å‡ºä¸€ä¸ªé»˜è®¤å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æ‰€éœ€çš„é€‰é¡¹ï¼š\ncss ä»£ç è§£è¯»å¤åˆ¶ä»£ç export default &#123;\n\tinput: &#39;src&#x2F;index.js&#39;,\n\toutput: &#123;\n\t\tfile: &#39;dist&#x2F;bundle.js&#39;,\n\t\tformat: &#39;esm&#39;\n\t&#125;\n&#125;;\n\n\n\n\n\n\n\n\n\n\næ³¨æ„ï¼šnodejs ç¯å¢ƒä¸‹è¦è¿è¡Œ esm æ¨¡å—åŒ–çš„å†…å®¹ï¼Œè¦ä¹ˆæ–‡ä»¶ååç¼€å¤„ç†ä¸º .mjsï¼Œè¦ä¹ˆ package.json æ–‡ä»¶ä¸­é…ç½® â€œtypeâ€:â€moduleâ€ ï¼Œå› ä¸º Rollup å°†éµå¾ª Node ESM è¯­ä¹‰ã€‚\nå¸¸ç”¨é…ç½®å¤šäº§ç‰©é…ç½®æˆ‘ä»¬å¯ä»¥å°† output æ”¹é€ æˆä¸€ä¸ªæ•°ç»„ï¼Œå¯¹å¤–æš´éœ²å‡ºä¸åŒæ ¼å¼çš„äº§ç‰©ä¾›ä»–äººä½¿ç”¨ï¼Œä¸ä»…åŒ…æ‹¬ ESMï¼Œä¹Ÿéœ€è¦åŒ…æ‹¬è¯¸å¦‚CommonJSã€UMDç­‰æ ¼å¼ï¼Œä¿è¯è‰¯å¥½çš„å…¼å®¹æ€§\nphp ä»£ç è§£è¯»å¤åˆ¶ä»£ç import &#123; defineConfig &#125; from &#39;rollup&#39;\n\nexport default defineConfig(&#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: [\n    &#123;\n      file: &#39;dist&#x2F;bundle-iife.js&#39;,\n      format: &#39;iife&#39;\n    &#125;,\n    &#123;\n      file: &#39;dist&#x2F;bundle-esm.js&#39;,\n      format: &#39;esm&#39;\n    &#125;,\n    &#123;\n      file: &#39;dist&#x2F;bundle-cjs.js&#39;,\n      format: &#39;cjs&#39;\n    &#125;,\n    &#123;\n      file: &#39;dist&#x2F;bundle-umd.js&#39;,\n      format: &#39;umd&#39;,\n      name: &#39;bundle&#39;\n    &#125;\n  ],\n&#125;)\n\nå¤šå…¥å£é…ç½®é™¤äº†å¤šäº§ç‰©é…ç½®ï¼ŒRollup ä¸­ä¹Ÿæ”¯æŒå¤šå…¥å£é…ç½®\nmain.js\n&#x2F;&#x2F; src&#x2F;main.js\nimport util from &quot;.&#x2F;util.js&quot;;\nconst r &#x3D; util.getRandomNum(1, 10);\nconsole.log(&quot;ğŸš€ ~ r:&quot;, r);\n\nconst obj &#x3D; &#123;\n  a: 1,\n  b: &#123;\n    c: 3,\n  &#125;,\n&#125;;\nconst cloneObj &#x3D; util.deepClone(obj);\ncloneObj.b.c &#x3D; 4;\nconsole.log(&quot;ğŸš€ ~ obj:&quot;, obj);\nconsole.log(&quot;ğŸš€ ~ cloneObj:&quot;, cloneObj);\n\nrollup.config.js\nphp ä»£ç è§£è¯»å¤åˆ¶ä»£ç import &#123; defineConfig &#125; from &#39;rollup&#39;\n\nexport default defineConfig(&#123;\n  input: [&#39;src&#x2F;index.js&#39;,&#39;src&#x2F;main.js&#39;],\n  output: [\n    &#123;\n      dir: &#39;dist&#39;,\n      format: &#39;cjs&#39;\n    &#125;\n  ],\n&#125;)\n\né€šå¸¸æƒ…å†µä¸‹å¤šäº§ç‰©å’Œå¤šå…¥å£ä¸¤è€…ä¼šè¢«ç»“åˆèµ·æ¥ä½¿ç”¨\nphp ä»£ç è§£è¯»å¤åˆ¶ä»£ç import &#123; defineConfig &#125; from &#39;rollup&#39;\nexport default defineConfig(&#123;\n  input: [&#39;src&#x2F;index.js&#39;,&#39;src&#x2F;main.js&#39;],\n  output: [\n    &#123;\n      dir: &#39;cjs&#39;,\n      format: &#39;cjs&#39;\n    &#125;,\n    &#123;\n      dir: &#39;esm&#39;,\n      format: &#39;esm&#39;\n    &#125;\n  ],\n&#125;)\n\nå½“ç„¶ï¼Œä¸Šé¢è¿™æ ·çš„å†™çš„è¯ï¼Œç”Ÿæˆçš„äº§ç‰©ä¼šæŠŠä¸¤ä¸ªå…¥å£ä¸€èµ·è¿›è¡Œæ„å»ºï¼Œæˆ‘ä»¬å¯èƒ½çš„æƒ³æ³•æ˜¯ä¸€ä¸ªå…¥å£ä¸€ç§æ„å»ºæ–¹å¼ï¼š\npython ä»£ç è§£è¯»å¤åˆ¶ä»£ç import &#123; defineConfig &#125; from &#39;rollup&#39;\n&#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildIndexOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;umd&#x2F;&#39;,\n    format: &#39;umd&#39;,\n    name: &#39;bundle&#39;\n  &#125;\n&#125;\n\n&#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildMainOptions &#x3D; &#123;\n  input: &#39;src&#x2F;main.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    format: &#39;esm&#39;,\n  &#125;\n&#125;\nexport default [buildIndexOptions, buildMainOptions];\n\nåŠ¨æ€å¯¼å…¥ä¸é»˜è®¤ä»£ç åˆ†å‰²ä½¿ç”¨è·¯ç”±æ¥è¯´æ˜æ‡’åŠ è½½æ˜¯å¤§å®¶å–œé—»ä¹è§çš„æ–¹å¼ï¼Œä¼°è®¡å¤§å¤šæ•°åŒå­¦å¯¹äºæ‡’åŠ è½½éƒ½åªæ˜¯åœç•™åœ¨è·¯ç”±çš„æ‡’åŠ è½½ï¼Œå…¶å®ï¼Œä»»ä½•æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä½¿ç”¨ import åŠ¨æ€æ‡’åŠ è½½çš„æ–¹å¼ã€‚é‡æ–°ç¼–è¾‘ä¸€ä¸‹ main.js å…¥å£ï¼š\n&#x2F;&#x2F; src&#x2F;main.js\nfunction run() &#123;\n  &#x2F;&#x2F; å¦‚æœä¸æ¸…æ¥šimportåŠ¨æ€å¯¼å…¥è¿”å›çš„æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å…ˆæ‰“å°ä¸€ä¸‹ä¸‹é¢ç»“æœ\n  &#x2F;&#x2F; import(&quot;.&#x2F;util.js&quot;).then(chunk &#x3D;&gt; console.log(&quot;ğŸš€ ~ chunk:&quot;, chunk));\n\n  import(&quot;.&#x2F;util.js&quot;).then((&#123; default: foo &#125;) &#x3D;&gt; &#123;\n    const r &#x3D; foo.getRandomNum(1, 10);\n    console.log(&quot;ğŸš€ ~ r:&quot;, r);\n  &#125;);\n&#125;\nrun();\n\né‡æ–°è¿è¡Œå¯ä»¥çœ‹åˆ° dist ç›®å½•å½¢æˆäº†ä¸‹é¢çš„ç»“æ„:\nerlang ä»£ç è§£è¯»å¤åˆ¶ä»£ç .\nâ”œâ”€â”€ dist\nâ”‚ â”œâ”€â”€ esm\nâ”‚ â”‚ â”œâ”€â”€ main.js\nâ”‚ â”‚ â””â”€â”€ util-371e3ef9.js\nâ”‚ â””â”€â”€ umd\nâ”‚     â””â”€â”€ index.js\nâ””â”€â”€ ...\n\nRollup å°†ä½¿ç”¨åŠ¨æ€å¯¼å…¥åˆ›å»ºä¸€ä¸ªä»…åœ¨éœ€è¦æ—¶åŠ è½½çš„å•ç‹¬å—ã€‚æ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°è¿™é‡Œå¤šäº†ä¸€ä¸ªutil-371e3ef9.jsçš„æ–‡ä»¶\n\n\n\n\n\n\n\n\n\næ³¨æ„ï¼š ä¸ºäº†è®© Rollup çŸ¥é“åœ¨å“ªé‡Œæ”¾ç½®ç¬¬äºŒä¸ªå—ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨ --file é€‰é¡¹ï¼Œè€Œæ˜¯ä½¿ç”¨ --dir é€‰é¡¹è®¾ç½®ä¸€ä¸ªè¾“å‡ºæ–‡ä»¶å¤¹\nå…¶ä¸­ï¼Œutil-371e3ef9.jsæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„chunk-[hash].jsçš„åå­—ï¼Œ[hash] æ˜¯åŸºäºå†…å®¹çš„å“ˆå¸Œå­—ç¬¦ä¸²ã€‚ä½ å¯ä»¥é€šè¿‡æŒ‡å®š output.chunkFileNames (chunk æ–‡ä»¶)å’Œ output.entryFileNames (æ‰“åŒ…å…¥å£æ–‡ä»¶)é€‰é¡¹æ¥æä¾›è‡ªå·±çš„å‘½åæ¨¡å¼ã€‚\npython ä»£ç è§£è¯»å¤åˆ¶ä»£ç &#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildMainOptions &#x3D; &#123;\n  input: &#39;src&#x2F;main.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    entryFileNames: &#39;[name].js&#39;,\n    chunkFileNames: &#39;chunk-[name]-[hash].js&#39;,\n    format: &#39;esm&#39;,\n  &#125;\n&#125;\n\nè€Œä¸”ï¼Œå¾ˆæ™ºèƒ½çš„æ˜¯ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘å®šä¹‰äº†åˆå¤šä¸ªå…¥å£ç‚¹éƒ½è°ƒç”¨äº†util.jsæ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨çš„å¼•å…¥åˆ†å‰²å‡ºæ¥çš„æ–‡ä»¶\npython ä»£ç è§£è¯»å¤åˆ¶ä»£ç &#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildMainOptions &#x3D; &#123;\n  input: [&#39;src&#x2F;main.js&#39;, &#39;src&#x2F;main2.js&#39;],\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    entryFileNames: &#39;[name].js&#39;,\n    chunkFileNames: &#39;chunk-[name]-[hash].js&#39;,\n    format: &#39;esm&#39;,\n  &#125;\n&#125;\n\nåœ¨æ‰“åŒ…åçš„ main2.js ä¸­ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ ·çš„å¼•ç”¨ï¼š\nimport util from &quot;.&#x2F;chunk-util-371e3ef9.js&quot;;\n\nä½¿ç”¨æ’ä»¶åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ç”¨å…¥å£æ–‡ä»¶å’Œé€šè¿‡ç›¸å¯¹è·¯å¾„å¯¼å…¥çš„æ¨¡å—æ‰“äº†ä¸€ä¸ªç®€å•çš„åŒ…ã€‚éšç€ä½ éœ€è¦æ‰“åŒ…æ›´å¤æ‚çš„ä»£ç ï¼Œé€šå¸¸éœ€è¦æ›´çµæ´»çš„é…ç½®ï¼Œä¾‹å¦‚å¯¼å…¥ä½¿ç”¨ NPM å®‰è£…çš„æ¨¡å—ã€ä½¿ç”¨ Babel ç¼–è¯‘ä»£ç ã€å¤„ç† JSON æ–‡ä»¶ç­‰ç­‰ã€‚\næ’ä»¶åˆ—è¡¨ ï¼š the Rollup Awesome Listã€‚\n@rollup&#x2F;plugin-node-resolveæ¯”å¦‚æˆ‘ä»¬ç°åœ¨å¼•å…¥ lodash-es åº“\ncsharp ä»£ç è§£è¯»å¤åˆ¶ä»£ç pnpm add lodash-es -D\n\nåœ¨ index.js ä¸­ä½¿ç”¨\nimport &#123; chunk &#125; from &quot;lodash-es&quot;;\nconst r &#x3D; chunk([1, 2, 3, 4], 2);\nconsole.log(&quot;ğŸš€ ~ r:&quot;, r);\n\nç°åœ¨ç›´æ¥æ‰“åŒ…\npython ä»£ç è§£è¯»å¤åˆ¶ä»£ç &#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildIndexOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    format: &#39;esm&#39;,\n  &#125;\n&#125;\nexport default buildIndexOptions\n\nä¼šå‡ºç°ä¸‹é¢çš„è­¦å‘Šï¼š\nbash ä»£ç è§£è¯»å¤åˆ¶ä»£ç src&#x2F;index.js â†’ dist&#x2F;esm&#x2F;...\n(!) Unresolved dependencies\nhttps:&#x2F;&#x2F;rollupjs.org&#x2F;troubleshooting&#x2F;#warning-treating-module-as-external-dependency\nlodash-es (imported by &quot;src&#x2F;index.js&quot;)\ncreated dist&#x2F;esm&#x2F; in 13ms\n\næ„æ€æ˜¯ï¼Œä¸èƒ½è§£ælodash-esè¿™ä¸ªä¾èµ–ï¼ŒæŠ¥å‡ºäº†è­¦å‘Šï¼Œé—®ä½ æ˜¯ä¸æ˜¯éœ€è¦externalï¼Œå¹¶æç¤ºä½ ç‚¹å‡»é“¾æ¥æœ‰è¿™ä¸ªè­¦å‘Šçš„è§£é‡Šã€‚å½“æˆ‘ä»¬ç‚¹å‡»è¿™ä¸ªé“¾æ¥ï¼ŒæŒ‰ç…§æç¤ºè§£å†³è¿™ä¸ª external è­¦å‘Šé—®é¢˜ï¼Œå¾ˆç®€å•ï¼Œå°±åŠ ä¸Š externalï¼Œä¹Ÿå°±æ˜¯æŠŠlodash-esè¿™ä¸ªåº“ç»™æ’é™¤å‡ºå»\ncss ä»£ç è§£è¯»å¤åˆ¶ä»£ç const buildIndexOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    format: &#39;esm&#39;,\n  &#125;,\n+  external: [&#39;lodash-es&#39;]\n&#125;\nexport default buildIndexOptions\n\nå†æ­¤æ‰“åŒ…ï¼Œæœç„¶æ²¡è­¦å‘Šäº†ï¼Œè€Œä¸”æˆ‘ä»¬åœ¨ nodejs ç¯å¢ƒä¸­ç¡®å®ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œäº†\n\n\n\n\n\n\n\n\n\næ³¨æ„ï¼šå¯¹äºæ²¡æœ‰å¤ªå¤šå¼€å‘ç»éªŒçš„åŒå­¦æ¥è¯´ï¼Œè¿™é‡Œæ„Ÿè§‰é—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯éœ€è¦ç†è§£ä¸ºä»€ä¹ˆ\næ³¨æ„ï¼šå¯¹äºæ²¡æœ‰å¤ªå¤šå¼€å‘ç»éªŒçš„åŒå­¦æ¥è¯´ï¼Œè¿™é‡Œæ„Ÿè§‰é—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯éœ€è¦ç†è§£ä¸ºä»€ä¹ˆ\næ³¨æ„ï¼šå¯¹äºæ²¡æœ‰å¤ªå¤šå¼€å‘ç»éªŒçš„åŒå­¦æ¥è¯´ï¼Œè¿™é‡Œæ„Ÿè§‰é—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯éœ€è¦ç†è§£ä¸ºä»€ä¹ˆ\né‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼Œè¿™é‡Œè™½ç„¶çœ‹ä¼¼ä¸€ä¸ªå¾ˆå°çš„é—®é¢˜ï¼Œä½†æ˜¯å´æœ‰å¾ˆå¤šåŸºæœ¬ç†è®ºç‚¹\n1ã€rollup é»˜è®¤åªèƒ½è§£æå¯¼å…¥çš„ç›¸å¯¹è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯/ ï¼Œ ./æˆ–è€…../å¼€å¤´çš„è·¯å¾„ï¼Œå¯¹äºbare importï¼Œä¹Ÿå°±æ˜¯import &#123; chunk &#125; from &#39;lodash-es&#39;;è¿™ç§ç›´æ¥å¯¼å…¥çš„ç¬¬ä¸‰æ–¹åŒ…çš„æ ¼å¼ï¼Œå¹¶ä¸æ”¯æŒ\n2ã€rollupç›¸æ¯”webpackæœ€å¤§çš„ä¼˜åŠ¿å¹¶ä¸æ˜¯æ„å»ºä¸€ä¸ªè¶³å¤Ÿå¤§çš„åº”ç”¨æ‰“åŒ…ï¼Œå¤§å¤šæ˜¯æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨rollupç”¨æ¥æ„å»ºå·¥å…·åº“ï¼Œå› æ­¤ï¼Œè¿™é‡Œå¯¼å…¥çš„lodash-eså¹¶æ²¡æœ‰æŠ¥é”™ï¼Œè€Œä»…ä»…æŠ¥å‡ºè­¦å‘Šï¼Œå› ä¸ºrollupè®¤ä¸ºlodash-esè¿™ä¸ªåº“å¹¶æ²¡æœ‰åŠ å…¥æ„å»ºï¼Œé‚£ä¹ˆä½ çš„æ„æ€æ˜¯å°†æ¥ç”¨ä½œç¬¬ä¸‰æ–¹åº“æ¥ä½¿ç”¨ï¼Œå› æ­¤å°†lodash-esä½¿ç”¨é…ç½®externalæ’é™¤æ‰å°±å¥½ã€‚\n3ã€lodash-esè¿™ä¸ªåŒ…æœ¬èº«å°±æ˜¯æ”¯æŒ ESM çš„\n4ã€æœ€åæ‰“åŒ…å¥½çš„index.jsæ–‡ä»¶åªæ‰€ä»¥åœ¨nodejsç¯å¢ƒä¸‹è¿è¡Œï¼Œæ˜¯å› ä¸ºnodejså¯ä»¥å¸®æˆ‘ä»¬è§£æbare importï¼Œæˆ‘ä»¬å¯ä»¥è¯•ç€å°†index.jsæ”¾å…¥åˆ°htmlæ–‡ä»¶ä¸­è¿è¡Œï¼Œä½ å°±å¯ä»¥çœ‹åˆ°å…¶ä¸­çš„é—®é¢˜æ‰€åœ¨ï¼Œåœ¨ html ç¯å¢ƒä¸­å°±ä¼šæŠ¥é”™äº†ï¼šindex.html:1 Uncaught TypeError: Failed to resolve module specifier &quot;lodash-es&quot;. Relative references must start with either &quot;/&quot;, &quot;./&quot;, or &quot;../&quot;.\nå¦‚æœå¸Œæœ›åœ¨æœ€åçš„æ‰“åŒ…ä¸­ï¼Œå°†lodash-eså†…å®¹è§£ææ‰“åŒ…è¿›å»ï¼Œå°±å¯ä»¥ä½¿ç”¨@rollup/plugin-node-resolve\nå®‰è£…:\nsql ä»£ç è§£è¯»å¤åˆ¶ä»£ç pnpm add @rollup&#x2F;plugin-node-resolve --save-dev\n\nä½¿ç”¨ï¼š\npython ä»£ç è§£è¯»å¤åˆ¶ä»£ç import &#123; nodeResolve &#125; from &#39;@rollup&#x2F;plugin-node-resolve&#39;;\n&#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildIndexOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    format: &#39;esm&#39;,\n  &#125;,\n  plugins: [nodeResolve()]\n  &#x2F;&#x2F; external: [&#39;lodash-es&#39;]\n&#125;\nexport default buildIndexOptions\n\nç°åœ¨ï¼Œå†æ­¤è¿›è¡Œæ‰“åŒ…ï¼Œæ— è®ºæ˜¯æ‰“åŒ…æ—¶é—´ï¼Œè¿˜æ˜¯æ‰“åŒ…å†…å®¹å’Œä¹‹å‰éƒ½å¾ˆä¸ä¸€æ ·äº†ï¼ŒæŠŠlodash-esä¸­ï¼Œå…³äºchunk()å‡½æ•°çš„å†…å®¹ï¼Œéƒ½æ‰“åŒ…è¿›äº†index.jsæ–‡ä»¶ä¸­\noutput.manualChunksä¸Šé¢è®²äº†å¯¹äºåŠ¨æ€åŠ è½½æ¨¡å—ï¼Œrollup å¸®æˆ‘ä»¬è‡ªåŠ¨åšäº†ä»£ç åˆ†å‰²ï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨çš„æ“ä½œï¼Œç›´æ¥åœ¨ rollup é…ç½®ä¸­å£°æ˜\nless ä»£ç è§£è¯»å¤åˆ¶ä»£ç const buildIndexOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    format: &#39;esm&#39;,\n    entryFileNames: &#39;[name].js&#39;,\n    chunkFileNames: &#39;chunk-[name]-[hash].js&#39;,\n    manualChunks: &#123;\n      &#39;lodash-es&#39;: [&#39;lodash-es&#39;],\n    &#125;\n    &#x2F;&#x2F;ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°å½¢å¼\n    &#x2F;&#x2F; manualChunks(id)&#123;\n    &#x2F;&#x2F;   if(id.includes(&#39;lodash-es&#39;))&#123;\n    &#x2F;&#x2F;     return &#39;lodash-es&#39;\n    &#x2F;&#x2F;   &#125;\n    &#x2F;&#x2F; &#125;\n\t&#125;,\n  plugins: [nodeResolve()]\n&#125;\n\n@rollup&#x2F;plugin-commonjsä¸Šé¢æœ€å¼€å§‹å¯¼å…¥lodash-esï¼Œæ²¡æœ‰åŠ å…¥externalå’Œpluginsï¼Œä¹‹æ‰€ä»¥è¿˜èƒ½ç›´æ¥è¿è¡Œï¼Œè¿˜å› ä¸ºlodash-esæœ¬èº«å°±æ˜¯æ”¯æŒ ESM çš„ï¼Œå› ä¸º rollup é»˜è®¤å¹¶ä¸æ”¯æŒ Commonjs æ¨¡å—åŒ–ï¼Œæ¯”å¦‚å°† lodash-es æ¢ä½ lodashï¼Œé©¬ä¸Šå°±èƒ½çœ‹åˆ°ä¸ä¸€æ ·çš„æ•ˆæœ,ç›´æ¥æ‰“åŒ…å¤±è´¥\nvbnet ä»£ç è§£è¯»å¤åˆ¶ä»£ç [!] RollupError: &quot;chunk&quot; is not exported by &quot;node_modules&#x2F;.pnpm&#x2F;lodash@4.17.21&#x2F;node_modules&#x2F;lodash&#x2F;lodash.js&quot;, imported by &quot;src&#x2F;index.js&quot;.\nhttps:&#x2F;&#x2F;rollupjs.org&#x2F;troubleshooting&#x2F;#error-name-is-not-exported-by-module\n\nè¿™ä¸ªé”™è¯¯åœ¨å®˜ç½‘ä¸Šè§£é‡Šçš„å¾ˆæ¸…æ¥šäº†ï¼Œæ— éå°±æ˜¯ commonjs æ²¡æœ‰è¿™ç§å¯¼å‡ºï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦@rollup/plugin-commonjså¸®æˆ‘ä»¬å¤„ç† commonjs æ¨¡å—åŒ–çš„é—®é¢˜\nå®‰è£…:\nsql ä»£ç è§£è¯»å¤åˆ¶ä»£ç pnpm add @rollup&#x2F;plugin-commonjs --save-dev\n\nä½¿ç”¨:\npython ä»£ç è§£è¯»å¤åˆ¶ä»£ç import &#123; nodeResolve &#125; from &#39;@rollup&#x2F;plugin-node-resolve&#39;;\n+import commonjs from &#39;@rollup&#x2F;plugin-commonjs&#39;;\n&#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildIndexOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    format: &#39;esm&#39;,\n  &#125;,\n+  plugins: [nodeResolve(), commonjs()]\n&#125;\nexport default buildIndexOptions\n\n@rollup&#x2F;plugin-babelä½¿ç”¨ Babel æ¥ä½¿ç”¨å°šæœªè¢«æµè§ˆå™¨å’Œ Node.js æ”¯æŒçš„æœ€æ–° JavaScript ç‰¹æ€§ã€‚\nä½¿ç”¨ Babel å’Œ Rollup æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ @rollup&#x2F;plugin-babel\nå®‰è£…:\nsql ä»£ç è§£è¯»å¤åˆ¶ä»£ç pnpm add @rollup&#x2F;plugin-babel -D\n\nä½¿ç”¨ï¼š\ncss ä»£ç è§£è¯»å¤åˆ¶ä»£ç import &#123; nodeResolve &#125; from &#39;@rollup&#x2F;plugin-node-resolve&#39;;\nimport commonjs from &#39;@rollup&#x2F;plugin-commonjs&#39;;\n+import babel from &#39;@rollup&#x2F;plugin-babel&#39;;\n&#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildIndexOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    format: &#39;esm&#39;,\n  &#125;,\n  plugins: [\n    nodeResolve(),\n    commonjs(),\n+    babel(&#123; babelHelpers: &#39;bundled&#39; &#125;)\n  ]\n&#125;\nexport default buildIndexOptions\n\nä¸è¿‡è¿™ä¹ˆåšä¹‹åï¼Œæ‰“åŒ…ä»£ç å¹¶ä¸ä¼šæœ‰ä»€ä¹ˆå˜åŒ–ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½çŸ¥é“ babel æ˜¯éœ€è¦é¢„è®¾çš„.\nå®‰è£… babel-core å’Œ env é¢„è®¾\nsql ä»£ç è§£è¯»å¤åˆ¶ä»£ç pnpm add -D @babel&#x2F;core @babel&#x2F;preset-env\n\nåœ¨ Babel å®é™…ç¼–è¯‘ä»£ç ä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œé…ç½®ã€‚åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªåä¸º .babelrc.json çš„æ–°æ–‡ä»¶\nperl ä»£ç è§£è¯»å¤åˆ¶ä»£ç &#123;\n  &quot;presets&quot;: [&quot;@babel&#x2F;preset-env&quot;]\n&#125;\n\nå…·ä½“çš„ babel è®¾ç½®ï¼Œå¯ä»¥å‚è€ƒbabel æ–‡æ¡£\né¢˜å¤–è¯ï¼š@babel&#x2F;runtimeæˆ‘ä»¬åœ¨index.jsä»£ç ä¸­åŠ å…¥å¦‚ä¸‹çš„ api\nimport &#123; getRandomNum &#125; from &quot;.&#x2F;util.js&quot;;\nconst r &#x3D; getRandomNum(1, 10);\nconsole.log(r);\n\nconst arr &#x3D; [1, 2, 3, 4].map((item) &#x3D;&gt; item * item);\nconsole.log(&quot;ğŸš€ ~ arr:&quot;, arr);\n\nPromise.resolve(1).then((res) &#x3D;&gt; &#123;\n  console.log(res);\n&#125;);\n\næˆ‘ä»¬é€šè¿‡ babel å¤„ç†ä¹‹åä¼šå‘ç°ä¸€äº›é—®é¢˜ï¼š\n@babel&#x2F;preset-env åªè½¬æ¢äº†è¯­æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„ç®­å¤´å‡½æ•°ã€const ä¸€ç±»ï¼Œä½†æ˜¯å¯¹äºè¿›ä¸€æ­¥éœ€è¦è½¬æ¢å†…ç½®å¯¹è±¡ã€å®ä¾‹æ–¹æ³•ç­‰ç­‰ APIï¼Œå°±æ˜¾å¾—æ— èƒ½ä¸ºåŠ›äº†ï¼Œè¿™äº›ä»£ç éœ€è¦polyfill(å…¼å®¹æ€§å«ç‰‡) ã€‚æ‰€ä»¥è¿™ä¸ªæˆ‘éœ€è¦@babel/runtimeæ¥å¸®æˆ‘ä»¬å¤„ç†ã€‚\n@babel/runtimeæ˜¯ä¸€ä¸ªæ ¸å¿ƒï¼Œ ä¸€ç§å®ç°æ–¹å¼ï¼Œä½†æ˜¯åœ¨å®ç° polyfill å«ç‰‡çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå¾ˆå¤šé‡å¤çš„ä»£ç ï¼Œæ‰€ä»¥éœ€è¦@babel/plugin-transform-runtimeé˜²æ­¢æ±¡æŸ“å…¨å±€ï¼Œ æŠ½ç¦»å…¬å…±çš„ helper function , é˜²æ­¢å†—ä½™ï¼Œå½“ç„¶åœ¨å¤„ç† polyfill çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ core-js çš„è¾…åŠ©ï¼ŒåŸºäº babelï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@babel/runtime-corejs3\nå®‰è£…ï¼š\nsql ä»£ç è§£è¯»å¤åˆ¶ä»£ç pnpm add @babel&#x2F;plugin-transform-runtime -D\npnpm add @babel&#x2F;runtime @babel&#x2F;runtime-corejs3\n\nè¦ä½¿ç”¨@babel/plugin-transform-runtimeï¼Œ@rollup/plugin-babelçš„babelHelperå¤„ç†å¿…é¡»æ”¹ä¸º runtime\npython ä»£ç è§£è¯»å¤åˆ¶ä»£ç import &#123; nodeResolve &#125; from &#39;@rollup&#x2F;plugin-node-resolve&#39;;\nimport commonjs from &#39;@rollup&#x2F;plugin-commonjs&#39;;\nimport babel from &#39;@rollup&#x2F;plugin-babel&#39;;\nimport typescript from &#39;@rollup&#x2F;plugin-typescript&#39;;\n&#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildIndexOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    format: &#39;esm&#39;,\n  &#125;,\n  plugins: [\n    nodeResolve(),\n    commonjs(),\n    babel(&#123;\n      babelHelpers: &#39;runtime&#39;,\n      include: &#39;src&#x2F;**&#39;,\n      exclude: &#39;node_modules&#x2F;**&#39;,\n      extensions:[&#39;.js&#39;, &#39;.ts&#39;]\n    &#125;),\n    typescript(),\n  ]\n&#125;\nexport default buildIndexOptions\n\n.babelrc.jsonï¼š\nperl ä»£ç è§£è¯»å¤åˆ¶ä»£ç &#123;\n  &quot;presets&quot;: [\n    [\n      &quot;@babel&#x2F;preset-env&quot;,\n      &#123;\n        &quot;targets&quot;: &quot;&gt; 0.25%, not dead&quot;,\n        &quot;useBuiltIns&quot;: &quot;usage&quot;,\n        &quot;corejs&quot;: 3\n      &#125;\n    ]\n  ],\n  &quot;plugins&quot;: [\n    [\n      &quot;@babel&#x2F;plugin-transform-runtime&quot;,\n      &#123;\n        &quot;corejs&quot;: 3\n      &#125;\n    ]\n  ]\n&#125;\n\nè¿™ä¸ªæ—¶å€™ä½ å†è¿›è¡Œæ„å»ºï¼Œä¼šå‘ç°æ‰“åŒ…åçš„æ–‡ä»¶å¤šå‡ºäº†ä¸€å¤§å †ï¼Œè¿™å…¶å®å°±æ˜¯ polyfill ä¸­çš„ä»£ç ã€‚\n@rollup&#x2F;plugin-typescriptè¦ä½¿ç”¨ typescript å°±éœ€è¦ä¾èµ–è¿™ä¸ªæ’ä»¶ï¼Œå½“ç„¶è¿™ä¸ªæ’ä»¶æœ¬èº«è¿˜ä¾èµ–äº†typescriptå’Œtslibï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¼å…¥ 3 ä¸ªåŒ…\nsql ä»£ç è§£è¯»å¤åˆ¶ä»£ç pnpm add typescript tslib @rollup&#x2F;plugin-typescript -D\n\nutil.ts\ntypescript ä»£ç è§£è¯»å¤åˆ¶ä»£ç &#x2F;**\n * æ·±æ‹·è´\n * @param obj éœ€è¦æ·±æ‹·è´çš„å¯¹è±¡\n * @returns æ·±æ‹·è´å¯¹è±¡\n *&#x2F;\nexport const deepClone &#x3D; &lt;T&gt;(obj: T): T &#x3D;&gt; &#123;\n  if(typeof obj !&#x3D;&#x3D; &#39;object&#39; || obj &#x3D;&#x3D;&#x3D; null) &#123;\n    return obj\n  &#125;\n  const result:any &#x3D; Array.isArray(obj) ? [] : &#123;&#125;;\n  for(let key in obj) &#123;\n    if(obj.hasOwnProperty(key)) &#123;\n      result[key] &#x3D; deepClone(obj[key])\n    &#125;\n  &#125;\n  return result\n&#125;\n\nexport const getRandomNum &#x3D; (min: number, max: number): number &#x3D;&gt; &#123;\n  let num &#x3D; Math.floor(Math.random() * (min - max) + max);\n  return num;\n&#125;\n\nIndex.ts\nini ä»£ç è§£è¯»å¤åˆ¶ä»£ç import &#123; getRandomNum,deepClone &#125; from &#39;.&#x2F;util.ts&#39;;\nconst r &#x3D; getRandomNum(1, 10);\nconsole.log(r);\n\nconst obj &#x3D; &#123; a: 1, b: &#123; c: 3 &#125; &#125;;\nconst obj2 &#x3D; deepClone(obj);\nobj2.b.c &#x3D; 4;\n\nconsole.log(obj);\nconsole.log(obj2);\n\nå½“ç„¶ï¼Œé…ç½®æ–‡ä»¶æˆ‘ä»¬ä¹Ÿå®Œå…¨å¯ä»¥æ˜¯ ts çš„\nrollup.config.ts\ncss ä»£ç è§£è¯»å¤åˆ¶ä»£ç import &#123; RollupOptions &#125; from &quot;rollup&quot;\nimport &#123; nodeResolve &#125; from &#39;@rollup&#x2F;plugin-node-resolve&#39;;\nimport commonjs from &#39;@rollup&#x2F;plugin-commonjs&#39;;\nimport babel from &#39;@rollup&#x2F;plugin-babel&#39;;\nimport typescript from &#39;@rollup&#x2F;plugin-typescript&#39;;\n\nconst config: RollupOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.ts&#39;,\n  output: &#123;\n    file: &#39;dist&#x2F;umd&#x2F;index.js&#39;,\n    format: &#39;umd&#39;,\n    name: &#39;rollupDemo&#39;,\n  &#125;,\n  plugins: [\n    nodeResolve(),\n    commonjs(),\n    babel(&#123;\n      babelHelpers: &#39;runtime&#39;,\n      include: &#39;src&#x2F;**&#39;,\n      exclude: &#39;node_modules&#x2F;**&#39;,\n      extensions:[&#39;.js&#39;, &#39;.ts&#39;]\n    &#125;),\n    typescript(),\n  ],\n&#125;\nexport default config;\n\ntsconfig.json\njson ä»£ç è§£è¯»å¤åˆ¶ä»£ç &#123;\n  &quot;compilerOptions&quot;: &#123;\n    &quot;module&quot;: &quot;esnext&quot;,\n    &quot;target&quot;: &quot;es5&quot;,\n    &quot;lib&quot;: [&quot;esnext&quot;, &quot;dom&quot;, &quot;dom.iterable&quot;],\n    &quot;skipLibCheck&quot;: true,\n\n    &quot;moduleResolution&quot;: &quot;bundler&quot;,\n    &quot;noEmit&quot;: true,\n    &quot;allowImportingTsExtensions&quot;:true,\n    &quot;resolveJsonModule&quot;: true,\n    &quot;isolatedModules&quot;: true,\n  &#125;,\n  &quot;include&quot;: [&quot;src&#x2F;**&#x2F;*&quot;,&quot;rollup.config.ts&quot;],\n&#125;\n\n\n\n\n\n\n\n\n\n\næ³¨æ„ï¼š åˆ«å¿˜è®° tsconfig.json æ–‡ä»¶ä¸­éœ€è¦åŠ å…¥ rollup.config.ts é…ç½®æ–‡ä»¶,ä¸ç„¶è¦æŠ¥é”™\njson ä»£ç è§£è¯»å¤åˆ¶ä»£ç &#123;\n  &quot;compilerOptions&quot;: &#123;\n    ......\n  &#125;,\n+  &quot;include&quot;: [&quot;src&#x2F;**&#x2F;*&quot;,&quot;rollup.config.ts&quot;],\n&#125;\n\nè¿è¡Œï¼š\nlua ä»£ç è§£è¯»å¤åˆ¶ä»£ç npx rollup -c rollup.config.ts --configPlugin typescript\n\næ„å»º react åº”ç”¨node_modulesruby ä»£ç è§£è¯»å¤åˆ¶ä»£ç # react\npnpm add react react-dom\n\n# @types&#x2F;react\npnpm add @types&#x2F;react @types&#x2F;react-dom -D\n\n# reacté¢„è®¾\npnpm add @babel&#x2F;preset-react -D\n\n# rollup\npnpm add rollup -D\n\n# rollupå¸¸è§„æ’ä»¶\npnpm add @rollup&#x2F;plugin-node-resolve @rollup&#x2F;plugin-commonjs -D\n\n# typescriptç›¸å…³\npnpm add typescript tslib @rollup&#x2F;plugin-typescript -D\n\n# @rollup&#x2F;plugin-babelç›¸å…³\npnpm add @rollup&#x2F;plugin-babel @babel&#x2F;core @babel&#x2F;preset-env -D\n\n# @babel&#x2F;runtimeç›¸å…³\npnpm add @babel&#x2F;plugin-transform-runtime @babel&#x2F;runtime @babel&#x2F;runtime-corejs3 -D\n\n# htmlæ–‡ä»¶æ¨¡æ¿\npnpm add rollup-plugin-generate-html-template -D\n\n# æ›¿æ¢å­—ç¬¦ä¸²\npnpm add @rollup&#x2F;plugin-replace -D\n\n# å¼€å‘æœåŠ¡å™¨ä¸live server\npnpm add rollup-plugin-serve rollup-plugin-livereload -D\n\n# clearæ’ä»¶\npnpm add rollup-plugin-clear -D\n\n# scss\npnpm add rollup-plugin-scss sass -D\n\n# postcss\npnpm add postcss rollup-plugin-postcss -D\n\n# å›¾ç‰‡å¤„ç†\npnpm add @rollup&#x2F;plugin-image -D\n\n# nodejs typescriptç±»å‹\npnpm add @types&#x2F;node -D\n\n# åˆ«åæ’ä»¶\npnpm add @rollup&#x2F;plugin-alias -D\n\n# terser\npnpm add @rollup&#x2F;plugin-terser -D\n\n# visualizer\npnpm add rollup-plugin-visualizer -D\n\ntsconfig.jsonjson ä»£ç è§£è¯»å¤åˆ¶ä»£ç &#123;\n  &quot;compilerOptions&quot;: &#123;\n    &quot;module&quot;: &quot;esnext&quot;,\n    &quot;target&quot;: &quot;es5&quot;,\n    &quot;lib&quot;: [&quot;esnext&quot;, &quot;dom&quot;, &quot;dom.iterable&quot;],\n    &quot;skipLibCheck&quot;: true,\n\n    &quot;moduleResolution&quot;: &quot;bundler&quot;,\n    &quot;noEmit&quot;: true,\n    &quot;allowImportingTsExtensions&quot;:true,\n    &quot;resolveJsonModule&quot;: true,\n    &quot;isolatedModules&quot;: true,\n    &quot;jsx&quot;: &quot;preserve&quot;,\n\n    &quot;baseUrl&quot;: &quot;.&#x2F;&quot;,\n    &quot;paths&quot;: &#123;\n      &quot;@&#x2F;*&quot;: [&quot;src&#x2F;*&quot;]\n    &#125;,\n  &#125;,\n  &quot;include&quot;: [&quot;src&#x2F;**&#x2F;*&quot;,&quot;rollup.config.ts&quot;, &quot;global.d.ts&quot;],\n&#125;\n\n.babelrc.jsonperl ä»£ç è§£è¯»å¤åˆ¶ä»£ç &#123;\n  &quot;presets&quot;: [\n    [\n      &quot;@babel&#x2F;preset-env&quot;,\n      &#123;\n        &quot;targets&quot;: &quot;&gt; 0.25%, not dead&quot;,\n        &quot;useBuiltIns&quot;: &quot;usage&quot;,\n        &quot;corejs&quot;: 3\n      &#125;\n    ],\n    [&quot;@babel&#x2F;preset-react&quot;]\n  ],\n  &quot;plugins&quot;: [\n    [\n      &quot;@babel&#x2F;plugin-transform-runtime&quot;,\n      &#123;\n        &quot;corejs&quot;: 3\n      &#125;\n    ]\n  ]\n&#125;\n\nrollup.config.tsphp ä»£ç è§£è¯»å¤åˆ¶ä»£ç import &#123; RollupOptions &#125; from &quot;rollup&quot;;\nimport &#123; nodeResolve &#125; from &quot;@rollup&#x2F;plugin-node-resolve&quot;;\nimport commonjs from &quot;@rollup&#x2F;plugin-commonjs&quot;;\nimport babel from &quot;@rollup&#x2F;plugin-babel&quot;;\nimport typescript from &quot;@rollup&#x2F;plugin-typescript&quot;;\nimport htmlTemplate from &quot;rollup-plugin-generate-html-template&quot;;\nimport serve from &quot;rollup-plugin-serve&quot;;\nimport livereload from &quot;rollup-plugin-livereload&quot;;\nimport replace from &quot;@rollup&#x2F;plugin-replace&quot;;\nimport postcss from &quot;rollup-plugin-postcss&quot;;\nimport alias from &quot;@rollup&#x2F;plugin-alias&quot;;\nimport clear from &quot;rollup-plugin-clear&quot;;\nimport image from &quot;@rollup&#x2F;plugin-image&quot;\nimport terser from &#39;@rollup&#x2F;plugin-terser&#39;;\nimport &#123; fileURLToPath &#125; from &quot;node:url&quot;;\nimport &#123; visualizer &#125; from &quot;rollup-plugin-visualizer&quot;;\n\nconst config: RollupOptions &#x3D; &#123;\n  input: &quot;src&#x2F;main.tsx&quot;,\n  output: &#123;\n    dir: &quot;dist&#x2F;&quot;,\n    format: &quot;esm&quot;,\n    name: &quot;rollupDemo&quot;,\n    sourcemap: true,\n    plugins: [terser()],\n    entryFileNames: &quot;[name].[hash:6].js&quot;,\n    chunkFileNames: &quot;chunks&#x2F;chunk-[name]-[hash].js&quot;,\n    &#x2F;&#x2F; ä»£ç åˆ†å‰²\n    &#x2F;&#x2F; manualChunks: &#123;\n    &#x2F;&#x2F;   react: [&quot;react&quot;, &quot;react-dom&quot;]\n    &#x2F;&#x2F; &#125;,\n    globals: &#123;\n      react: &quot;React&quot;,\n      &quot;react-dom&quot;: &quot;ReactDOM&quot;,\n    &#125;,\n    paths: &#123;\n      react: &quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;react@18.2.0&#x2F;+esm&quot;,\n      &quot;react-dom&quot;: &quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;react-dom@18.2.0&#x2F;+esm&quot;,\n    &#125;\n  &#125;,\n  external: [&quot;react&quot;, &quot;react-dom&quot;],\n  plugins: [\n    visualizer(),\n    nodeResolve(&#123;\n      extensions: [&quot;.js&quot;, &quot;jsx&quot;, &quot;ts&quot;, &quot;tsx&quot;],\n    &#125;),\n    commonjs(),\n    typescript(),\n    babel(&#123;\n      babelHelpers: &quot;runtime&quot;,\n      include: &quot;src&#x2F;**&quot;,\n      exclude: &quot;node_modules&#x2F;**&quot;,\n      extensions: [&quot;.js&quot;, &quot;.ts&quot;, &quot;jsx&quot;, &quot;tsx&quot;],\n    &#125;),\n    alias(&#123;\n      entries: [\n        &#123;\n          find: &quot;@&quot;,\n          replacement: fileURLToPath(new URL(&quot;src&quot;, import.meta.url)),\n        &#125;,\n      ],\n    &#125;),\n    postcss(&#123;\n      extensions: [&quot;.css&quot;], &#x2F;&#x2F; å°†scssè§£ææˆcss\n      extract: true,\n      modules: true,\n    &#125;),\n    replace(&#123;\n      preventAssignment: true,\n      &quot;process.env.NODE_ENV&quot;: JSON.stringify(&quot;production&quot;), &#x2F;&#x2F; å¦åˆ™ä¼šæŠ¥ï¼šprocess is not definedçš„é”™\n    &#125;),\n    clear(&#123;\n      targets: [&quot;dist&quot;],\n    &#125;),\n    htmlTemplate(&#123;\n      template: &quot;public&#x2F;index.html&quot;,\n      target: &quot;dist&#x2F;index.html&quot;,\n      attrs: [&#39;type&#x3D;&quot;module&quot;&#39;],\n    &#125;),\n    image(),\n    serve(&quot;dist&quot;),\n    livereload(&quot;src&quot;),\n  ],\n&#125;;\nexport default config;\n\nnpm å‘åŒ…npm å‘å¸ƒnode_modulessql ä»£ç è§£è¯»å¤åˆ¶ä»£ç # rollup\npnpm add rollup -D\n\n# rollupå¸¸è§„æ’ä»¶\npnpm add @rollup&#x2F;plugin-node-resolve @rollup&#x2F;plugin-commonjs -D\n\n# typescriptç›¸å…³\npnpm add typescript tslib @rollup&#x2F;plugin-typescript -D\n\n# @rollup&#x2F;plugin-babelç›¸å…³\npnpm add @rollup&#x2F;plugin-babel @babel&#x2F;core @babel&#x2F;preset-env -D\n\n# lodash-es\npnpm add lodash-es\n\n# @types&#x2F;lodash-es\npnpm add @types&#x2F;lodash-es -D\n\ntsconfig.json æ–‡ä»¶json ä»£ç è§£è¯»å¤åˆ¶ä»£ç &#x2F;&#x2F; tsconfig.json\n&#123;\n  &quot;compilerOptions&quot;: &#123;\n    &quot;target&quot;: &quot;es5&quot;,\n    &quot;module&quot;: &quot;ESNext&quot;,\n    &quot;declaration&quot;: true,&#x2F;&#x2F; æ ¹æ®tsæ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆ.d.tså£°æ˜æ–‡ä»¶å’Œjsæ–‡ä»¶\n    &quot;emitDeclarationOnly&quot;: true, &#x2F;&#x2F; åªè¾“å‡º.d.tså£°æ˜æ–‡ä»¶ï¼Œä¸ç”Ÿæˆjsæ–‡ä»¶\n    &quot;outDir&quot;: &quot;.&#x2F;dist&quot;, &#x2F;&#x2F; è¾“å‡ºç›®å½•\n\t\t......\n  &#125;\n&#125;\n\næœ¬åœ°è°ƒè¯• link å®‰è£…æœ€ç»ˆæ‰“åŒ…çš„æ–‡ä»¶å¤¹æ˜¯ dist æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ package.json æ–‡ä»¶å’Œ README.md æ–‡ä»¶éƒ½æ‹·è´åˆ° dist ç›®å½•ä¸­ã€‚\nnpm link åœ°å€å…¶å®å°±æ˜¯å…¨å±€å®‰è£…åœ°å€ï¼š\nmac: /usr/local/lib/node_modules/\nWindows: c:\\ç”¨æˆ·(Users)\\ä½ çš„ç”¨æˆ·å\\AppData(éšè—æ–‡ä»¶å¤¹)\\Roaming\\npm\\node_modules\npnpm link\nåœ¨åº“æ–‡ä»¶çš„ dist ç›®å½•ä¸‹æ‰§è¡Œï¼š\nbash ä»£ç è§£è¯»å¤åˆ¶ä»£ç pnpm link --global\n\nè¿™ä¸ªå‘½ä»¤ä¼šè¯»å– package.json æ–‡ä»¶ä¸­çš„ nameï¼Œä½œä¸ºåŒ…æ–‡ä»¶çš„åå­—ï¼Œä½ å¯ä»¥ç†è§£ä¸ºï¼Œç›¸å½“äº pnpm å°†æˆ‘ä»¬æ‰“åŒ…çš„é¡¹ç›®ï¼Œå…¨å±€å®‰è£…åœ¨äº†æœ¬åœ°\nåœ¨ç›®æ ‡é¡¹ç›®ä¸­ï¼Œä½¿ç”¨å‘½ä»¤\nbash ä»£ç è§£è¯»å¤åˆ¶ä»£ç pnpm link --global åŒ…å\n\nè¿›è¡Œå®‰è£…ã€‚\nå¸è½½ link pnpm unlink\nå‘å¸ƒåˆ° npmå¸¸ç”¨å‘½ä»¤ï¼š\n\nnpm whoami æ£€æµ‹å½“å‰ç™»å½•çŠ¶æ€\nnpm config ls æ˜¾ç¤ºå½“å‰ npm é…ç½®ä¿¡æ¯\nnpm addUser ã€npm login ç™»å½•\nnpm config set registry é“¾æ¥åœ°å€ åˆ‡æ¢æºåœ°å€\nnpm publish å‘å¸ƒ\n\n\n\n\n\n\n\n\n\n\næ³¨æ„å¿…é¡»ä½¿ç”¨ npm æºé•œåƒæ‰èƒ½å‘å¸ƒï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯é˜¿é‡Œæºç­‰é•œåƒï¼Œéœ€è¦åˆ‡æ¢æˆæºé•œåƒæ‰èƒ½å‘å¸ƒ https://registry.npmjs.org/\nJavaScript APIRollup æä¾›äº†ä¸€ä¸ªå¯ä» Node.js ä½¿ç”¨çš„ JavaScript APIã€‚ä½ å¾ˆå°‘éœ€è¦ä½¿ç”¨å®ƒï¼Œä¸è¿‡é€šè¿‡è¿™ä¸ª API æˆ‘ä»¬å¯ä»¥æ¯”è¾ƒæ˜æ˜¾çš„çŸ¥é“ rollup çš„æ„å»ºå¤§è‡´æµç¨‹ã€‚\nå†…å®¹å…¶å®å¹¶ä¸å¤šï¼Œä¸»è¦æ ¸å¿ƒä¸¤ä¸ªå‡½æ•°ï¼Œrollup()ä¸ watch()\n\nrollup.rollup\n\ninputOptions å¯¹è±¡\noutputOptions å¯¹è±¡\n\n\nrollup.watch\n\nwatchOptions\n\n\n\nå…¶å®ç”¨èµ·æ¥çš„åŸºæœ¬æ€è·¯å’Œé…ç½®æ–‡ä»¶å·®ä¸å¤šã€‚ç›´æ¥æ¥çœ‹ä¸€ä¸‹æ•ˆæœï¼š\nini ä»£ç è§£è¯»å¤åˆ¶ä»£ç const rollup &#x3D; require(&#39;rollup&#39;);\n\nconst inputOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  external: [],\n  plugins: []\n&#125;\n\nconst outputOptions &#x3D; &#123;\n  dir: &#39;dist&#39;,\n  format: &#39;esm&#39;,\n  sourcemap: true,\n  entryFileNames: &#39;[name].[hash].js&#39;\n&#125;\n\nasync function build() &#123;\n  let bundle;\n  let buildFailed &#x3D; false;\n  try &#123;\n    bundle &#x3D; await rollup.rollup(inputOptions);\n    await bundle.write(outputOptions);\n  &#125; catch (error) &#123;\n    buildFailed &#x3D; true;\n    console.error(error);\n  &#125;\n\n  if (bundle) &#123;\n    &#x2F;&#x2F; å…³é—­æ‰“åŒ…è¿‡ç¨‹\n    await bundle.close();\n  &#125;\n  process.exit(buildFailed ? 1 : 0);\n&#125;\n\nbuild();\n\nconst watchOptions &#x3D; &#123;\n  ...inputOptions,\n  output: [outputOptions],\n  watch: &#123;\n    include: &#39;src&#x2F;**&#39;,\n    exclude: &#39;node_modules&#x2F;**&#39;\n  &#125;\n&#125;;\nconst watcher &#x3D; rollup.watch(watchOptions);\n\nwatcher.on(&#39;event&#39;, event &#x3D;&gt; &#123;\n  console.log(event);\n  &#x2F;&#x2F;ç¡®ä¿æ¯æ¬¡æ‰“åŒ…å®Œæˆåæ­£ç¡®çš„å…³é—­æ‰“åŒ…\n  if (event.result) &#123;\n    event.result.close();\n  &#125;\n&#125;)\n\nå…¶å®æ•´ä¸ªè¿‡ç¨‹æ— éå°±æ˜¯æŠŠæˆ‘ä»¬ä¹‹å‰é…ç½®çš„æµç¨‹è½¬æ¢ä½äº† js ä»£ç çš„å½¢å¼ã€‚watch apiå¾ˆæ˜æ˜¾å°±æ˜¯å‘½ä»¤è¡Œä¸­ä½¿ç”¨ --watch æ ‡å¿—è¿è¡Œ Rollup æ—¶çš„æ•ˆæœã€‚\nä¸¤å¤§æ„å»ºå·¥ä½œæµæˆ‘ä»¬ä¸»è¦æ¥çœ‹ä¸€ä¸‹rollup()å‡½æ•°ï¼Œä»rollup()å‡½æ•°å°±å¯ä»¥çœ‹å‡ºï¼Œrollup æ‰“åŒ…æ„å»ºæµç¨‹ä¸»è¦æ˜¯ä¸¤å¤§æ­¥éª¤ï¼š\n1ã€buildä¸»è¦è´Ÿè´£åˆ›å»ºæ¨¡å—ä¾èµ–ï¼Œåˆå§‹åŒ–å“¥å“¥æ¨¡å—çš„ AST(æŠ½è±¡è¯­æ³•æ ‘)ï¼Œä»¥åŠæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»\nini ä»£ç è§£è¯»å¤åˆ¶ä»£ç const rollup &#x3D; require(&#39;rollup&#39;);\n\nconst inputOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  external: [],\n  plugins: []\n&#125;\n\nasync function build() &#123;\n  const bundle &#x3D; await rollup.rollup(inputOptions);\n  console.log(bundle); &#x2F;&#x2F; æ‰“å°bundleå¯¹è±¡\n  console.log(bundle.cache.modules); &#x2F;&#x2F;æ‰“å°æ¨¡å—å†…å®¹\n&#125;\n\nbuild();\n\nyaml ä»£ç è§£è¯»å¤åˆ¶ä»£ç &#x2F;&#x2F; æ‰“å°bundleå¯¹è±¡\n&#123;\n  cache: &#123;\n    modules: [ [Object], [Object], [Object] ],\n    plugins: [Object: null prototype] &#123;&#125;\n  &#125;,\n  close: [AsyncFunction: close],\n  closed: false,\n  generate: [AsyncFunction: generate],\n  watchFiles: [\n    &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;index.js&#39;,\n    &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;randomNumber.js&#39;,\n    &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;deepClone.js&#39;\n  ],\n  write: [AsyncFunction: write]\n&#125;\n\n&#x2F;&#x2F; æ‰“å°æ¨¡å—å†…å®¹\n[\n  &#123;\n    assertions: &#123;&#125;,\n    ast: Node &#123;\n      type: &#39;Program&#39;,\n      start: 0,\n      end: 262,\n      body: [Array],\n      sourceType: &#39;module&#39;\n    &#125;,\n    code: &#39;&#x2F;**\\n&#39; +\n      &#39; * éšæœºæ•°\\n&#39; +\n      &#39; * @param &#123;*&#125; min æœ€å°å€¼\\n&#39; +\n      &#39; * @param &#123;*&#125; max æœ€å¤§å€¼\\n&#39; +\n      &#39; * @returns min-maxä¹‹é—´çš„éšæœºæ•´æ•°\\n&#39; +\n      &#39; *&#x2F;\\n&#39; +\n      &#39;const randomNumber &#x3D; (min, max) &#x3D;&gt; &#123;\\n&#39; +\n      &#39;  min &#x3D; Math.ceil(min);\\n&#39; +\n      &#39;  max &#x3D; Math.floor(max);\\n&#39; +\n      &#39;  return Math.floor(Math.random() * (max - min + 1)) + min;\\n&#39; +\n      &#39;&#125;\\n&#39; +\n      &#39;\\n&#39; +\n      &#39;export default randomNumber&#39;,\n    customTransformCache: false,\n    dependencies: [],\n    id: &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;randomNumber.js&#39;,\n    meta: &#123;&#125;,\n    moduleSideEffects: true,\n    originalCode: &#39;&#x2F;**\\n&#39; +\n      &#39; * éšæœºæ•°\\n&#39; +\n      &#39; * @param &#123;*&#125; min æœ€å°å€¼\\n&#39; +\n      &#39; * @param &#123;*&#125; max æœ€å¤§å€¼\\n&#39; +\n      &#39; * @returns min-maxä¹‹é—´çš„éšæœºæ•´æ•°\\n&#39; +\n      &#39; *&#x2F;\\n&#39; +\n      &#39;const randomNumber &#x3D; (min, max) &#x3D;&gt; &#123;\\n&#39; +\n      &#39;  min &#x3D; Math.ceil(min);\\n&#39; +\n      &#39;  max &#x3D; Math.floor(max);\\n&#39; +\n      &#39;  return Math.floor(Math.random() * (max - min + 1)) + min;\\n&#39; +\n      &#39;&#125;\\n&#39; +\n      &#39;\\n&#39; +\n      &#39;export default randomNumber&#39;,\n    originalSourcemap: null,\n    resolvedIds: [Object: null prototype] &#123;&#125;,\n    sourcemapChain: [],\n    syntheticNamedExports: false,\n    transformDependencies: [],\n    transformFiles: undefined\n  &#125;,\n  &#123;\n    assertions: &#123;&#125;,\n    ast: Node &#123;\n      type: &#39;Program&#39;,\n      start: 0,\n      end: 349,\n      body: [Array],\n      sourceType: &#39;module&#39;\n    &#125;,\n    code: &#39;&#x2F;**\\n&#39; +\n      &#39; * æ·±æ‹·è´\\n&#39; +\n      &#39; * @param obj éœ€è¦æ·±æ‹·è´çš„å¯¹è±¡\\n&#39; +\n      &#39; * @returns æ·±æ‹·è´å¯¹è±¡\\n&#39; +\n      &#39; *&#x2F;\\n&#39; +\n      &#39;const deepClone &#x3D; (obj) &#x3D;&gt; &#123;\\n&#39; +\n      &quot;  if(typeof obj !&#x3D;&#x3D; &#39;object&#39; || obj &#x3D;&#x3D;&#x3D; null) &#123;\\n&quot; +\n      &#39;    return obj\\n&#39; +\n      &#39;  &#125;\\n&#39; +\n      &#39;  const result &#x3D; Array.isArray(obj) ? [] : &#123;&#125;;\\n&#39; +\n      &#39;  for(let key in obj) &#123;\\n&#39; +\n      &#39;    if(obj.hasOwnProperty(key)) &#123;\\n&#39; +\n      &#39;      result[key] &#x3D; deepClone(obj[key])\\n&#39; +\n      &#39;    &#125;\\n&#39; +\n      &#39;  &#125;\\n&#39; +\n      &#39;  return result\\n&#39; +\n      &#39;&#125;\\n&#39; +\n      &#39;export default deepClone&#39;,\n    customTransformCache: false,\n    dependencies: [],\n    id: &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;deepClone.js&#39;,\n    meta: &#123;&#125;,\n    moduleSideEffects: true,\n    originalCode: &#39;&#x2F;**\\n&#39; +\n      &#39; * æ·±æ‹·è´\\n&#39; +\n      &#39; * @param obj éœ€è¦æ·±æ‹·è´çš„å¯¹è±¡\\n&#39; +\n      &#39; * @returns æ·±æ‹·è´å¯¹è±¡\\n&#39; +\n      &#39; *&#x2F;\\n&#39; +\n      &#39;const deepClone &#x3D; (obj) &#x3D;&gt; &#123;\\n&#39; +\n      &quot;  if(typeof obj !&#x3D;&#x3D; &#39;object&#39; || obj &#x3D;&#x3D;&#x3D; null) &#123;\\n&quot; +\n      &#39;    return obj\\n&#39; +\n      &#39;  &#125;\\n&#39; +\n      &#39;  const result &#x3D; Array.isArray(obj) ? [] : &#123;&#125;;\\n&#39; +\n      &#39;  for(let key in obj) &#123;\\n&#39; +\n      &#39;    if(obj.hasOwnProperty(key)) &#123;\\n&#39; +\n      &#39;      result[key] &#x3D; deepClone(obj[key])\\n&#39; +\n      &#39;    &#125;\\n&#39; +\n      &#39;  &#125;\\n&#39; +\n      &#39;  return result\\n&#39; +\n      &#39;&#125;\\n&#39; +\n      &#39;export default deepClone&#39;,\n    originalSourcemap: null,\n    resolvedIds: [Object: null prototype] &#123;&#125;,\n    sourcemapChain: [],\n    syntheticNamedExports: false,\n    transformDependencies: [],\n    transformFiles: undefined\n  &#125;,\n  &#123;\n    assertions: &#123;&#125;,\n    ast: Node &#123;\n      type: &#39;Program&#39;,\n      start: 0,\n      end: 131,\n      body: [Array],\n      sourceType: &#39;module&#39;\n    &#125;,\n    code: &#39;import randomNumber from &quot;.&#x2F;randomNumber.js&quot;;\\n&#39; +\n      &#39;import deepClone from &quot;.&#x2F;deepClone.js&quot;;\\n&#39; +\n      &#39;\\n&#39; +\n      &#39;export default &#123; randomNumber, deepClone &#125;\\n&#39; +\n      &#39;\\n&#39;,\n    customTransformCache: false,\n    dependencies: [\n      &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;randomNumber.js&#39;,\n      &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;deepClone.js&#39;\n    ],\n    id: &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;index.js&#39;,\n    meta: &#123;&#125;,\n    moduleSideEffects: true,\n    originalCode: &#39;import randomNumber from &quot;.&#x2F;randomNumber.js&quot;;\\n&#39; +\n      &#39;import deepClone from &quot;.&#x2F;deepClone.js&quot;;\\n&#39; +\n      &#39;\\n&#39; +\n      &#39;export default &#123; randomNumber, deepClone &#125;\\n&#39; +\n      &#39;\\n&#39;,\n    originalSourcemap: null,\n    resolvedIds: [Object: null prototype] &#123;\n      &#39;.&#x2F;randomNumber.js&#39;: [Object],\n      &#39;.&#x2F;deepClone.js&#39;: [Object]\n    &#125;,\n    sourcemapChain: [],\n    syntheticNamedExports: false,\n    transformDependencies: [],\n    transformFiles: undefined\n  &#125;\n]\n\né€šè¿‡ä¸Šé¢ä¸¤ä¸ªæ‰“å°è¯­å¥çš„ç»“æœï¼Œå…¶å®å°±å¯ä»¥åˆ†æå‡ºï¼Œåœ¨buildé˜¶æ®µäº§ç”Ÿçš„bunldeå¯¹è±¡ï¼Œå¹¶æ²¡æœ‰æ¨¡å—æ‰“åŒ…ï¼Œè¿™ä¸ªå¯¹è±¡çš„ä½œç”¨åœ¨äºå­˜å‚¨å„ä¸ªæ¨¡å—çš„å†…å®¹åŠä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”æä¾›äº†generate(ä¸å†™å…¥)ï¼Œwrite(å†™å…¥ç£ç›˜)æ–¹æ³•ï¼Œæ–¹ä¾¿åç»­ output é˜¶æ®µè¾“å‡ºäº§ç‰©\n2ã€outputé€šè¿‡ rollup()å‡½æ•°è¿”å›çš„å¯¹è±¡ bundle æœ‰ä¸¤ä¸ªé‡è¦çš„å‡½æ•°\n\ngenerate ç”Ÿæˆæ‰“åŒ…äº§ç‰©ï¼Œä¸å†™å…¥ç£ç›˜\nwrite ç”Ÿæˆæ‰“åŒ…äº§ç‰©ï¼Œå†™å…¥ç£ç›˜\n\nini ä»£ç è§£è¯»å¤åˆ¶ä»£ç const rollup &#x3D; require(&#39;rollup&#39;);\n\nconst inputOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  external: [],\n  plugins: []\n&#125;\n\nconst outputOptions &#x3D; &#123;\n  dir: &#39;dist&#39;,\n  format: &#39;esm&#39;,\n  sourcemap: true,\n  entryFileNames: &#39;[name].[hash].js&#39;\n&#125;\n\nasync function build() &#123;\n  const bundle &#x3D; await rollup.rollup(inputOptions);\n  const resp &#x3D; await bundle.generate(outputOptions);\n  console.log(resp)\n&#125;\n\nbuild();\n\næ‰§è¡Œç»“æœï¼š\nswift ä»£ç è§£è¯»å¤åˆ¶ä»£ç &#123;\n  output: [\n    &#123;\n      exports: [Array],\n      facadeModuleId: &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;index.js&#39;,\n      isDynamicEntry: false,\n      isEntry: true,\n      isImplicitEntry: false,\n      moduleIds: [Array],\n      name: &#39;index&#39;,\n      type: &#39;chunk&#39;,\n      dynamicImports: [],\n      fileName: &#39;index.1730c9fc.js&#39;,\n      implicitlyLoadedBefore: [],\n      importedBindings: &#123;&#125;,\n      imports: [],\n      modules: [Object: null prototype],\n      referencedFiles: [],\n      code: &#39;&#x2F;**\\n&#39; +\n        &#39; * éšæœºæ•°\\n&#39; +\n        &#39; * @param &#123;*&#125; min æœ€å°å€¼\\n&#39; +\n        &#39; * @param &#123;*&#125; max æœ€å¤§å€¼\\n&#39; +\n        &#39; * @returns min-maxä¹‹é—´çš„éšæœºæ•´æ•°\\n&#39; +\n        &#39; *&#x2F;\\n&#39; +\n        &#39;const randomNumber &#x3D; (min, max) &#x3D;&gt; &#123;\\n&#39; +\n        &#39;  min &#x3D; Math.ceil(min);\\n&#39; +\n        &#39;  max &#x3D; Math.floor(max);\\n&#39; +\n        &#39;  return Math.floor(Math.random() * (max - min + 1)) + min;\\n&#39; +\n        &#39;&#125;;\\n&#39; +\n        &#39;\\n&#39; +\n        &#39;&#x2F;**\\n&#39; +\n        &#39; * æ·±æ‹·è´\\n&#39; +\n        &#39; * @param obj éœ€è¦æ·±æ‹·è´çš„å¯¹è±¡\\n&#39; +\n        &#39; * @returns æ·±æ‹·è´å¯¹è±¡\\n&#39; +\n        &#39; *&#x2F;\\n&#39; +\n        &#39;const deepClone &#x3D; (obj) &#x3D;&gt; &#123;\\n&#39; +\n        &quot;  if(typeof obj !&#x3D;&#x3D; &#39;object&#39; || obj &#x3D;&#x3D;&#x3D; null) &#123;\\n&quot; +\n        &#39;    return obj\\n&#39; +\n        &#39;  &#125;\\n&#39; +\n        &#39;  const result &#x3D; Array.isArray(obj) ? [] : &#123;&#125;;\\n&#39; +\n        &#39;  for(let key in obj) &#123;\\n&#39; +\n        &#39;    if(obj.hasOwnProperty(key)) &#123;\\n&#39; +\n        &#39;      result[key] &#x3D; deepClone(obj[key]);\\n&#39; +\n        &#39;    &#125;\\n&#39; +\n        &#39;  &#125;\\n&#39; +\n        &#39;  return result\\n&#39; +\n        &#39;&#125;;\\n&#39; +\n        &#39;\\n&#39; +\n        &#39;var index &#x3D; &#123; randomNumber, deepClone &#125;;\\n&#39; +\n        &#39;\\n&#39; +\n        &#39;export &#123; index as default &#125;;\\n&#39; +\n        &#39;&#x2F;&#x2F;# sourceMappingURL&#x3D;index.1730c9fc.js.map\\n&#39;,\n      map: [SourceMap],\n      preliminaryFileName: &#39;index.!~&#123;001&#125;~.js&#39;,\n      sourcemapFileName: &#39;index.1730c9fc.js.map&#39;\n    &#125;,\n    &#123;\n      fileName: &#39;index.1730c9fc.js.map&#39;,\n      name: undefined,\n      needsCodeReference: false,\n      source: &#96;&#123;&quot;version&quot;:3,&quot;file&quot;:&quot;index.1730c9fc.js&quot;,&quot;sources&quot;:[&quot;..&#x2F;src&#x2F;randomNumber.js&quot;,&quot;..&#x2F;src&#x2F;deepClone.js&quot;,&quot;..&#x2F;src&#x2F;index.js&quot;],&quot;sourcesContent&quot;:[&quot;&#x2F;**\\n * éšæœºæ•°\\n * @param &#123;*&#125; min æœ€å°å€¼\\n * @param &#123;*&#125; max æœ€å¤§å€¼\\n * @returns min-maxä¹‹é—´çš„éšæœºæ•´æ•°\\n *&#x2F;\\nconst randomNumber &#x3D; (min, max) &#x3D;&gt; &#123;\\n  min &#x3D; Math.ceil(min);\\n  max &#x3D; Math.floor(max);\\n  return Math.floor(Math.random() * (max - min + 1)) + min;\\n&#125;\\n\\nexport default randomNumber&quot;,&quot;&#x2F;**\\n * æ·±æ‹·è´\\n * @param obj éœ€è¦æ·±æ‹·è´çš„å¯¹è±¡\\n * @returns æ·±æ‹·è´å¯¹è±¡\\n *&#x2F;\\nconst deepClone &#x3D; (obj) &#x3D;&gt; &#123;\\n  if(typeof obj !&#x3D;&#x3D; &#39;object&#39; || obj &#x3D;&#x3D;&#x3D; null) &#123;\\n    return obj\\n  &#125;\\n  const result &#x3D; Array.isArray(obj) ? [] : &#123;&#125;;\\n  for(let key in obj) &#123;\\n    if(obj.hasOwnProperty(key)) &#123;\\n      result[key] &#x3D; deepClone(obj[key])\\n    &#125;\\n  &#125;\\n  return result\\n&#125;\\nexport default deepClone&quot;,&quot;import randomNumber from \\&quot;.&#x2F;randomNumber.js\\&quot;;\\nimport deepClone from \\&quot;.&#x2F;deepClone.js\\&quot;;\\n\\nexport default &#123; randomNumber, deepClone &#125;\\n\\n&quot;],&quot;names&quot;:[],&quot;mappings&quot;:&quot;AAAA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,YAAY,GAAG,CAAC,GAAG,EAAE,GAAG,KAAK;AACnC,EAAE,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACvB,EAAE,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AACxB,EAAE,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;AAC3D;;ACVA;AACA;AACA;AACA;AACA;AACA,MAAM,SAAS,GAAG,CAAC,GAAG,KAAK;AAC3B,EAAE,GAAG,OAAO,GAAG,KAAK,QAAQ,IAAI,GAAG,KAAK,IAAI,EAAE;AAC9C,IAAI,OAAO,GAAG;AACd,GAAG;AACH,EAAE,MAAM,MAAM,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,CAAC;AAC9C,EAAE,IAAI,IAAI,GAAG,IAAI,GAAG,EAAE;AACtB,IAAI,GAAG,GAAG,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;AAChC,MAAM,MAAM,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,GAAG,CAAC,GAAG,CAAC,EAAC;AACvC,KAAK;AACL,GAAG;AACH,EAAE,OAAO,MAAM;AACf;;ACbA,YAAe,EAAE,YAAY,EAAE,SAAS;;;;&quot;&#125;&#96;,\n      type: &#39;asset&#39;\n    &#125;\n  ]\n&#125;\n\næ’ä»¶æœºåˆ¶\n\n\n\n\n\n\n\n\nä»£ç ï¼šgithub.com&#x2F;Sunny-117&#x2F;râ€¦\nRollup æ’ä»¶æ¦‚è¿°\n\n\n\n\n\n\n\n\nRollup æ’ä»¶æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…·æœ‰ å±æ€§ã€æ„å»ºé’©å­ å’Œ è¾“å‡ºç”Ÿæˆé’©å­ ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œå¹¶éµå¾ªæˆ‘ä»¬çš„ çº¦å®šã€‚æ’ä»¶åº”ä½œä¸ºä¸€ä¸ªå¯¼å‡ºä¸€ä¸ªå‡½æ•°çš„åŒ…è¿›è¡Œå‘å¸ƒï¼Œè¯¥å‡½æ•°å¯ä»¥ä½¿ç”¨æ’ä»¶ç‰¹å®šçš„é€‰é¡¹è¿›è¡Œè°ƒç”¨å¹¶è¿”å›æ­¤ç±»å¯¹è±¡ã€‚\nç®€å•æ¥è¯´ï¼Œrollup æ’ä»¶ä¸€èˆ¬ä¼šåšæˆä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿”å›çš„å¯¹è±¡ä¸­åŒ…å«ä¸€äº›å±æ€§å’Œä¸åŒé˜¶æ®µçš„é’©å­å‡½æ•°ã€‚\nçº¦å®šæ’ä»¶åº”è¯¥æœ‰ä¸€ä¸ªæ˜ç¡®çš„åç§°ï¼Œå¹¶ä»¥rollup-plugin-ä½œä¸ºå‰ç¼€ã€‚\nå±æ€§nameï¼šæ’ä»¶çš„åç§°ï¼Œç”¨äºåœ¨è­¦å‘Šå’Œé”™è¯¯æ¶ˆæ¯ä¸­æ ‡è¯†æ’ä»¶ã€‚\nversionï¼šæ’ä»¶çš„ç‰ˆæœ¬\né’©å­å‡½æ•°çš„ç‰¹ç‚¹\né’©å­å‡½æ•°åŒºåˆ†ä¸åŒçš„è°ƒç”¨æ—¶æœº\né’©å­å‡½æ•°æ˜¯æœ‰æ‰§è¡Œé¡ºåºçš„\né’©å­å‡½æ•°æœ‰ä¸åŒçš„æ‰§è¡Œæ–¹å¼\né’©å­å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡çš„å½¢å¼\nå¯¹è±¡å½¢å¼çš„é’©å­å‡½æ•°å¯ä»¥æ”¹å˜é’©å­çš„æ‰§è¡Œï¼Œè®©ä¸åŒæ’ä»¶çš„åŒåé’©å­å‡½æ•°è·å–ä¸é€šçš„æ‰§è¡Œå…ˆå\n\né’©å­å‡½æ•°çš„è°ƒç”¨æ—¶æœºè¿™é‡Œçš„è°ƒç”¨æ—¶æœºï¼Œå…¶å®å°±æ˜¯ä»¥æˆ‘ä»¬ä¸Šé¢çš„ APIï¼Œbuild å’Œ output ä¸¤å¤§å·¥ä½œæµçš„ä¸åŒé˜¶æ®µè¿›è¡Œåˆ†ç±»ã€‚æ ¹æ®è¿™ä¸¤ä¸ªä¸åŒé˜¶æ®µï¼Œrollup æä¾›çš„ä¸åŒçš„å‡½æ•°è®©æˆ‘ä»¬è°ƒç”¨\n\nconst bundle &#x3D; await rollup.rollup(inputOptions) æ‰§è¡ŒæœŸé—´çš„æ„å»ºé’©å­å‡½æ•° - build-hooks\nawait bundle.generate(outputOptions)&#x2F;write(outputOptions) æ‰§è¡ŒæœŸé—´çš„è¾“å‡ºé’©å­å‡½æ•°-output-generation-hooks\n\né’©å­å‡½æ•°çš„æ‰§è¡Œæ–¹å¼é™¤äº†ä¸Šé¢ç®€å•çš„åˆ’åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µçš„è°ƒç”¨æ—¶æœºä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä»¥é’©å­å‡½æ•°çš„æ‰§è¡Œæ–¹å¼æ¥åˆ†ç±»ã€‚\n\nasync/syncï¼šå¼‚æ­¥&#x2F;åŒæ­¥é’©å­ï¼Œasync æ ‡è®°çš„é’©å­å¯ä»¥è¿”å›ä¸€ä¸ªè§£æä¸ºç›¸åŒç±»å‹çš„å€¼çš„ Promiseï¼›å¦åˆ™ï¼Œè¯¥é’©å­è¢«æ ‡è®°ä¸º syncã€‚\nfirstï¼šå¦‚æœæœ‰å¤šä¸ªæ’ä»¶å®ç°æ­¤é’©å­ï¼Œåˆ™é’©å­æŒ‰é¡ºåºè¿è¡Œï¼Œç›´åˆ°é’©å­è¿”å›ä¸€ä¸ªä¸æ˜¯ null æˆ– undefined çš„å€¼ã€‚\nsequentialï¼šå¦‚æœæœ‰å¤šä¸ªæ’ä»¶å®ç°æ­¤é’©å­ï¼Œåˆ™æ‰€æœ‰è¿™äº›é’©å­å°†æŒ‰æŒ‡å®šçš„æ’ä»¶é¡ºåºè¿è¡Œã€‚å¦‚æœé’©å­æ˜¯ asyncï¼Œåˆ™æ­¤ç±»åç»­é’©å­å°†ç­‰å¾…å½“å‰é’©å­è§£å†³åå†è¿è¡Œã€‚\nparallelï¼šå¦‚æœæœ‰å¤šä¸ªæ’ä»¶å®ç°æ­¤é’©å­ï¼Œåˆ™æ‰€æœ‰è¿™äº›é’©å­å°†æŒ‰æŒ‡å®šçš„æ’ä»¶é¡ºåºè¿è¡Œã€‚å¦‚æœé’©å­æ˜¯ asyncï¼Œåˆ™æ­¤ç±»åç»­é’©å­å°†å¹¶è¡Œè¿è¡Œï¼Œè€Œä¸æ˜¯ç­‰å¾…å½“å‰é’©å­ã€‚\n\né’©å­å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡é™¤äº†å‡½æ•°ä¹‹å¤–ï¼Œé’©å­ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®é™…çš„é’©å­å‡½æ•°ï¼ˆæˆ– banner/footer/intro/outro çš„å€¼ï¼‰å¿…é¡»æŒ‡å®šä¸º handlerã€‚è¿™å…è®¸ä½ æä¾›æ›´å¤šçš„å¯é€‰å±æ€§ï¼Œä»¥æ”¹å˜é’©å­çš„æ‰§è¡Œï¼š\n\norder: â€œpreâ€ | â€œpostâ€ | null\n\nå¦‚æœæœ‰å¤šä¸ªæ’ä»¶å®ç°æ­¤é’©å­ï¼Œåˆ™å¯ä»¥å…ˆè¿è¡Œæ­¤æ’ä»¶ï¼ˆ&quot;pre&quot;ï¼‰ï¼Œæœ€åè¿è¡Œæ­¤æ’ä»¶ï¼ˆ&quot;post&quot;ï¼‰ï¼Œæˆ–åœ¨ç”¨æˆ·æŒ‡å®šçš„ä½ç½®è¿è¡Œï¼ˆæ²¡æœ‰å€¼æˆ– nullï¼‰ã€‚\nexport default function resolveFirst() &#123;\n  return &#123;\n    name: &quot;resolve-first&quot;,\n    resolveId: &#123;\n      order: &quot;pre&quot;,\n      handler(source) &#123;\n        console.log(source);\n        return null;\n      &#125;,\n    &#125;,\n  &#125;;\n&#125;\n\næ„å»ºé’©å­æ‰§è¡Œé¡ºåº\n\né€šè¿‡ options é’©å­è¯»å–é…ç½®ï¼Œå¹¶è¿›è¡Œé…ç½®çš„è½¬æ¢ï¼Œå¾—åˆ°å¤„ç†åçš„é…ç½®å¯¹è±¡\nè°ƒç”¨ buildStart é’©å­ï¼Œè€ƒè™‘äº†æ‰€æœ‰ optionsé’©å­é…ç½®çš„è½¬æ¢ï¼ŒåŒ…å«æœªè®¾ç½®é€‰é¡¹çš„æ­£ç¡®é»˜è®¤å€¼ï¼Œæ­£å¼å¼€å§‹æ„å»ºæµç¨‹\nè°ƒç”¨ resolveId é’©å­è§£ææ¨¡å—æ–‡ä»¶è·¯å¾„ã€‚rollup ä¸­æ¨¡å—æ–‡ä»¶çš„ id å°±æ˜¯æ–‡ä»¶åœ°å€ï¼Œæ‰€ä»¥ï¼Œç±»ä¼¼ resolveId è¿™ç§å°±æ˜¯è§£ææ–‡ä»¶åœ°å€çš„æ„æ€ã€‚ä»inputOptionçš„inputé…ç½®æŒ‡å®šçš„å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œæ¯å½“åŒ¹é…åˆ°å¼•å…¥å¤–éƒ¨æ¨¡å—çš„è¯­å¥(å¦‚ï¼šimport moudleA from &#39;./moduleA&#39;)ä¾¿ä¾æ¬¡æ‰§è¡Œæ³¨å†Œæ’ä»¶ä¸­çš„æ¯ä¸€ä¸ª resolveId é’©å­ï¼Œç›´åˆ°æŸä¸€ä¸ªæ’ä»¶ä¸­çš„ resolveId æ‰§è¡Œå®Œåè¿”å›é null æˆ–é undefined çš„å€¼ï¼Œå°†åœæ­¢æ‰§è¡Œåç»­æ’ä»¶çš„ resolveId é€»è¾‘å¹¶è¿›å…¥ä¸‹ä¸€ä¸ªé’©å­\nè°ƒç”¨loadé’©å­åŠ è½½æ¨¡å—å†…å®¹ï¼ŒresolveIdä¸­çš„è·¯å¾„ä¸€èˆ¬ä¸ºç›¸å¯¹è·¯å¾„ï¼Œload ä¸­çš„è·¯å¾„ä¸ºå¤„ç†ä¹‹åçš„ç»å¯¹è·¯å¾„\næ¥ç€åˆ¤æ–­å½“å‰è§£æçš„æ¨¡å—æ˜¯å¦å­˜åœ¨ç¼“å­˜ï¼Œè‹¥ä¸å­˜åœ¨åˆ™æ‰§è¡Œæ‰€æœ‰çš„ transform é’©å­æ¥å¯¹æ¨¡å—å†…å®¹è¿›è¡Œè¿›è¡Œè‡ªå®šä¹‰çš„è½¬æ¢ï¼›è‹¥å­˜åœ¨åˆ™åˆ¤æ–­shouldTransformCachedModuleå±æ€§ï¼Œtrue åˆ™æ‰§è¡Œæ‰€æœ‰çš„ transform é’©å­ï¼Œfalse åˆ™è¿›å…¥moduleParsedé’©å­é€»è¾‘\næ‹¿åˆ°æœ€åçš„æ¨¡å—å†…å®¹ï¼Œè¿›è¡Œ AST åˆ†æï¼Œè°ƒç”¨ moduleParsed é’©å­ã€‚å¦‚æœå†…éƒ¨æ²¡æœ‰importså†…å®¹ï¼Œè¿›å…¥buildEndç¯èŠ‚ã€‚å¦‚æœè¿˜æœ‰importså†…å®¹åˆ™ç»§ç»­ï¼Œå¦‚æœæ˜¯æ™®é€šçš„ importï¼Œåˆ™æ‰§è¡ŒresolveId é’©å­ï¼Œç»§ç»­å›åˆ°æ­¥éª¤ 3-è°ƒç”¨ resolveIdï¼›å¦‚æœæ˜¯åŠ¨æ€ importï¼Œåˆ™æ‰§è¡ŒresolveDynamicImport é’©å­è§£æè·¯å¾„ï¼Œå¦‚æœè§£ææˆåŠŸï¼Œåˆ™å›åˆ°æ­¥éª¤ 4-loadåŠ è½½æ¨¡å—ï¼Œå¦åˆ™å›åˆ°æ­¥éª¤ 3 é€šè¿‡ resolveId è§£æè·¯å¾„\nç›´åˆ°æ‰€æœ‰çš„ import éƒ½è§£æå®Œæ¯•ï¼ŒRollup æ‰§è¡ŒbuildEndé’©å­ï¼ŒBuild é˜¶æ®µç»“æŸ\n\n&#x2F;&#x2F; rollup-plugin-example.js\n\nexport default function myExample() &#123;\n  return &#123;\n    name: &quot;my-example&quot;,\n    options(options) &#123;\n      console.log(&quot;ğŸ‰ -- options:&quot;, options);\n    &#125;,\n    buildStart(options) &#123;\n      console.log(&quot;âœ¨ -- buildStart:&quot;, options);\n    &#125;,\n    resolveId(source, importer) &#123;\n      console.log(&quot;ğŸš€ -- resolveId(source):&quot;, source);\n      console.log(&quot;ğŸš€ -- resolveId(importer):&quot;, importer);\n      return null;\n    &#125;,\n    load(id) &#123;\n      console.log(&quot;ğŸŒˆ ~ id:&quot;, id);\n      return null;\n    &#125;,\n    transform(code, id) &#123;\n      console.log(&quot;ğŸŒŸ -- transform&quot;);\n      console.log(&quot;---&quot;, code);\n      console.log(&quot;---&quot;, id);\n    &#125;,\n    moduleParsed(info) &#123;\n      console.log(&quot;â­ï¸ -- moduleParsed:&quot;, info);\n    &#125;,\n    buildEnd() &#123;\n      console.log(&quot;ğŸ˜ -- buildEnd&quot;);\n    &#125;,\n  &#125;;\n&#125;\n\nè°ƒç”¨è™šæ‹Ÿæ¨¡å—æ’ä»¶ç¤ºä¾‹const virtualModuleId &#x3D; &quot;virtual-module&quot;;\n&#x2F;&#x2F; rollupçº¦å®šæ’ä»¶ä½¿ç”¨â€œè™šæ‹Ÿæ¨¡å—â€ï¼Œä½¿ç”¨\\0å‰ç¼€æ¨¡å— IDã€‚è¿™å¯ä»¥é˜²æ­¢å…¶ä»–æ’ä»¶å°è¯•å¤„ç†å®ƒã€‚\nconst resolvedVirtualModuleId &#x3D; &quot;\\0&quot; + virtualModuleId;\nexport default function virtualModule() &#123;\n  return &#123;\n    name: &quot;virtual-module&quot;,\n    resolveId(source) &#123;\n      if (source &#x3D;&#x3D;&#x3D; &quot;virtual-module&quot;) &#123;\n        return resolvedVirtualModuleId; &#x2F;&#x2F; å‘Šè¯‰Rollupï¼Œè¿™ä¸ªIDæ˜¯å¤–éƒ¨æ¨¡å—ï¼Œä¸è¦åœ¨æ­¤å¤„æŸ¥æ‰¾å®ƒ\n      &#125;\n      return null; &#x2F;&#x2F; å…¶ä»–IDåº”æŒ‰é€šå¸¸æ–¹å¼å¤„ç†\n    &#125;,\n    load(id) &#123;\n      console.log(&quot;ğŸŒˆ - id:&quot;, id);\n      if (id &#x3D;&#x3D;&#x3D; resolvedVirtualModuleId) &#123;\n        &#x2F;&#x2F; return &#39;export default &quot;This is virtual!&quot;&#39;; &#x2F;&#x2F; å‘Šè¯‰Rollupï¼Œå¦‚ä½•åŠ è½½æ­¤æ¨¡å—\n        return &quot;export default function fib(n) &#123; return n &lt;&#x3D; 1 ? n : fib(n - 1) + fib(n - 2); &#125;&quot;;\n      &#125;\n      return null; &#x2F;&#x2F; å…¶ä»–IDåº”æŒ‰é€šå¸¸æ–¹å¼å¤„ç†\n    &#125;,\n  &#125;;\n&#125;\n\nç•Œé¢è°ƒç”¨\nimport fib from &quot;virtual-module&quot;;\nconsole.log(fib(10));\n\nJSON æ’ä»¶ç¤ºä¾‹rollup é»˜è®¤æ˜¯ä¸èƒ½ç›´æ¥è¯»å– json æ–‡ä»¶çš„å†…å®¹çš„ï¼Œæˆ‘ä»¬è‡ªå·±å†™ä¸€ä¸ªæ’ä»¶å¤„ç†ä¸€ä¸‹ï¼Œä¸è¿‡å†™è¿™ä¸ªæ’ä»¶ä¹‹å‰ï¼Œæœ‰ä¸€äº›å°çŸ¥è¯†ç‚¹éœ€è¦è¡¥å……ä¸€ä¸‹\n@rollup&#x2F;pluginutils rollup å®˜æ–¹æä¾›çš„å·¥å…·æ’ä»¶,é‡Œé¢æœ‰ä¸€äº›åˆ¶ä½œæ’ä»¶å¸¸ç”¨çš„æ–¹æ³•\nå®‰è£…\nsql ä»£ç è§£è¯»å¤åˆ¶ä»£ç pnpm add @rollup&#x2F;plugin-commonjs @rollup&#x2F;plugin-node-resolve @rollup&#x2F;pluginutils -D\n\næ’ä»¶ä¸Šä¸‹æ–‡\nè¿™ä¸ªå…¶å®ä¹Ÿæ˜¯æ’ä»¶ä¸­å¾ˆå¸¸ç”¨çš„ä¸€äº› apiï¼Œå¯ä»¥é€šè¿‡ this ä»å¤§å¤šæ•°é’©å­ä¸­è®¿é—®ä¸€äº›å®ç”¨å‡½æ•°å’Œä¿¡æ¯ä½\nrollup-plugin-json\nimport &#123; createFilter, dataToEsm &#125; from &quot;@rollup&#x2F;pluginutils&quot;;\nimport path from &quot;path&quot;;\n\nexport default function myJson(options &#x3D; &#123;&#125;) &#123;\n  &#x2F;&#x2F; createFilter è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªidè·¯å¾„å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼\n  &#x2F;&#x2F; è¿™ä¸ªå¸ƒå°”å€¼è¡¨ç¤ºæ˜¯å¦è¦å¤„ç†è¿™ä¸ªidè·¯å¾„\n  &#x2F;&#x2F; rollup æ¨èæ¯ä¸€ä¸ª transform ç±»å‹çš„æ’ä»¶éƒ½éœ€è¦æä¾› include å’Œ exclude é€‰é¡¹ï¼Œç”Ÿæˆè¿‡æ»¤è§„åˆ™\n  const filter &#x3D; createFilter(options.include, options.exclude);\n  return &#123;\n    name: &quot;rollup-plugin-json&quot;,\n    transform: &#123;\n      order: &quot;pre&quot;,\n      handler(code, id) &#123;\n        if (!filter(id) || path.extname(id) !&#x3D;&#x3D; &quot;.json&quot;) return null;\n        try &#123;\n          const parse &#x3D; JSON.stringify(JSON.parse(code));\n          return &#123;\n            &#x2F;&#x2F; dataToEsm å°†æ•°æ®è½¬æ¢æˆesmæ¨¡å—\n            &#x2F;&#x2F; å…¶å®å°±æ˜¯ export default &quot;xxx&quot;\n            code: dataToEsm(parse),\n            map: &#123; mappings: &quot;&quot; &#125;,\n          &#125;;\n        &#125; catch (err) &#123;\n          const message &#x3D; &quot;Could not parse JSON file&quot;;\n          this.error(&#123; message, id, cause: err &#125;);\n          return null;\n        &#125;\n      &#125;,\n    &#125;,\n  &#125;;\n&#125;\n\nç•Œé¢è°ƒç”¨\nimport pkg from &quot;..&#x2F;package.json&quot;;\nimport test from &quot;..&#x2F;test.json&quot;; &#x2F;&#x2F; é”™è¯¯jsonæ ¼å¼æ¼”ç¤º\nconsole.log(pkg.name);\n\næ’ä»¶ä¸Šä¸‹æ–‡import &#123; createFilter &#125; from &quot;@rollup&#x2F;pluginutils&quot;;\n\nexport default function customPlugin(options) &#123;\n  const filter &#x3D; createFilter(options.include, options.exclude);\n\n  return &#123;\n    name: &quot;custom-plugin&quot;,\n\n    transform(code, id) &#123;\n      if (!filter(id)) &#123;\n        return null;\n      &#125;\n\n      const parsedCode &#x3D; this.parse(code); &#x2F;&#x2F; è§£æä»£ç ,è·å–AST\n\n      const source &#x3D; &#96;$&#123;code&#125;\\n\\n$&#123;JSON.stringify(parsedCode, null, 2)&#125;&#96;;\n\n      const fileName &#x3D; id.split(&quot;&#x2F;&quot;).pop();\n\n      if (options.emitFile) &#123;\n        this.emitFile(&#123;\n          type: &quot;asset&quot;,\n          fileName: fileName + &quot;.txt&quot;,\n          source,\n        &#125;);\n      &#125;\n    &#125;,\n  &#125;;\n&#125;\n\nå›¾ç‰‡è¯»å–import &#123; createFilter, dataToEsm &#125; from &quot;@rollup&#x2F;pluginutils&quot;;\nimport &#123; extname, resolve, basename, relative, normalize, sep &#125; from &quot;path&quot;;\nimport fs from &quot;fs&quot;;\nimport svgToMiniDataURI from &quot;mini-svg-data-uri&quot;;\n\nconst defaults &#x3D; &#123;\n  fileSize: 1024 * 4,\n  target: &quot;.&#x2F;dist&quot;,\n  include: null,\n  exclude: null,\n&#125;;\n\nconst mimeTypes &#x3D; &#123;\n  &quot;.png&quot;: &quot;image&#x2F;png&quot;,\n  &quot;.jpg&quot;: &quot;image&#x2F;jpeg&quot;,\n  &quot;.jpeg&quot;: &quot;image&#x2F;jpeg&quot;,\n  &quot;.gif&quot;: &quot;image&#x2F;gif&quot;,\n  &quot;.svg&quot;: &quot;image&#x2F;svg+xml&quot;,\n  &quot;.ico&quot;: &quot;image&#x2F;x-icon&quot;,\n  &quot;.webp&quot;: &quot;image&#x2F;webp&quot;,\n  &quot;.avif&quot;: &quot;image&#x2F;avif&quot;,\n&#125;;\n\nconst getDataUri &#x3D; (&#123; format, isSvg, mime, source &#125;) &#x3D;&gt;\n  isSvg ? svgToMiniDataURI(source) : &#96;data:$&#123;mime&#125;;$&#123;format&#125;,$&#123;source&#125;&#96;;\n\nconst ensureDirExists &#x3D; async (dirPath) &#x3D;&gt; &#123;\n  try &#123;\n    await fs.promises.access(dirPath);\n    return true;\n  &#125; catch (err) &#123;\n    &#x2F;&#x2F; æ–‡ä»¶å¤¹ä¸å­˜åœ¨å°±åˆ›å»ºæ–‡ä»¶å¤¹\n    try &#123;\n      await fs.promises.mkdir(dirPath, &#123; recursive: true &#125;);\n      return true;\n    &#125; catch (err) &#123;\n      console.error(err);\n      return false;\n    &#125;\n  &#125;\n&#125;;\n\nexport default function myImage(opts &#x3D; &#123;&#125;) &#123;\n  const options &#x3D; Object.assign(&#123;&#125;, defaults, opts);\n  const filter &#x3D; createFilter(options.include, options.exclude);\n  return &#123;\n    name: &quot;my-image&quot;,\n    async transform(code, id) &#123;\n      if (!filter(id)) return null;\n\n      &#x2F;&#x2F; è·å–åç¼€\n      const ext &#x3D; extname(id);\n      &#x2F;&#x2F; åˆ¤æ–­æ˜¯å¦æ˜¯å›¾ç‰‡\n      if (!mimeTypes.hasOwnProperty(ext)) &#123;\n        return null;\n      &#125;\n\n      &#x2F;&#x2F; è·å–å›¾ç‰‡çš„mimeç±»å‹\n      const mime &#x3D; mimeTypes[ext];\n      &#x2F;&#x2F; åˆ¤æ–­æ˜¯å¦svg\n      const isSvg &#x3D; mime &#x3D;&#x3D;&#x3D; mimeTypes[&quot;.svg&quot;];\n      &#x2F;&#x2F; å›¾ç‰‡formatæ ¼å¼\n      const format &#x3D; isSvg ? &quot;utf-8&quot; : &quot;base64&quot;;\n\n      &#x2F;&#x2F; ç›®æ ‡è·¯å¾„\n      const assetsPath &#x3D; resolve(process.cwd(), options.target);\n      console.log(&quot;---&quot;, process.cwd());\n      console.log(&quot;---&quot;, options.target);\n      console.log(&quot;---&quot;, assetsPath);\n\n      &#x2F;&#x2F;è·å–æ–‡ä»¶å\n      const fileName &#x3D; basename(id);\n      &#x2F;&#x2F; æœ€ç»ˆæ–‡ä»¶è·¯å¾„\n      const filePath &#x3D; resolve(assetsPath, fileName);\n      console.log(&quot;&#x3D;&#x3D;&#x3D;&quot;, filePath);\n\n      let relativePath &#x3D; normalize(relative(process.cwd(), filePath));\n      relativePath &#x3D; relativePath.substring(relativePath.indexOf(sep) + 1);\n\n      console.log(relativePath);\n\n      try &#123;\n        &#x2F;&#x2F; å¦‚æœå›¾ç‰‡æ–‡ä»¶è¿‡å¤§ï¼Œå°±åº”è¯¥ç›´æ¥æ‹·è´æ–‡ä»¶ï¼Œè¿”å›æ–‡ä»¶è·¯å¾„\n        &#x2F;&#x2F; è¯»å–å›¾ç‰‡æ–‡ä»¶å¤§å°ä¸è®¾ç½®çš„å¤§å°è¿›è¡Œæ¯”è¾ƒ\n        const stat &#x3D; await fs.promises.stat(id);\n        if (stat.size &gt; options.fileSize) &#123;\n          &#x2F;&#x2F; æ–‡ä»¶çš„æ‹·è´ï¼Œä»¥åŠå¯¹è±¡çš„è¿”å›\n          &#x2F;&#x2F; æ–‡ä»¶æ‹·è´ï¼Œæ— éå°±æ˜¯æ–‡ä»¶æºè·¯å¾„ï¼Œç›®æ ‡è·¯å¾„\n          &#x2F;&#x2F;copyFile æ‹·è´æ–‡ä»¶åœ°å€çš„æ–‡ä»¶å¤¹å¿…é¡»å­˜åœ¨\n          &#x2F;&#x2F; å¦‚æœæ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±åˆ›å»ºæ–‡ä»¶å¤¹\n          const dirExists &#x3D; await ensureDirExists(assetsPath);\n          dirExists &amp;&amp; (await fs.promises.copyFile(id, filePath));\n          return &#123;\n            code: dataToEsm(relativePath), &#x2F;&#x2F;è¿”å›æ‹·è´ä¹‹åå¤„ç†çš„è·¯å¾„\n            map: &#123; mappings: &quot;&quot; &#125;,\n          &#125;;\n        &#125; else &#123;\n          &#x2F;&#x2F; å¦åˆ™è½¬æ¢ä¸ºbase64æ ¼å¼\n          &#x2F;&#x2F; è¯»å–æ–‡ä»¶\n          const source &#x3D; await fs.promises.readFile(id, format);\n\n          return &#123;\n            code: dataToEsm(getDataUri(&#123; format, isSvg, mime, source &#125;)),\n            map: &#123; mappings: &quot;&quot; &#125;,\n          &#125;;\n        &#125;\n      &#125; catch (err) &#123;\n        const message &#x3D; &quot;å›¾ç‰‡è½¬æ¢å¤±è´¥:&quot; + id;\n        this.error(&#123; message, id, cause: err &#125;);\n        return null;\n      &#125;\n    &#125;,\n  &#125;;\n&#125;\n\nè¾“å‡ºé’©å­æ‰§è¡Œé¡ºåº\n\næ‰§è¡Œæ‰€æœ‰æ’ä»¶çš„ outputOptions é’©å­å‡½æ•°ï¼Œå¯¹ output é…ç½®è¿›è¡Œè½¬æ¢\næ‰§è¡Œ renderStartï¼Œè¯¥é’©å­è¯»å–æ‰€æœ‰ outputOptions é’©å­çš„è½¬æ¢ä¹‹åçš„è¾“å‡ºé€‰é¡¹\næ‰«æ åŠ¨æ€import è¯­å¥æ‰§è¡Œ renderDynamicImport é’©å­ï¼Œè®©å¼€å‘è€…èƒ½è‡ªå®šä¹‰åŠ¨æ€importçš„å†…å®¹ä¸è¡Œä¸º\nå¹¶å‘æ‰§è¡Œæ‰€æœ‰æ’ä»¶çš„ bannerã€footerã€introã€outro é’©å­ï¼Œè¿™å››ä¸ªé’©å­åŠŸèƒ½ç®€å•ï¼Œå°±æ˜¯å¾€æ‰“åŒ…äº§ç‰©çš„å›ºå®šä½ç½®(æ¯”å¦‚å¤´éƒ¨å’Œå°¾éƒ¨)æ’å…¥ä¸€äº›è‡ªå®šä¹‰çš„å†…å®¹ï¼Œæ¯”å¦‚ç‰ˆæœ¬å·ã€ä½œè€…ã€å†…å®¹ã€é¡¹ç›®ä»‹ç»ç­‰ç­‰\næ˜¯å¦å­˜åœ¨ import.meta è¯­å¥ï¼Œæ²¡æœ‰å°±ç›´æ¥è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œå¦åˆ™ï¼šå¯¹äºimport.meta.urlè°ƒç”¨ resolveFileUrl æ¥è‡ªå®šä¹‰ url è§£æé€»è¾‘ã€‚å¯¹äºimport.metaè°ƒç”¨ resolveImportMeta æ¥è¿›è¡Œè‡ªå®šä¹‰å…ƒä¿¡æ¯è§£æ\nç”Ÿæˆ chunk è°ƒç”¨renderChunké’©å­ï¼Œä¾¿äºåœ¨è¯¥é’©å­ä¸­è¿›è¡Œè‡ªå®šä¹‰æ“ä½œã€‚å¦‚æœç”Ÿæˆçš„ chunk æ–‡ä»¶æœ‰ hash å€¼ï¼Œæ‰§è¡Œ augmentChunkHash é’©å­ï¼Œæ¥å†³å®šæ˜¯å¦æ›´æ”¹ chunk çš„å“ˆå¸Œå€¼ã€‚\nè°ƒç”¨ generateBundle é’©å­ï¼Œè¿™ä¸ªé’©å­çš„å…¥å‚é‡Œé¢ä¼šåŒ…å«æ‰€æœ‰çš„æ‰“åŒ…äº§ç‰©ä¿¡æ¯ï¼ŒåŒ…æ‹¬ chunk (æ‰“åŒ…åçš„ä»£ç )ã€asset(æœ€ç»ˆçš„é™æ€èµ„æºæ–‡ä»¶)ã€‚åœ¨è¿™ä¸ªé’©å­ä¸­ä½ åšè‡ªå®šä¹‰è‡ªå·±çš„æ“ä½œï¼Œæ¯”å¦‚ï¼šå¯ä»¥åœ¨è¿™é‡Œåˆ é™¤ä¸€äº› chunk æˆ–è€… assetï¼Œæœ€ç»ˆè¢«åˆ é™¤çš„å†…å®¹å°†ä¸ä¼šä½œä¸ºäº§ç‰©è¾“å‡º\nä¸ŠèŠ‚è¯¾è®²è§£çš„ javascript apiâ€”rollup.rollupæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªbundleå¯¹è±¡ï¼Œbundleå¯¹è±¡çš„ write æ–¹æ³•ï¼Œä¼šè§¦å‘writeBundleé’©å­ï¼Œä¼ å…¥æ‰€æœ‰çš„æ‰“åŒ…äº§ç‰©ä¿¡æ¯ï¼ŒåŒ…æ‹¬ chunk å’Œ assetï¼Œä¸generateBundleé’©å­éå¸¸ç›¸ä¼¼ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯writeBundleé’©å­æ‰§è¡Œçš„æ—¶å€™ï¼Œäº§ç‰©å·²ç»è¾“å‡ºäº†ã€‚è€Œ generateBundle æ‰§è¡Œçš„æ—¶å€™äº§ç‰©è¿˜å¹¶æ²¡æœ‰è¾“å‡ºã€‚ç®€å•æ¥è¯´ï¼Œé¡ºåºæ˜¯ï¼šgenerateBundle---&gt;è¾“å‡ºå¹¶ä¿å­˜äº§ç‰©åˆ°ç£ç›˜---&gt;writeBundle\nå½“bundleçš„closeæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šè§¦å‘closeBundleé’©å­ï¼Œè¿™ä¸ª output é˜¶æ®µç»“æŸ\n\nexport default function myExample2() &#123;\n  return &#123;\n    name: &quot;my-example2&quot;,\n    outputOptions(options) &#123;\n      console.log(&quot;ğŸ‰ ~ options:&quot;, options);\n    &#125;,\n    renderStart(options) &#123;\n      console.log(&quot;âœ¨ ~ renderStart:&quot;, options);\n    &#125;,\n    renderDynamicImport(options) &#123;\n      console.log(&quot;âœ¨~ renderDynamicImport:&quot;, options);\n    &#125;,\n    banner(chunk) &#123;\n      console.log(&quot;ğŸ”¥ ~ banner(chunk):&quot;, chunk);\n      return &quot;&quot;;\n    &#125;,\n    renderChunk(source) &#123;\n      console.log(&quot;ğŸš€ ~ source:&quot;, source);\n      return null;\n    &#125;,\n    augmentChunkHash(chunk) &#123;\n      console.log(&quot;ğŸ‰ ~ augmentChunkHash:&quot;, chunk);\n    &#125;,\n    generateBundle(options, bundle) &#123;\n      console.log(&quot;ğŸŒˆ ~ options:&quot;, options);\n      console.log(&quot;ğŸŒˆ ~ bundle:&quot;, bundle);\n      Object.keys(bundle).forEach((key) &#x3D;&gt; &#123;\n        if (key.includes(&quot;sum&quot;)) &#123;\n          &#x2F;&#x2F;åˆ é™¤å¯¹è±¡ä¸­çš„è¿™ä¸ªé”®å€¼å¯¹\n          delete bundle[key];\n        &#125;\n      &#125;);\n    &#125;,\n    closeBundle() &#123;\n      console.log(&quot;ğŸ˜ ~ closeBundle&quot;);\n    &#125;,\n  &#125;;\n&#125;\n\næ‰“åŒ…å¤§å°å’Œæ—¶é—´ç¤ºä¾‹ï¼šexport default function bundleStats() &#123;\n let startTime;\n return &#123;\n  name: &#39;bundle-stats&#39;,\n  options() &#123;\n   startTime &#x3D; Date.now();\n   &#125;,\n  generateBundle(_, bundle) &#123;\n   const fileSizes &#x3D; &#123;&#125;;\nâ€‹\n   for (const [fileName, output] of Object.entries(bundle)) &#123;\n    if (output.type &#x3D;&#x3D;&#x3D; &#39;chunk&#39;) &#123;\n     const content &#x3D; output.code;\n     const size &#x3D; Buffer.byteLength(content, &#39;utf8&#39;);\n     const sizeInKB &#x3D; (size &#x2F; 1024).toFixed(2);\nâ€‹\n     fileSizes[fileName] &#x3D; &#96;$&#123;sizeInKB&#125; KB&#96;;\n     &#125;\n    &#125;\n   console.log(&#39;Bundle Stats:&#39;);\n   console.log(&#39;-------------&#39;);\n   console.log(&#39;File Sizes:&#39;);\n   console.log(fileSizes);\n   console.log(&#39;-------------&#39;);\n   &#125;,\n  closeBundle() &#123;\n   const totalTime &#x3D; Date.now() - startTime;\n   console.log(&#96;Total Bundle Time: $&#123;totalTime&#125; ms&#96;);\n   console.log(&#39;-------------&#39;);\n   &#125;\n  &#125;;\n&#125;\n\nä»£ç å‹ç¼©import &#123; minify &#125; from &#39;uglify-js&#39;;\nâ€‹\nexport default function uglifyPlugin() &#123;\n return &#123;\n  name: &#39;uglify&#39;,\nâ€‹\n  renderChunk(code) &#123;\n   const result &#x3D; minify(code);\n   if (result.error) &#123;\n    throw new Error(&#96;minify error: $&#123;result.error&#125;&#96;);\n    &#125;\n   return &#123;\n    code: result.code,\n    map: &#123; mappings: &#39;&#39; &#125;\n    &#125;;\n   &#125;,\n  &#125;;\n&#125;\n","slug":"rollup","date":"2024-12-22T08:39:14.000Z","categories_index":"Academic","tags_index":"rollup","author_index":"X-29"},{"id":"6f35d21607cc4ac40e0305fd85e2df31","title":"React-Principle","content":"React-Principleæ­¤æ–‡ç« æ—¨åœ¨äºå‰–æ React çš„ä¸€äº›åŸºæœ¬åŸç†ï¼Œå¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£ React çš„å·¥ä½œåŸç†ã€‚å¹¶å†™å‡ºå±äºè‡ªå·±çš„ React ä»£ç ã€‚\nå‰ç½®ä»»åŠ¡æ­å»ºç›®å½•ä»¥åŠé…ç½®ä¸€äº›å·¥å…·First of allï¼\nâ”œâ”€â”€ packages| â”œâ”€â”€ react| | â”œâ”€â”€ src| | â”œâ”€â”€ index.ts| | â””â”€â”€ package.json| â”œâ”€â”€ react-reconciler| | â””â”€â”€ package.json| â””â”€â”€ shared| â”œâ”€â”€ package.json| â”œâ”€â”€ ReactSymbols.ts| â””â”€â”€ ReactTypes.tsâ”œâ”€â”€ scripts| â””â”€â”€ rollup| â”œâ”€â”€ react.config.js| â””â”€â”€ utils.jsâ”œâ”€â”€ .gitignoreâ”œâ”€â”€ .prettier.jsonâ”œâ”€â”€ eslint.config.jsâ”œâ”€â”€ package-lock.jsonâ”œâ”€â”€ package.jsonâ”œâ”€â”€ README.mdâ””â”€â”€ tsconfig.json\nå®‰è£…ä¾èµ–æ ¹ç›®å½•çš„package.jsonæ–‡ä»¶åœ¨æ ¹ç›®å½•çš„package.jsonæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€äº›ä¾èµ–å¹¶é…ç½®å¥½ scripts å‘½ä»¤ï¼š\n&#123;\n  &quot;name&quot;: &quot;react&quot;,\n  &quot;version&quot;: &quot;1.0.0&quot;,\n  &quot;main&quot;: &quot;index.js&quot;,\n  &quot;scripts&quot;: &#123;\n    &quot;lint&quot;: &quot;eslint .&#x2F;packages&quot;,\n    &quot;build:dev&quot;: &quot;rimraf dist &amp;&amp; rollup --bundleConfigAsCjs --config scripts&#x2F;rollup&#x2F;react.config.js&quot;\n  &#125;,\n  &quot;keywords&quot;: [],\n  &quot;author&quot;: &quot;x29&quot;,\n  &quot;license&quot;: &quot;ISC&quot;,\n  &quot;description&quot;: &quot;&quot;,\n  &quot;devDependencies&quot;: &#123;\n    &quot;@eslint&#x2F;js&quot;: &quot;^9.15.0&quot;,\n    &quot;@rollup&#x2F;plugin-commonjs&quot;: &quot;^28.0.1&quot;,\n    &quot;@types&#x2F;node&quot;: &quot;^22.9.3&quot;,\n    &quot;@types&#x2F;rollup-plugin-generate-package-json&quot;: &quot;^3.2.9&quot;,\n    &quot;@typescript-eslint&#x2F;eslint-plugin&quot;: &quot;^8.15.0&quot;,\n    &quot;@typescript-eslint&#x2F;parser&quot;: &quot;^8.15.0&quot;,\n    &quot;eslint&quot;: &quot;^9.15.0&quot;,\n    &quot;eslint-config-prettier&quot;: &quot;^9.1.0&quot;,\n    &quot;eslint-plugin-prettier&quot;: &quot;^5.2.1&quot;,\n    &quot;prettier&quot;: &quot;^3.3.3&quot;,\n    &quot;rimraf&quot;: &quot;^6.0.1&quot;,\n    &quot;rollup&quot;: &quot;^4.27.3&quot;,\n    &quot;rollup-plugin-generate-package-json&quot;: &quot;^3.2.0&quot;,\n    &quot;rollup-plugin-typescript2&quot;: &quot;^0.36.0&quot;,\n    &quot;typescript&quot;: &quot;^5.6.3&quot;\n  &#125;\n&#125;\n\ntsconfig.jsonåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºtsconfig.jsonæ–‡ä»¶ï¼Œå¹¶é…ç½®å¥½ç¼–è¯‘é€‰é¡¹ï¼š\n&#123;\n  &quot;compileOnSave&quot;: true,\n  &quot;compilerOptions&quot;: &#123;\n    &quot;target&quot;: &quot;ESNext&quot;,\n    &quot;useDefineForClassFields&quot;: true,\n    &quot;module&quot;: &quot;ESNext&quot;,\n    &quot;lib&quot;: [&quot;ESNext&quot;, &quot;DOM&quot;],\n    &quot;moduleResolution&quot;: &quot;Node&quot;,\n    &quot;strict&quot;: true,\n    &quot;sourceMap&quot;: true,\n    &quot;resolveJsonModule&quot;: true,\n    &quot;isolatedModules&quot;: true,\n    &quot;esModuleInterop&quot;: true,\n    &quot;noEmit&quot;: true,\n    &quot;noUnusedLocals&quot;: true,\n    &quot;noUnusedParameters&quot;: true,\n    &quot;noImplicitReturns&quot;: false,\n    &quot;skipLibCheck&quot;: true,\n    &quot;baseUrl&quot;: &quot;.&#x2F;packages&quot;\n  &#125;\n&#125;\n\neslint.config.jsimport eslint from &quot;@eslint&#x2F;js&quot;;\nimport tseslint from &quot;@typescript-eslint&#x2F;eslint-plugin&quot;;\nimport tsparser from &quot;@typescript-eslint&#x2F;parser&quot;;\nimport prettier from &quot;eslint-plugin-prettier&quot;;\nimport eslintConfigPrettier from &quot;eslint-config-prettier&quot;;\n\nexport default [\n  &#x2F;&#x2F; åŸºç¡€ ESLint é…ç½®\n  eslint.configs.recommended,\n\n  &#x2F;&#x2F; Prettier é…ç½®\n  eslintConfigPrettier,\n\n  &#123;\n    files: [&quot;**&#x2F;*.ts&quot;, &quot;**&#x2F;*.tsx&quot;],\n    languageOptions: &#123;\n      parser: tsparser,\n      parserOptions: &#123;\n        ecmaVersion: &quot;latest&quot;,\n        sourceType: &quot;module&quot;,\n      &#125;,\n    &#125;,\n    plugins: &#123;\n      &quot;@typescript-eslint&quot;: tseslint,\n      prettier: prettier,\n    &#125;,\n    rules: &#123;\n      &quot;prettier&#x2F;prettier&quot;: &quot;error&quot;,\n      &quot;no-case-declarations&quot;: &quot;off&quot;,\n      &quot;no-constant-condition&quot;: &quot;off&quot;,\n      &quot;@typescript-eslint&#x2F;ban-ts-comment&quot;: &quot;off&quot;,\n      &quot;@typescript-eslint&#x2F;no-var-requires&quot;: &quot;off&quot;,\n      &quot;react&#x2F;react-in-jsx-scope&quot;: &quot;off&quot;,\n      &quot;prettier&#x2F;prettier&quot;: [\n        &quot;error&quot;,\n        &#123;\n          endOfLine: &quot;auto&quot;,\n        &#125;,\n      ],\n    &#125;,\n  &#125;,\n];\n\n.prettier.json&#123;\n  &quot;printWidth&quot;: 80,\n  &quot;tabWidth&quot;: 2,\n  &quot;useTabs&quot;: true,\n  &quot;singleQuote&quot;: true,\n  &quot;semi&quot;: true,\n  &quot;trailingComma&quot;: &quot;none&quot;,\n  &quot;bracketSpacing&quot;: true\n&#125;\n\næ‰“åŒ…è„šæœ¬rollup.config.jsåœ¨scriptsç›®å½•ä¸‹åˆ›å»ºrollup.config.jsæ–‡ä»¶ï¼Œå¹¶é…ç½®æ‰“åŒ…é€‰é¡¹ï¼š::: warningæ³¨æ„ï¼šrollup.config.jsæ–‡ä»¶éœ€è¦ä½¿ç”¨commonjsæ¨¡å—è§„èŒƒï¼Œå› ä¸ºrollupé»˜è®¤ä½¿ç”¨esmæ¨¡å—è§„èŒƒï¼Œè€Œnodeç¯å¢ƒä¸æ”¯æŒesmæ¨¡å—è§„èŒƒã€‚å¹¶ä¸”ä¸€å®šè¦æ˜¯jsæ–‡ä»¶ï¼Œä¸èƒ½æ˜¯tsæ–‡ä»¶ã€‚:::\nimport &#123; getBaseRollupPlugins, getPackageJSON, resolvePkgPath &#125; from &quot;.&#x2F;utils&quot;;\n\nimport generatePackageJson from &quot;rollup-plugin-generate-package-json&quot;;\n\n&#x2F;&#x2F; è·å–package.jsonä¸‹é¢çš„nameå­—æ®µ\nconst &#123; name, module &#125; &#x3D; getPackageJSON(&quot;react&quot;, false); &#x2F;&#x2F; react\n&#x2F;&#x2F; reactåŒ…çš„è·¯å¾„\nconst pkgPath &#x3D; resolvePkgPath(name, false);\n&#x2F;&#x2F;react äº§ç‰©è·¯åŠ²\nconst pkgDistPath &#x3D; resolvePkgPath(name, true);\nexport default [\n  &#x2F;&#x2F; å¯¹åº”reactåŒ…\n  &#123;\n    input: &#96;$&#123;pkgPath&#125;&#x2F;$&#123;module&#125;&#96;,\n    output: &#123;\n      file: &#96;$&#123;pkgDistPath&#125;&#x2F;index.js&#96;,\n      name: &quot;react&quot;,\n      format: &quot;umd&quot;,\n    &#125;,\n    plugins: [\n      ...getBaseRollupPlugins(),\n      generatePackageJson(&#123;\n        inputFolder: pkgPath,\n        outputFolder: pkgDistPath,\n        baseContents: (&#123; name, description, version &#125;) &#x3D;&gt; (&#123;\n          name,\n          description,\n          version,\n          main: &quot;index.js&quot;,\n        &#125;),\n      &#125;),\n    ],\n  &#125;,\n  &#x2F;&#x2F; jsx-runtimeåŒ…\n  &#123;\n    input: &#96;$&#123;pkgPath&#125;&#x2F;src&#x2F;jsx.ts&#96;,\n    output: [\n      &#x2F;&#x2F; jsx-runtime\n      &#123;\n        file: &#96;$&#123;pkgDistPath&#125;&#x2F;jsx-runtime.js&#96;,\n        name: &quot;jsx-runtime.js&quot;,\n        format: &quot;umd&quot;,\n      &#125;,\n      &#123;\n        file: &#96;$&#123;pkgDistPath&#125;&#x2F;jsx-dev-runtime.js&#96;,\n        name: &quot;jsx-dev-runtime.js&quot;,\n        format: &quot;umd&quot;,\n      &#125;,\n    ],\n    plugins: getBaseRollupPlugins(),\n  &#125;,\n];\n\nutils.jsåœ¨scriptsç›®å½•ä¸‹åˆ›å»ºutils.jsæ–‡ä»¶ï¼Œå¹¶é…ç½®ä¸€äº›å·¥å…·å‡½æ•°ï¼š\nimport path from &quot;path&quot;;\nimport fs from &quot;fs&quot;;\nimport ts from &quot;rollup-plugin-typescript2&quot;;\nimport cjs from &quot;@rollup&#x2F;plugin-commonjs&quot;;\n\n&#x2F;&#x2F; åŒ…è·¯å¾„\nconst pkgPath &#x3D; path.resolve(__dirname, &quot;..&#x2F;..&#x2F;packages&quot;);\n&#x2F;&#x2F; æ‰“åŒ…äº§ç‰©è·¯å¾„\nconst distPath &#x3D; path.resolve(__dirname, &quot;..&#x2F;..&#x2F;dist&#x2F;node_modules&quot;);\n\n&#x2F;**\n * @name è·å–åŒ…è·¯å¾„æˆ–è€…æ˜¯æ‰“åŒ…äº§ç‰©è·¯å¾„\n * @param pkgName\n * @param isDist æ˜¯å¦æ˜¯æ‰“åŒ…\n *&#x2F;\nexport const resolvePkgPath &#x3D; (pkgName, isDist) &#x3D;&gt; &#123;\n  return isDist ? &#96;$&#123;distPath&#125;&#x2F;$&#123;pkgName&#125;&#96; : &#96;$&#123;pkgPath&#125;&#x2F;$&#123;pkgName&#125;&#96;;\n&#125;;\n\n&#x2F;**\n * @name è§£æåŒ…å¯¹åº”çš„package.jsonæ–‡ä»¶\n * @param pkgName\n *&#x2F;\nexport const getPackageJSON &#x3D; (pkgName, isDist) &#x3D;&gt; &#123;\n  &#x2F;&#x2F;1. åŒ…è·¯å¾„ + Package.json\n  const path &#x3D; &#96;$&#123;resolvePkgPath(pkgName, isDist)&#125;&#x2F;package.json&#96;;\n  const str &#x3D; fs.readFileSync(path, &#123; encoding: &quot;utf-8&quot; &#125;);\n  return JSON.parse(str);\n&#125;;\n\nexport const getBaseRollupPlugins &#x3D; (&#123; typeScriptConfig &#x3D; &#123;&#125; &#125; &#x3D; &#123;&#125;) &#x3D;&gt; [\n  cjs(),\n  ts(typeScriptConfig),\n];\n\npackage&#x2F;reactè¯¥ç›®å½•ä¸‹çš„package.jsonæ–‡ä»¶\n&#123;\n  &quot;name&quot;: &quot;react&quot;,\n  &quot;version&quot;: &quot;1.0.0&quot;,\n  &quot;main&quot;: &quot;index.js&quot;,\n  &quot;module&quot;: &quot;index.ts&quot;,\n  &quot;dependencies&quot;: &#123;\n    &quot;shared&quot;: &quot;workspace:*&quot;\n  &#125;,\n  &quot;scripts&quot;: &#123;\n    &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;\n  &#125;,\n  &quot;keywords&quot;: [],\n  &quot;author&quot;: &quot;x29&quot;,\n  &quot;license&quot;: &quot;ISC&quot;,\n  &quot;description&quot;: &quot;reactå…¬å…±æ–¹æ³•&quot;\n&#125;\n\nå…¶ä¸­ package&#x2F;index.ts å’Œ package&#x2F;src&#x2F;jsx.ts æ–‡ä»¶å…ˆéšä¾¿å†™ç‚¹ä»€ä¹ˆ ts ä»£ç ï¼Œä¸ºäº†npm run build:devå‘½ä»¤å¯ä»¥æ­£å¸¸è¿è¡Œã€‚package&#x2F;src&#x2F;jsx.ts çš„ç›®å½•å’Œæ–‡ä»¶ååœ¨ rollup.config.js ä¸­é…ç½®ä¸€ä¸€å¯¹åº”çš„\npackage&#x2F;sharedè¯¥ç›®å½•ä¸‹çš„package.jsonæ–‡ä»¶\n&#123;\n  &quot;name&quot;: &quot;shared&quot;,\n  &quot;version&quot;: &quot;1.0.0&quot;,\n  &quot;main&quot;: &quot;index.js&quot;,\n  &quot;scripts&quot;: &#123;\n    &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;\n  &#125;,\n  &quot;keywords&quot;: [],\n  &quot;author&quot;: &quot;x29&quot;,\n  &quot;license&quot;: &quot;ISC&quot;,\n  &quot;description&quot;: &quot;æ‰€æœ‰å…¬å…±æ–¹æ³•ä»¥åŠç±»å‹å®šä¹‰&quot;\n&#125;\n\npackage&#x2F;react-reconcilerè¯¥ç›®å½•ä¸‹çš„package.jsonæ–‡ä»¶\n&#123;\n  &quot;name&quot;: &quot;react-reconciler&quot;,\n  &quot;version&quot;: &quot;1.0.0&quot;,\n  &quot;main&quot;: &quot;index.js&quot;,\n  &quot;scripts&quot;: &#123;\n    &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;\n  &#125;,\n  &quot;keywords&quot;: [],\n  &quot;author&quot;: &quot;x29&quot;,\n  &quot;license&quot;: &quot;ISC&quot;,\n  &quot;description&quot;: &quot;&quot;\n&#125;\n\nè‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†é¡¹ç›®çš„ç›®å½•ç»“æ„ä»¥åŠä¸€äº›ä¾èµ–çš„å®‰è£…ã€‚åœ¨æ ¹ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œnpm run build:devå‘½ä»¤è¿›è¡Œé¡¹ç›®çš„æ‰“åŒ…ã€‚npm run lintå‘½ä»¤å¯ä»¥å¯¹é¡¹ç›®çš„ä»£ç è¿›è¡Œ eslint æ£€æŸ¥ã€‚\njsxåŸºæœ¬ä»‹ç»React ä¸»è¦æ˜¯å°†é¡µé¢çš„ç»“æ„é€šè¿‡ jsx è¿›è¡Œæè¿°ï¼Œåœ¨è°ƒå’Œåï¼Œæ¯ä¸€ä¸ª React element å¯¹è±¡çš„å­èŠ‚ç‚¹éƒ½ä¼šå½¢æˆä¸€ä¸ªå¯¹åº”çš„ fiberNode\næœ¬èŠ‚å†…å®¹ä¸»è¦æ˜¯å®ç° jsx çš„ç”Ÿæˆã€‚åœ¨ React çš„æºç ä¸­ï¼Œjsx çš„ä»£ç é€»è¾‘å­˜åœ¨ packages ä¸‹é¢çš„ react åŒ…ä¸­ã€‚ä¸ºäº†å…¼å®¹ React çš„æ—§ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯å®ç°æœ€åå¯¼å‡ºä¸‰ä¸ªæ–‡ä»¶ã€‚\nindex.js: import React from &#39;react&#39; è¿™æ ·ä½¿ç”¨jsx-runtime.js: æ–°ç‰ˆé€šè¿‡ babel å¯¼å…¥jsx-dev-runtime.js: å¼€å‘ç¯å¢ƒçš„åŒ…\nä¸ºäº†å¼€å‘è€…æ–¹ä¾¿ï¼ŒReact æä¾›ä¸€ç§ç±»ä¼¼äº html çš„æ–¹å¼å»ä¹¦å†™ä»£ç ï¼Œç„¶å React é€šè¿‡ babel å»è¿›è¡Œè½¬ä¹‰ã€‚åœ¨ React çš„æ–°ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦æ‰‹åŠ¨å»å¼•å…¥ React, plugin-syntax-jsx å·²ç»å‘æ–‡ä»¶ä¸­æå‰æ³¨å…¥äº† _jsxRuntime apiã€‚\n&lt;div className&#x3D;&quot;x&quot;&gt;\n  123\n  &lt;span&gt;yx&lt;&#x2F;span&gt;\n&lt;&#x2F;div&gt;\n\næ–°ç‰ˆAutomaticimport &#123; jsx as _jsx &#125; from &quot;react&#x2F;jsx-runtime&quot;;\nimport &#123; jsxs as _jsxs &#125; from &quot;react&#x2F;jsx-runtime&quot;;\n&#x2F;*#__PURE__*&#x2F; _jsxs(&quot;div&quot;, &#123;\n  className: &quot;x&quot;,\n  children: [\n    &quot;123&quot;,\n    &#x2F;*#__PURE__*&#x2F; _jsx(&quot;span&quot;, &#123;\n      children: &quot;yx&quot;,\n    &#125;),\n  ],\n&#125;);\n\næ—§ç‰ˆClassic&#x2F;*#__PURE__*&#x2F; React.createElement(\n  &quot;div&quot;,\n  &#123;\n    className: &quot;x&quot;,\n  &#125;,\n  &quot;123&quot;,\n  &#x2F;*#__PURE__*&#x2F; React.createElement(&quot;span&quot;, null, &quot;yx&quot;)\n);\n\n\n\n\n\n\n\n\n\n\nä¸»è¦æ˜¯åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š1. å¯¹åº”çš„ tag å­—æ®µï¼Œ 2. å±æ€§å’Œ childrenï¼Œ 3. key ç­‰ä¸€äº›ç‰¹æ®Šå­—æ®µã€‚\nå®ç° JSXå£°æ˜ç±»å‹åœ¨ packages/shared/ReactTypes.ts æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å£°æ˜äº† JSX ç›¸å…³çš„ç±»å‹ã€‚\n&#x2F;** åœ¨è¿™é‡Œé›†ä¸­å®šä¹‰Reactçš„ç±»å‹ *&#x2F;\n\n&#x2F;** å®šä¹‰ React çš„ Type ç±»å‹ *&#x2F;\nexport type Type &#x3D; any;\n\n&#x2F;** å®šä¹‰ React çš„ Key ç±»å‹ *&#x2F;\nexport type Key &#x3D; string | null;\n\n&#x2F;** å®šä¹‰ React çš„ Ref ç±»å‹ *&#x2F;\nexport type Ref&lt;T &#x3D; any&gt; &#x3D;\n  | &#123; current: T | null &#125;\n  | ((instance: T | null) &#x3D;&gt; void)\n  | null;\n\n&#x2F;** å®šä¹‰ React çš„ Props ç±»å‹ *&#x2F;\nexport type Props &#x3D; &#123;\n  [key: string]: any;\n  children?: any;\n&#125;;\n\n&#x2F;** å®šä¹‰ React çš„ ElementType ç±»å‹ *&#x2F;\nexport type ElementType &#x3D; string | ((props: any) &#x3D;&gt; ReactElementType | null);\n\n&#x2F;** å®šä¹‰ React çš„ ReactElement ç±»å‹ *&#x2F;\nexport interface ReactElementType &#123;\n  $$typeof: symbol | number;\n  type: ElementType;\n  key: Key;\n  ref: Ref;\n  props: Props;\n  __mark: string;\n&#125;\n\nåœ¨ packages/shared/ReactSymbols.ts æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å£°æ˜äº† JSX ç›¸å…³çš„ symbolã€‚\n&#x2F;**\n * åˆ¤æ–­å½“å‰ç¯å¢ƒæ˜¯å¦æ”¯æŒ Symbol åŠå…¶ for æ–¹æ³•\n * 1. typeof Symbol &#x3D;&#x3D;&#x3D; &#39;function&#39; æ£€æŸ¥ Symbol æ˜¯å¦å¯ç”¨ä¸”æ˜¯å‡½æ•°ç±»å‹\n * 2. Symbol.for æ£€æŸ¥æ˜¯å¦æ”¯æŒå…¨å±€ Symbol æ³¨å†Œè¡¨åŠŸèƒ½\n * 3. åœ¨è¾ƒè€çš„æµè§ˆå™¨ä¸­å¯èƒ½ä¸æ”¯æŒ Symbolï¼Œæ­¤æ—¶è¿”å› false\n *&#x2F;\nconst supportSymbol &#x3D; typeof Symbol &#x3D;&#x3D;&#x3D; &quot;function&quot; &amp;&amp; Symbol.for;\n\n&#x2F;**\n * 1. Symbol.for() æ˜¯ä»€ä¹ˆï¼š\n *   - è¿™æ˜¯ JavaScript çš„å…¨å±€ Symbol æ³¨å†Œè¡¨åŠŸèƒ½\n *   - Symbol.for(&#39;react.element&#39;) ä¼šåˆ›å»ºä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ Symbol\n *   - å¦‚æœå·²ç»å­˜åœ¨åŒåçš„ Symbolï¼Œåˆ™è¿”å›å·²å­˜åœ¨çš„é‚£ä¸ª\n *   - è¿™ç¡®ä¿äº†åœ¨ä¸åŒçš„æ¨¡å—ä¸­ä½¿ç”¨ç›¸åŒçš„å­—ç¬¦ä¸²åˆ›å»ºçš„ Symbol æ˜¯å®Œå…¨ç›¸åŒçš„\n * 2.ä¸ºä»€ä¹ˆéœ€è¦é™çº§æ–¹æ¡ˆ 0xeac7ï¼š\n *   - ä¸æ˜¯æ‰€æœ‰ JavaScript ç¯å¢ƒéƒ½æ”¯æŒ Symbolï¼ˆæ¯”å¦‚è€ç‰ˆæœ¬æµè§ˆå™¨ï¼‰\n *   - 0xeac7 æ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶æ•°å­—ï¼Œä½œä¸ºé™çº§åçš„æ ‡è¯†ç¬¦\n *   - è¿™ä¸ªæ•°å­—æ˜¯ React å›¢é˜Ÿé€‰æ‹©çš„ä¸€ä¸ªç‰¹å®šå€¼ï¼Œç”¨æ¥æ ‡è¯† React å…ƒç´ \n * 3. è¿™ä¸ªå€¼çš„ç”¨é€”ï¼š\n *   - ç”¨æ¥æ ‡è¯†ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯åˆæ³•çš„ React å…ƒç´ \n *   - åœ¨ ReactElement æ¥å£ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°æœ‰ $$typeof å±æ€§\n *   - $$typeof å°±ä¼šè¢«èµ‹å€¼ä¸º REACT_ELEMENT_TYPE\n *   - React å†…éƒ¨ä¼šæ£€æŸ¥è¿™ä¸ªå€¼æ¥ç¡®ä¿å…ƒç´ çš„åˆæ³•æ€§ *&#x2F;\nexport const REACT_ELEMENT_TYPE &#x3D; supportSymbol\n  ? Symbol.for(&quot;react.element&quot;)\n  : 0xeac7;\n\nå®ç° JSXåœ¨ packages/react/src/jsx.ts æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å®ç° JSX çš„é€»è¾‘ã€‚\nimport &#123; REACT_ELEMENT_TYPE &#125; from &quot;shared&#x2F;ReactSymbols&quot;;\nimport &#123;\n  ElementType,\n  Key,\n  Props,\n  ReactElementType,\n  Ref,\n  Type,\n&#125; from &quot;shared&#x2F;ReactTypes&quot;;\n\n&#x2F;**\n * åˆ›å»º React å…ƒç´ çš„æ ¸å¿ƒå‡½æ•°\n * @param type å…ƒç´ ç±»å‹ - å¯ä»¥æ˜¯å­—ç¬¦ä¸²(åŸç”Ÿ DOM å…ƒç´ )æˆ–å‡½æ•°(ç»„ä»¶)\n * @param key ç”¨äºæ ‡è¯†å…ƒç´ çš„å”¯ä¸€é”®å€¼ï¼Œå¸®åŠ© React è¿›è¡Œé«˜æ•ˆçš„ DOM diff\n * @param ref å¼•ç”¨å¯¹è±¡ï¼Œç”¨äºè®¿é—® DOM èŠ‚ç‚¹æˆ–ç»„ä»¶å®ä¾‹\n * @param props å…ƒç´ çš„å±æ€§å¯¹è±¡ï¼ŒåŒ…å«æ‰€æœ‰ä¼ å…¥çš„å±æ€§å’Œå­å…ƒç´ \n * @returns è¿”å›ä¸€ä¸ª React å…ƒç´ å¯¹è±¡\n *&#x2F;\nconst ReactElement &#x3D; (\n  type: Type,\n  key: Key,\n  ref: Ref,\n  props: Props\n): ReactElementType &#x3D;&gt; (&#123;\n  &#x2F;&#x2F; æ ‡è¯†è¿™æ˜¯ä¸€ä¸ª React å…ƒç´ çš„å†…éƒ¨ç±»å‹æ ‡è®°\n  $$typeof: REACT_ELEMENT_TYPE,\n  &#x2F;&#x2F; å…ƒç´ ç±»å‹ï¼ˆdiv, p, æˆ–è‡ªå®šä¹‰ç»„ä»¶ç­‰ï¼‰\n  type,\n  &#x2F;&#x2F; ç”¨äºä¼˜åŒ–æ›´æ–°çš„ key å€¼\n  key,\n  &#x2F;&#x2F; DOM æˆ–ç»„ä»¶å®ä¾‹çš„å¼•ç”¨\n  ref,\n  &#x2F;&#x2F; å…ƒç´ çš„æ‰€æœ‰å±æ€§\n  props,\n  &#x2F;&#x2F; è‡ªå®šä¹‰æ ‡è®°ï¼Œç”¨äºæ ‡è¯†è¿™æ˜¯æˆ‘ä»¬çš„ React å®ç°\n  __mark: &quot;x-react&quot;,\n&#125;);\n\n&#x2F;**\n * ä»é…ç½®å¯¹è±¡ä¸­æå–å¹¶å¤„ç† keyã€ref å’Œå…¶ä»– props\n * @param &#123;Config&#125; Jsx.JsxConfig - React å…ƒç´ çš„é…ç½®å¯¹è±¡\n * @returns &#123;[Key, Ref, Props]&#125; è¿”å›ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«å¤„ç†åçš„ keyã€ref å’Œ props\n *\n * @description\n * 1. é€šè¿‡è§£æ„è·å– key å’Œ refï¼Œè®¾ç½®é»˜è®¤å€¼ä¸º null\n * 2. å°† key è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼ˆå¦‚æœå­˜åœ¨ï¼‰\n * 3. ä½¿ç”¨ reduce å¤„ç†å‰©ä½™çš„ propsï¼Œç¡®ä¿åªåŒ…å«å¯¹è±¡è‡ªèº«çš„å±æ€§\n * 4. è¿”å›å¤„ç†åçš„ [key, ref, props] å…ƒç»„\n *&#x2F;\nconst extractPropsFromConfig &#x3D; (config: Jsx.JsxConfig): [Key, Ref, Props] &#x3D;&gt; &#123;\n  const &#123; key &#x3D; null, ref &#x3D; null, ...props &#125; &#x3D; config;\n  return [\n    key !&#x3D; null ? String(key) : null,\n    ref,\n    Object.keys(props).reduce((acc, prop) &#x3D;&gt; &#123;\n      if (&#123;&#125;.hasOwnProperty.call(config, prop)) &#123;\n        acc[prop] &#x3D; props[prop];\n      &#125;\n      return acc;\n    &#125;, &#123;&#125; as Props),\n  ];\n&#125;;\n\n&#x2F;**\n * å¤„ç†å¹¶åˆå¹¶ children åˆ° props ä¸­\n * @param &#123;Props&#125; props - åŸå§‹çš„ props å¯¹è±¡\n * @param &#123;any[]&#125; children - å­å…ƒç´ æ•°ç»„\n * @returns &#123;Props&#125; è¿”å›åˆå¹¶äº† children çš„æ–° props å¯¹è±¡\n *\n * @description\n * 1. å¦‚æœæ²¡æœ‰ childrenï¼Œç›´æ¥è¿”å›åŸå§‹ props\n * 2. å¦‚æœåªæœ‰ä¸€ä¸ª childï¼Œç›´æ¥ä½¿ç”¨è¯¥ child\n * 3. å¦‚æœæœ‰å¤šä¸ª childrenï¼Œä¿æŒæ•°ç»„å½¢å¼\n * 4. ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦åˆ›å»ºæ–°çš„ props å¯¹è±¡ï¼Œç¡®ä¿ä¸ä¿®æ”¹åŸå§‹å¯¹è±¡\n *&#x2F;\nconst processChildren &#x3D; (props: Props, children: any[]): Props &#x3D;&gt; &#123;\n  if (children.length &#x3D;&#x3D;&#x3D; 0) return props;\n\n  return &#123;\n    ...props,\n    children: children.length &#x3D;&#x3D;&#x3D; 1 ? children[0] : children,\n  &#125;;\n&#125;;\n\n&#x2F;**\n * JSX è½¬æ¢å‡½æ•° - å°† JSX è¯­æ³•è½¬æ¢ä¸º React å…ƒç´ \n * @param &#123;ElementType&#125; type - å…ƒç´ ç±»å‹ï¼ˆå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–ç»„ä»¶å‡½æ•°ï¼‰\n * @param &#123;Config&#125; Jsx.JsxConfig - å…ƒç´ çš„é…ç½®å¯¹è±¡ï¼ŒåŒ…å« propsã€keyã€ref ç­‰\n * @param &#123;...any&#125; children - å­å…ƒç´ åˆ—è¡¨\n * @returns &#123;ReactElementType&#125; è¿”å›åˆ›å»ºçš„ React å…ƒç´ \n *\n * @description\n * 1. é¦–å…ˆä»é…ç½®ä¸­æå–å¿…è¦çš„å±æ€§\n * 2. å¤„ç†å¹¶æ·»åŠ  children\n * 3. ä½¿ç”¨è¿™äº›å¤„ç†åçš„å€¼åˆ›å»º React å…ƒç´ \n *\n * @description\n * * å®Œæ•´çš„å¤„ç†æµç¨‹ï¼š\n * 1. jsx(&#39;div&#39;, &#123; className: &#39;container&#39; &#125;, child1, child2) è¢«è°ƒç”¨\n * 2. extractPropsFromConfig å¤„ç†é…ç½®å¯¹è±¡ï¼š\n *    - æå– key å’Œ refï¼ˆå¦‚æœæœ‰ï¼‰\n *    - å¤„ç†å…¶ä½™å±æ€§ï¼ˆå¦‚ className, onClick ç­‰ï¼‰\n * 3. processChildren å¤„ç†å­å…ƒç´ ï¼š\n *    - å°†æ‰€æœ‰å­å…ƒç´ è§„èŒƒåŒ–å¤„ç†\n *    - æ·»åŠ åˆ° props.children ä¸­\n * 4. ReactElement åˆ›å»ºæœ€ç»ˆçš„ React å…ƒç´ å¯¹è±¡\n * 5. è¿”å›çš„å…ƒç´ å¯¹è±¡å°†è¢« React ç”¨äºåç»­çš„æ¸²æŸ“æµç¨‹\n *&#x2F;\nexport const jsx &#x3D; (\n  type: ElementType,\n  config: Jsx.JsxConfig,\n  ...children: any\n) &#x3D;&gt; &#123;\n  &#x2F;&#x2F; ç¬¬ä¸€æ­¥ï¼šæå–å’Œå¤„ç†é…ç½®\n  const [key, ref, props] &#x3D; extractPropsFromConfig(config);\n  &#x2F;&#x2F; ç¬¬äºŒæ­¥ï¼šå¤„ç†å­å…ƒç´ \n  const propsWithChildren &#x3D; processChildren(props, children);\n\n  &#x2F;&#x2F; ç¬¬ä¸‰æ­¥ï¼šåˆ›å»º React å…ƒç´ \n  return ReactElement(type, key, ref, propsWithChildren);\n\n  &#x2F;* è¿”å›çš„å¯¹è±¡å½¢å¦‚ï¼š\n   &#123;\n     $$typeof: Symbol(react.element),\n     type: &#39;div&#39;,\n     props: &#123;\n       className: &#39;container&#39;,\n       children: &#123;\n         $$typeof: Symbol(react.element),\n         type: &#39;span&#39;,\n         props: &#123; children: &#39;Hello&#39; &#125;\n       &#125;\n     &#125;\n   &#125; *&#x2F;\n&#125;;\n\n&#x2F;**\n * å¼€å‘ç¯å¢ƒä½¿ç”¨çš„ JSX è½¬æ¢å‡½æ•°\n * @param &#123;ElementType&#125; type - å…ƒç´ ç±»å‹\n * @param &#123;Config&#125; Jsx.JsxConfig - å…ƒç´ é…ç½®å¯¹è±¡\n * @returns &#123;ReactElementType&#125; è¿”å›åˆ›å»ºçš„ React å…ƒç´ \n *\n * @description\n * 1. å¼€å‘ç¯å¢ƒç‰ˆæœ¬ï¼Œä¸å¤„ç† children\n * 2. ç”¨äºå¼€å‘å·¥å…·å’Œè°ƒè¯•\n * 3. ä¿æŒä¸ç”Ÿäº§ç‰ˆæœ¬ç›¸åŒçš„åŸºæœ¬ç»“æ„ï¼Œä½†å¯èƒ½åŒ…å«é¢å¤–çš„å¼€å‘æ—¶æ£€æŸ¥\n *\n * @description å¼€å‘ç¯å¢ƒçš„ JSX è½¬æ¢å‡½æ•°\n * ä¸ç”Ÿäº§ç‰ˆæœ¬çš„ä¸»è¦åŒºåˆ«ï¼š\n * 1. å¯ä»¥è¿›è¡Œé¢å¤–çš„ç±»å‹æ£€æŸ¥\n * 2. å¯ä»¥æä¾›æ›´å¥½çš„é”™è¯¯ä¿¡æ¯\n * 3. å¯ä»¥è¿›è¡Œå¼€å‘æ—¶çš„è­¦å‘Šæç¤º\n * 4. å¯ä»¥æ·»åŠ å¼€å‘å·¥å…·æ‰€éœ€çš„è°ƒè¯•ä¿¡æ¯\n *&#x2F;\nexport const jsxDev &#x3D; (type: ElementType, config: Jsx.JsxConfig) &#x3D;&gt; &#123;\n  const [key, ref, props] &#x3D; extractPropsFromConfig(config);\n  return ReactElement(type, key, ref, props);\n&#125;;\n\næ•´ä½“ jsx å‡½æ•°çš„è°ƒç”¨æµç¨‹\n\nJSX ä»£ç ï¼š\n\nfunction App() &#123;\n  return (\n    &lt;div className&#x3D;&quot;container&quot;&gt;\n      &lt;span&gt;Hello&lt;&#x2F;span&gt;\n    &lt;&#x2F;div&gt;\n  );\n&#125;\n\n\nBabel è½¬ä¹‰åçš„ä»£ç ï¼š\n\nfunction App() &#123;\n  return jsx(&quot;div&quot;, &#123; className: &quot;container&quot; &#125;, jsx(&quot;span&quot;, null, &quot;Hello&quot;));\n&#125;\n\njsx å‡½æ•°çš„ä½œç”¨å°±æ˜¯æ¥æ”¶ Babel è½¬æ¢åçš„å‚æ•°ï¼Œå¹¶åˆ›å»ºå‡º React å…ƒç´ ï¼ˆè™šæ‹Ÿ DOM èŠ‚ç‚¹ï¼‰\n\næœ€ç»ˆç”Ÿæˆçš„ React å…ƒç´ ç»“æ„ï¼š\n\n&#123;\n$$typeof: Symbol(react.element),\ntype: &#39;div&#39;,\nkey: null,\nref: null,\nprops: &#123;\n    className: &#39;container&#39;,\n    children: [\n      &#123;\n        $$typeof: Symbol(react.element),\n        type: &#39;span&#39;,\n        props: &#123; children: &#39;Hello&#39; &#125;,\n        &#x2F;&#x2F; ...\n      &#125;\n    ]\n&#125;\n&#125;\n\n\næ‰€ä»¥æ•´ä¸ªæµç¨‹æ˜¯ï¼š\n\n\nå¼€å‘è€…å†™ JSX ä»£ç \nBabel åœ¨ç¼–è¯‘æ—¶å°† JSX è¯­æ³•è½¬æ¢ä¸º jsx() å‡½æ•°è°ƒç”¨\nè¿è¡Œæ—¶ï¼Œjsx() å‡½æ•°è¢«è°ƒç”¨ï¼Œåˆ›å»º React å…ƒç´ \nReact ä½¿ç”¨è¿™äº›å…ƒç´ æ¥æ¸²æŸ“å®é™…çš„ DOM 5.ç®€å•æ¥è¯´ï¼šBabel çš„å·¥ä½œæ˜¯ï¼šè½¬æ¢è¯­æ³•ï¼ˆ â†’ jsx(â€˜divâ€™)ï¼‰,jsx å‡½æ•°çš„å·¥ä½œæ˜¯ï¼šåˆ›å»ºè™šæ‹Ÿ DOM èŠ‚ç‚¹ï¼ˆjsx(â€˜divâ€™) â†’ { type: â€˜divâ€™, props: {â€¦} }ï¼‰,è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨ React 17 ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨å¼•å…¥ Reactï¼ˆimport React from â€˜reactâ€™ï¼‰ï¼Œå› ä¸º Babel ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å¼•å…¥ jsx å‡½æ•°ã€‚\n\n\né‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜å­˜åœ¨ jsxDev å‡½æ•°å‘¢ï¼Ÿ\n\njsxDev å‡½æ•°çš„ä½œç”¨æ˜¯ä¸ºäº†å¼€å‘ç¯å¢ƒçš„ JSX è½¬æ¢ï¼Œå®ƒçš„ä½œç”¨å’Œ jsx å‡½æ•°ä¸€æ ·ï¼Œåªæ˜¯å®ƒä¸å¤„ç† children å­å…ƒç´ ï¼Œæ‰€ä»¥å®ƒçš„è¿”å›å€¼å’Œç”Ÿäº§ç¯å¢ƒçš„ jsx å‡½æ•°è¿”å›å€¼æ˜¯ä¸€æ ·çš„ã€‚\nåŒºåˆ«çš„å…·ä½“ä½“ç°ï¼š\n\nBabel çš„è½¬æ¢ä¼šæ ¹æ®ç¯å¢ƒä¸åŒé€‰æ‹©ä¸åŒçš„å‡½æ•°ï¼š\n\n&#x2F;&#x2F; å¼€å‘ç¯å¢ƒä¸‹ï¼ŒBabel ä¼šè½¬æ¢æˆï¼š\njsxDev(&quot;div&quot;, &#123; className: &quot;container&quot; &#125;);\n\n&#x2F;&#x2F; ç”Ÿäº§ç¯å¢ƒä¸‹ï¼ŒBabel ä¼šè½¬æ¢æˆï¼š\njsx(&quot;div&quot;, &#123; className: &quot;container&quot; &#125;);\n\n\nå®é™…åº”ç”¨åœºæ™¯ï¼š\n\nfunction App() &#123;\n  &#x2F;&#x2F; å¼€å‘ç¯å¢ƒä¸‹ï¼Œå¦‚æœä½ è¿™æ ·å†™ï¼š\n  return &lt;div&gt;&#123;undefined.toString()&#125;&lt;&#x2F;div&gt;;\n\n  &#x2F;&#x2F; jsxDev å¯ä»¥æä¾›æ›´å‹å¥½çš„é”™è¯¯ä¿¡æ¯ï¼š\n  &#x2F;&#x2F; &quot;Cannot read property &#39;toString&#39; of undefined at App&quot;\n  &#x2F;&#x2F; å¹¶æ˜¾ç¤ºå…·ä½“çš„ç»„ä»¶æ ˆä¿¡æ¯\n\n  &#x2F;&#x2F; è€Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œjsx å‡½æ•°ä¼šç®€å•åœ°æŠ›å‡ºé”™è¯¯ï¼Œ\n  &#x2F;&#x2F; æ²¡æœ‰è¿™äº›é¢å¤–çš„è°ƒè¯•ä¿¡æ¯\n&#125;\n\n\næ€§èƒ½è€ƒè™‘ï¼š\n\n&#x2F;&#x2F; å¼€å‘ç¯å¢ƒï¼šæ›´å¤šçš„æ£€æŸ¥ï¼Œæ›´å¤šçš„è­¦å‘Š\njsxDev(&quot;div&quot;, &#123;\n  &#x2F;&#x2F; å¯ä»¥æ£€æŸ¥ props ç±»å‹\n  &#x2F;&#x2F; å¯ä»¥æ£€æŸ¥åºŸå¼ƒçš„ API ä½¿ç”¨\n  &#x2F;&#x2F; å¯ä»¥æ·»åŠ æ›´å¤šçš„è°ƒè¯•ä¿¡æ¯\n&#125;);\n\n&#x2F;&#x2F; ç”Ÿäº§ç¯å¢ƒï¼šæ›´ç®€æ´çš„ä»£ç ï¼Œæ›´å¥½çš„æ€§èƒ½\njsx(&quot;div&quot;, &#123;\n  &#x2F;&#x2F; åªè¿›è¡Œå¿…è¦çš„è½¬æ¢\n  &#x2F;&#x2F; æ²¡æœ‰é¢å¤–çš„æ£€æŸ¥å’Œè­¦å‘Š\n  &#x2F;&#x2F; ä»£ç ä½“ç§¯æ›´å°ï¼Œè¿è¡Œæ›´å¿«\n&#125;);\n\nSummaryï¼š\n\nå¼€å‘ä½“éªŒï¼šæä¾›æ›´å¥½çš„é”™è¯¯ä¿¡æ¯å’Œè­¦å‘Š\nè°ƒè¯•èƒ½åŠ›ï¼šæ”¯æŒ React DevTools ç­‰å¼€å‘å·¥å…·\næ€§èƒ½ä¼˜åŒ–ï¼šç”Ÿäº§ç¯å¢ƒå¯ä»¥ç§»é™¤å¼€å‘æ—¶çš„æ£€æŸ¥ä»£ç \nåŒ…ä½“ç§¯ï¼šç”Ÿäº§ç¯å¢ƒçš„ä»£ç æ›´ç²¾ç®€\n\nè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ React éœ€è¦ç»´æŠ¤ä¸¤ä¸ªç‰ˆæœ¬çš„ JSX è½¬æ¢å‡½æ•°ï¼Œå®ƒä»¬æœåŠ¡äºä¸åŒçš„ç›®çš„ï¼šjsx: æ³¨é‡æ€§èƒ½å’ŒåŒ…ä½“ç§¯jsxDev: æ³¨é‡å¼€å‘ä½“éªŒå’Œè°ƒè¯•èƒ½åŠ›\nReact reconcilerReact reconciler ä¸»è¦æ˜¯å®ç°äº† React çš„æ ¸å¿ƒç®—æ³•ï¼ŒåŒ…æ‹¬è°ƒå’Œã€æ¸²æŸ“ã€æ›´æ–°ç­‰ã€‚\næ›´æ”¹ packages&#x2F;react-reconciler&#x2F;package.json æ–‡ä»¶&#123;\n  &quot;name&quot;: &quot;react-reconciler&quot;,\n  &quot;version&quot;: &quot;1.0.0&quot;,\n  &quot;description&quot;: &quot;react-reconciler&quot;,\n  &quot;module&quot;: &quot;index.ts&quot;,\n  &quot;dependencies&quot;: &#123;\n    &quot;shared&quot;: &quot;workspace: *&quot;\n  &#125;,\n  &quot;scripts&quot;: &#123;\n    &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; &amp;&amp; exit 1&quot;\n  &#125;,\n  &quot;keywords&quot;: [],\n  &quot;author&quot;: &quot;x29&quot;,\n  &quot;license&quot;: &quot;ISC&quot;\n&#125;\n\nåœ¨ packages&#x2F;react&#x2F;src&#x2F;currentBatchConfig.ts æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å£°æ˜äº† currentBatchConfig ç±»å‹ã€‚\n\n\n\n\n\n\n\n\ncurrentBatchConfig.ts - React æ‰¹å¤„ç†é…ç½®æ–‡ä»¶\nä½œç”¨ï¼š\n\nå­˜å‚¨å½“å‰ React æ‰¹é‡æ›´æ–°çš„é…ç½®ä¿¡æ¯\nä¸»è¦ç”¨äº Transition ç›¸å…³çš„åŠŸèƒ½\nåœ¨å¹¶å‘æ¸²æŸ“ä¸­æ§åˆ¶æ›´æ–°çš„ä¼˜å…ˆçº§\n\n&#x2F;**\n * React å½“å‰æ‰¹å¤„ç†é…ç½®å¯¹è±¡\n *\n * ç”¨é€”ï¼š\n * 1. åœ¨ç»„ä»¶æ›´æ–°æ—¶æ ‡è®°æ›´æ–°çš„ç±»å‹\n * 2. å¸®åŠ© React åŒºåˆ†æ™®é€šæ›´æ–°å’Œ Transition æ›´æ–°\n * 3. å½±å“æ›´æ–°çš„ä¼˜å…ˆçº§å’Œè°ƒåº¦æ–¹å¼\n *\n * @type &#123;React.BatchConfig&#125;\n *\n * @example\n * &#x2F;&#x2F; React å†…éƒ¨ä½¿ç”¨ç¤ºä¾‹\n * function scheduleUpdate(fiber, update) &#123;\n *   const transition &#x3D; ReactCurrentBatchConfig.transition;\n *   if (transition !&#x3D;&#x3D; null) &#123;\n *     &#x2F;&#x2F; è¿™æ˜¯ä¸€ä¸ª Transition æ›´æ–°ï¼Œä½¿ç”¨è¾ƒä½çš„ä¼˜å…ˆçº§\n *     scheduleTransitionUpdate(fiber, update);\n *   &#125; else &#123;\n *     &#x2F;&#x2F; è¿™æ˜¯ä¸€ä¸ªæ™®é€šæ›´æ–°ï¼Œä½¿ç”¨æ­£å¸¸ä¼˜å…ˆçº§\n *     scheduleRegularUpdate(fiber, update);\n *   &#125;\n * &#125;\n *&#x2F;\nconst ReactCurrentBatchConfig: React.BatchConfig &#x3D; &#123;\n  transition: null,\n&#125;;\n\nexport default ReactCurrentBatchConfig;\n\n\n\n\n\n\n\n\n\n\nå®é™…åº”ç”¨åœºæ™¯ï¼š\n\nuseTransition Hook:\n\nfunction App() &#123;\n  const [isPending, startTransition] &#x3D; useTransition();\n  return (\n    &lt;button\n      onClick&#x3D;&#123;() &#x3D;&gt; &#123;\n        startTransition(() &#x3D;&gt; &#123;\n          &#x2F;&#x2F; è¿™é‡Œçš„æ›´æ–°ä¼šè¢«æ ‡è®°ä¸º Transition\n          setLargeList(generateLargeList());\n        &#125;);\n      &#125;&#125;\n    &gt;\n      Update List\n    &lt;&#x2F;button&gt;\n  );\n&#125;\n\n\nå¹¶å‘ç‰¹æ€§ï¼š\n\n\nå…è®¸ React ä¸­æ–­æ¸²æŸ“ä»¥å¤„ç†æ›´é«˜ä¼˜å…ˆçº§çš„æ›´æ–°\nå¸®åŠ©å®ç°æ›´æµç•…çš„ç”¨æˆ·ä½“éªŒ\næ”¯æŒå¯ä¸­æ–­çš„æ¸²æŸ“è¿‡ç¨‹\n\nåœ¨ packages&#x2F;react-reconciler&#x2F;src&#x2F;fiberFlags.ts æ–‡ä»¶ä¸­\n\n\n\n\n\n\n\n\nfiberFlags.ts - React Fiber èŠ‚ç‚¹çš„å‰¯ä½œç”¨ï¼ˆside-effectsï¼‰æ ‡è®°å®šä¹‰\nä½œç”¨ï¼š\n\nå®šä¹‰æ‰€æœ‰å¯èƒ½çš„ Fiber èŠ‚ç‚¹å‰¯ä½œç”¨ç±»å‹\nä½¿ç”¨äºŒè¿›åˆ¶ä½æ ‡è®°å®ç°é«˜æ•ˆçš„å‰¯ä½œç”¨è¿½è¸ª\né€šè¿‡ä½è¿ç®—ç»„åˆå¤šä¸ªå‰¯ä½œç”¨\n\n&#x2F;**\n\n\n&#x2F;**\n * Flags ç±»å‹å®šä¹‰\n * ç”¨äºåœ¨ TypeScript ä¸­æ ‡è¯†å‰¯ä½œç”¨æ ‡è®°çš„ç±»å‹\n *&#x2F;\nexport type Flags &#x3D; number;\n\n&#x2F;**\n * æ— å‰¯ä½œç”¨æ ‡è®°\n * è¡¨ç¤ºèŠ‚ç‚¹ä¸éœ€è¦è¿›è¡Œä»»ä½•æ“ä½œ\n * äºŒè¿›åˆ¶ï¼š0000000\n *&#x2F;\nexport const NoFlags &#x3D; 0b0000000;\n\n&#x2F;**\n * æ’å…¥&#x2F;ç§»åŠ¨æ ‡è®°\n * è¡¨ç¤ºèŠ‚ç‚¹éœ€è¦æ’å…¥åˆ° DOM ä¸­æˆ–åœ¨ DOM ä¸­ç§»åŠ¨ä½ç½®\n * äºŒè¿›åˆ¶ï¼š0000001\n *&#x2F;\nexport const Placement &#x3D; 0b0000001;\n\n&#x2F;**\n * æ›´æ–°æ ‡è®°\n * è¡¨ç¤ºèŠ‚ç‚¹çš„å±æ€§æˆ–å†…å®¹éœ€è¦æ›´æ–°\n * äºŒè¿›åˆ¶ï¼š0000010\n *&#x2F;\nexport const Update &#x3D; 0b0000010;\n\n&#x2F;**\n * å­èŠ‚ç‚¹åˆ é™¤æ ‡è®°\n * è¡¨ç¤ºéœ€è¦åˆ é™¤å­èŠ‚ç‚¹\n * äºŒè¿›åˆ¶ï¼š0000100\n *&#x2F;\nexport const ChildDeletion &#x3D; 0b0000100;\n\n&#x2F;**\n * è¢«åŠ¨æ•ˆæœæ ‡è®°ï¼ˆå¦‚ useEffectï¼‰\n * è¡¨ç¤ºèŠ‚ç‚¹åŒ…å«éœ€è¦åœ¨æäº¤é˜¶æ®µåå¼‚æ­¥æ‰§è¡Œçš„å‰¯ä½œç”¨\n * äºŒè¿›åˆ¶ï¼š0001000\n *&#x2F;\nexport const PassiveEffect &#x3D; 0b0001000;\n\n&#x2F;**\n * Ref æ›´æ–°æ ‡è®°\n * è¡¨ç¤ºèŠ‚ç‚¹çš„ ref éœ€è¦æ›´æ–°\n * äºŒè¿›åˆ¶ï¼š0010000\n *&#x2F;\nexport const Ref &#x3D; 0b0010000;\n\n&#x2F;**\n * å¯è§æ€§å˜æ›´æ ‡è®°\n * è¡¨ç¤ºèŠ‚ç‚¹çš„æ˜¾ç¤º&#x2F;éšè—çŠ¶æ€éœ€è¦æ›´æ–°\n * äºŒè¿›åˆ¶ï¼š0100000\n *&#x2F;\nexport const Visibility &#x3D; 0b0100000;\n\n&#x2F;**\n * å·²æ•è·æ ‡è®°\n * è¡¨ç¤ºé”™è¯¯å·²ç»è¢«æ•è·\n * äºŒè¿›åˆ¶ï¼š1000000\n *&#x2F;\nexport const DidCapture &#x3D; 0b1000000;\n\n&#x2F;**\n * åº”è¯¥æ•è·æ ‡è®°\n * è¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹åº”è¯¥å°è¯•æ•è·é”™è¯¯\n * äºŒè¿›åˆ¶ï¼š01000000000\n *&#x2F;\nexport const ShouldCapture &#x3D; 0b01000000000;\n\n&#x2F;**\n * çªå˜é˜¶æ®µçš„æ ‡è®°é›†åˆ\n * åŒ…å«äº†åœ¨ DOM çªå˜é˜¶æ®µéœ€è¦å¤„ç†çš„æ‰€æœ‰å‰¯ä½œç”¨\n * é€šè¿‡ä½è¿ç®—ç»„åˆå¤šä¸ªæ ‡è®°\n *\n * @example\n * if (fiber.flags &amp; MutationMask) &#123;\n *   &#x2F;&#x2F; éœ€è¦åœ¨çªå˜é˜¶æ®µå¤„ç†è¿™ä¸ªèŠ‚ç‚¹\n * &#125;\n *&#x2F;\nexport const MutationMask &#x3D;\n  Placement | Update | ChildDeletion | Ref | Visibility;\n\n&#x2F;**\n * å¸ƒå±€é˜¶æ®µçš„æ ‡è®°é›†åˆ\n * åŒ…å«äº†åœ¨ DOM å¸ƒå±€é˜¶æ®µéœ€è¦å¤„ç†çš„æ‰€æœ‰å‰¯ä½œç”¨\n * ç›®å‰åªåŒ…å« Ref çš„æ›´æ–°\n *&#x2F;\nexport const LayoutMask &#x3D; Ref;\n\n&#x2F;**\n * è¢«åŠ¨æ•ˆæœçš„æ ‡è®°é›†åˆ\n * åŒ…å«äº†éœ€è¦å¼‚æ­¥å¤„ç†çš„å‰¯ä½œç”¨\n * ä¸»è¦ç”¨äº useEffect çš„å¤„ç†\n *&#x2F;\nexport const PassiveMask &#x3D; PassiveEffect | ChildDeletion;\n\nä½¿ç”¨ç¤ºä¾‹ï¼š\n&#x2F;&#x2F; æ·»åŠ å‰¯ä½œç”¨æ ‡è®°\nfiber.flags |&#x3D; Update;\n\n&#x2F;&#x2F; æ£€æŸ¥æ˜¯å¦åŒ…å«æŸä¸ªå‰¯ä½œç”¨\nif (fiber.flags &amp; Placement) &#123;\n  &#x2F;&#x2F; éœ€è¦æ’å…¥æˆ–ç§»åŠ¨èŠ‚ç‚¹\n&#125;\n\n&#x2F;&#x2F; åœ¨ä¸åŒé˜¶æ®µæ£€æŸ¥ç›¸å…³å‰¯ä½œç”¨\nif (fiber.flags &amp; MutationMask) &#123;\n  &#x2F;&#x2F; å¤„ç† DOM çªå˜ç›¸å…³çš„å‰¯ä½œç”¨\n&#125;\n\nif (fiber.flags &amp; PassiveMask) &#123;\n  &#x2F;&#x2F; å¤„ç† useEffect ç›¸å…³çš„å‰¯ä½œç”¨\n&#125;\n\nåœ¨ packages&#x2F;react-reconciler&#x2F;src&#x2F;workTags.ts æ–‡ä»¶ä¸­\n\n\n\n\n\n\n\n\nworkTags.ts - React Fiber èŠ‚ç‚¹ç±»å‹å®šä¹‰æ–‡ä»¶\nä½œç”¨ï¼š\n\nå®šä¹‰æ‰€æœ‰å¯èƒ½çš„ Fiber èŠ‚ç‚¹ç±»å‹\nç”¨äºåœ¨ Fiber æ ‘ä¸­æ ‡è¯†ä¸åŒç±»å‹çš„èŠ‚ç‚¹\nå¸®åŠ© React åœ¨åè°ƒè¿‡ç¨‹ä¸­æ­£ç¡®å¤„ç†ä¸åŒç±»å‹çš„ç»„ä»¶\n\n&#x2F;**\n * å‡½æ•°ç»„ä»¶æ ‡è¯†\n * ç”¨äºæ ‡è¯†å‡½æ•°å¼ç»„ä»¶åˆ›å»ºçš„ Fiber èŠ‚ç‚¹\n * @example\n * function App() &#123; return &lt;div&gt;Hello&lt;&#x2F;div&gt; &#125;\n * &#x2F;&#x2F; App ç»„ä»¶å¯¹åº”çš„ Fiber èŠ‚ç‚¹çš„ tag å€¼ä¸º FunctionComponent (0)\n *&#x2F;\nexport const FunctionComponent: React.FunctionComponent &#x3D; 0;\n\n&#x2F;**\n * æ ¹èŠ‚ç‚¹æ ‡è¯†\n * ç”¨äºæ ‡è¯†åº”ç”¨çš„æ ¹èŠ‚ç‚¹ï¼ˆRootï¼‰\n * @example\n * ReactDOM.render(&lt;App &#x2F;&gt;, container)\n * &#x2F;&#x2F; container å¯¹åº”çš„ Fiber èŠ‚ç‚¹çš„ tag å€¼ä¸º HostRoot (3)\n *&#x2F;\nexport const HostRoot: React.HostRoot &#x3D; 3;\n\n&#x2F;**\n * åŸç”Ÿ DOM å…ƒç´ æ ‡è¯†\n * ç”¨äºæ ‡è¯†æ™®é€š HTML å…ƒç´ çš„ Fiber èŠ‚ç‚¹\n * @example\n * &lt;div&gt;Hello&lt;&#x2F;div&gt;\n * &#x2F;&#x2F; div å¯¹åº”çš„ Fiber èŠ‚ç‚¹çš„ tag å€¼ä¸º HostComponent (5)\n *&#x2F;\nexport const HostComponent: React.HostComponent &#x3D; 5;\n\n&#x2F;**\n * æ–‡æœ¬èŠ‚ç‚¹æ ‡è¯†\n * ç”¨äºæ ‡è¯†æ–‡æœ¬å†…å®¹çš„ Fiber èŠ‚ç‚¹\n * @example\n * &lt;div&gt;Hello World&lt;&#x2F;div&gt;\n * &#x2F;&#x2F; &quot;Hello World&quot; å¯¹åº”çš„ Fiber èŠ‚ç‚¹çš„ tag å€¼ä¸º HostText (6)\n *&#x2F;\nexport const HostText: React.HostText &#x3D; 6;\n\n&#x2F;**\n * Fragment æ ‡è¯†\n * ç”¨äºæ ‡è¯† React.Fragment çš„ Fiber èŠ‚ç‚¹\n * @example\n * &lt;React.Fragment&gt;\n *   &lt;div&gt;Item 1&lt;&#x2F;div&gt;\n *   &lt;div&gt;Item 2&lt;&#x2F;div&gt;\n * &lt;&#x2F;React.Fragment&gt;\n * &#x2F;&#x2F; Fragment å¯¹åº”çš„ Fiber èŠ‚ç‚¹çš„ tag å€¼ä¸º Fragment (7)\n *&#x2F;\nexport const Fragment: React.Fragment &#x3D; 7;\n\n&#x2F;**\n * Context Provider æ ‡è¯†\n * ç”¨äºæ ‡è¯† Context.Provider çš„ Fiber èŠ‚ç‚¹\n * @example\n * &lt;MyContext.Provider value&#x3D;&#123;value&#125;&gt;\n *   &#123;children&#125;\n * &lt;&#x2F;MyContext.Provider&gt;\n * &#x2F;&#x2F; Provider å¯¹åº”çš„ Fiber èŠ‚ç‚¹çš„ tag å€¼ä¸º ContextProvider (11)\n *&#x2F;\nexport const ContextProvider: React.ContextProvider &#x3D; 11;\n\n&#x2F;**\n * Suspense ç»„ä»¶æ ‡è¯†\n * ç”¨äºæ ‡è¯† Suspense ç»„ä»¶çš„ Fiber èŠ‚ç‚¹\n * @example\n * &lt;Suspense fallback&#x3D;&#123;&lt;Loading &#x2F;&gt;&#125;&gt;\n *   &lt;SomeComponent &#x2F;&gt;\n * &lt;&#x2F;Suspense&gt;\n * &#x2F;&#x2F; Suspense å¯¹åº”çš„ Fiber èŠ‚ç‚¹çš„ tag å€¼ä¸º SuspenseComponent (13)\n *&#x2F;\nexport const SuspenseComponent: React.SuspenseComponent &#x3D; 13;\n\n&#x2F;**\n * Offscreen ç»„ä»¶æ ‡è¯†\n * ç”¨äºæ ‡è¯† Offscreen ç»„ä»¶çš„ Fiber èŠ‚ç‚¹\n * é€šå¸¸ç”¨äºå®ç°ä¸€äº›æ€§èƒ½ä¼˜åŒ–ç›¸å…³çš„åŠŸèƒ½\n * @example\n * &#x2F;&#x2F; React å†…éƒ¨ä½¿ç”¨ï¼Œç”¨äºä¼˜åŒ–æ¸²æŸ“æ€§èƒ½\n * &#x2F;&#x2F; å¯¹åº”çš„ Fiber èŠ‚ç‚¹çš„ tag å€¼ä¸º OffscreenComponent (14)\n *&#x2F;\nexport const OffscreenComponent: React.OffscreenComponent &#x3D; 14;\n\n\n\n\n\n\n\n\n\n\nä½¿ç”¨ç¤ºä¾‹ï¼š\nfunction processFiber(fiber: FiberNode) &#123;\n  switch (fiber.tag) &#123;\n    case FunctionComponent:\n      &#x2F;&#x2F; å¤„ç†å‡½æ•°ç»„ä»¶\n      updateFunctionComponent(fiber);\n      break;\n    case HostComponent:\n      &#x2F;&#x2F; å¤„ç† DOM å…ƒç´ \n      updateHostComponent(fiber);\n      break;\n    case HostText:\n      &#x2F;&#x2F; å¤„ç†æ–‡æœ¬èŠ‚ç‚¹\n      updateTextContent(fiber);\n      break;\n    &#x2F;&#x2F; ... å¤„ç†å…¶ä»–ç±»å‹\n  &#125;\n&#125;\n\n","slug":"React-Principle","date":"2024-11-23T16:50:47.000Z","categories_index":"React","tags_index":"React","author_index":"X-29"},{"id":"78c733f14091289904e8c5ab0e4b1c53","title":"å‰ç«¯è‡ªåŠ¨åŒ–éƒ¨ç½²","content":"æ‰€è°“è‡ªåŠ¨åŒ–éƒ¨ç½²å°±æ˜¯å½“ä»£ç è§¦å‘æäº¤çš„æ—¶å€™è‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Š\nå‰ç½®å‡†å¤‡å·¥ä½œ\n\næœåŠ¡å™¨ï¼šéœ€è¦æœ‰ä¸€å°å¯ä»¥éƒ¨ç½²ä»£ç çš„æœåŠ¡å™¨ï¼Œæ¯”å¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€GitHub Pages ç­‰\nä»£ç ä»“åº“ï¼šéœ€è¦æœ‰ä¸€ä¸ªä»£ç ä»“åº“ï¼Œæ¯”å¦‚ GitHubã€GitLab ç­‰\nä¼š linux\næ‡‚ç‚¹ Ngnix\næ‡‚ç‚¹ Git\n\nä¹°ä¸€å°æœåŠ¡å™¨\nä¸è¦è´ªä¾¿å®œåˆ°ä¸çŸ¥åå°å¹³å°ä¹°ï¼Œä¹‹å‰æˆ‘ä¹Ÿæœ‰è¿‡æŠ•æœºå–å·§ä¸æƒ³ä¹°å¤§å¹³å°çš„æœåŠ¡å™¨ï¼Œå› ä¸ºè§‰å¾—è´µï¼Œä½†æ˜¯è´µæœ‰è´µçš„é“ç†ï¼Œå°å¹³å°çš„å®‰è£…éƒ½ä¼šæŠ¥é”™ï¼Œå¯èƒ½å¯¹äºå½“æ—¶çš„æˆ‘æŠ€æœ¯è¿˜ä¸å¤Ÿï¼Œä¸å¤ªèƒ½åˆ†æå‡ºé”™è¯¯çš„åŸå› æ˜¯ä»€ä¹ˆï¼Œæ€»ä¹‹é¿é›·å°±å¯¹äº†ã€‚\n\nåˆ°é˜¿é‡Œäº‘æˆ‘ä¹°çš„ 99&#x2F;å¹´çš„ï¼Œæˆ‘ä¹°çš„æ˜¯ Alibaba Cloud Linux3ï¼Œå’Œ CentOS æ²¡å·®ï¼Œç”¨å°±è¡Œ\n\nä¸€è·¯å…ˆç¡®å®šç›´åˆ°æ”¯ä»˜å®Œæˆå°±ä¼šçœ‹åˆ°æœ‰æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œè®°ä½è¿™ä¸ª IP åœ°å€ï¼Œåé¢ä¼šç”¨åˆ°ã€‚ç„¶åé‡ç½®å¯†ç ï¼Œè®°ä½å¯†ç ï¼Œä¸ç®¡æ˜¯è„‘å­è¿˜æ˜¯åˆ«çš„ä»€ä¹ˆåœ°æ–¹\n\n\nè¿æ¥æœåŠ¡å™¨å›ºå®šæ¨¡æ¿ ssh root@æœåŠ¡å™¨ IP åœ°å€\nå®‰è£… Dockerä»¥ä¸‹å‘½ä»¤ä»¥æ­¤æ‰§è¡Œï¼Œæ— è„‘åšå°±èƒ½æˆåŠŸ\n**ä¸€äº›å‘½ä»¤çš„è§£é‡Š: **\n\ndnf: è¿™æ˜¯ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œç”¨äºå®‰è£…ã€æ›´æ–°å’Œåˆ é™¤è½¯ä»¶åŒ…ã€‚å®ƒæ˜¯ yum çš„ä¸‹ä¸€ä»£ç‰ˆæœ¬ï¼Œæä¾›æ›´å¥½çš„æ€§èƒ½å’Œä¾èµ–ç®¡ç†åŠŸèƒ½ã€‚\n\ninstall: è¿™æ˜¯ dnf çš„ä¸€ä¸ªå­å‘½ä»¤ï¼Œç”¨äºå®‰è£…æŒ‡å®šçš„è½¯ä»¶åŒ…ã€‚\n\n-y: è¿™ä¸ªé€‰é¡¹è¡¨ç¤ºè‡ªåŠ¨å›ç­”â€œyesâ€ç»™æ‰€æœ‰çš„æç¤ºã€‚è¿™æ„å‘³ç€åœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰ä»»ä½•ç¡®è®¤æç¤ºï¼Œä½¿ç”¨æ­¤æ ‡å¿—å¯ä»¥è‡ªåŠ¨æ¥å—ï¼Œé¿å…æ‰‹åŠ¨å¹²é¢„ã€‚\n\ndocker-ce: è¿™æ˜¯è¦å®‰è£…çš„è½¯ä»¶åŒ…çš„åç§°ã€‚åœ¨è¿™é‡Œï¼Œdocker-ce æŒ‡çš„æ˜¯ Docker çš„ç¤¾åŒºç‰ˆï¼ˆCommunity Editionï¼‰ã€‚Docker æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨åŒ–å¹³å°ï¼Œç”¨äºè‡ªåŠ¨åŒ–åº”ç”¨ç¨‹åºçš„éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†ã€‚\n\nâ€“nobest: è¿™ä¸ªé€‰é¡¹å‘Šè¯‰ dnf åœ¨å®‰è£…æ—¶ä¸ä¸€å®šé€‰æ‹©æœ€å¥½çš„ï¼ˆæœ€æ–°çš„ï¼‰ç‰ˆæœ¬æ¥è¿›è¡Œå®‰è£…ï¼Œè€Œæ˜¯å¯ä»¥é€‰æ‹©å¯ç”¨ç‰ˆæœ¬ä¸­çš„è¾ƒå¥½ç‰ˆæœ¬ã€‚è¿™åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥é¿å…å› ä¸ºä¾èµ–é—®é¢˜è€Œæ— æ³•å®‰è£…æœ€æ–°ç‰ˆæœ¬\n\n\nè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®‰è£…Dockerå­˜å‚¨é©±åŠ¨çš„ä¾èµ–åŒ…dnf install -y device-mapper-persistent-data lvm2\n\nè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ·»åŠ ç¨³å®šçš„Dockerè½¯ä»¶æºã€‚dnf config-manager --add-repo&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;docker-ce&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo\n\nè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹å·²æ·»åŠ çš„Dockerè½¯ä»¶æºã€‚dnf list docker-ce\n\næ­£ç¡®çš„è¿”å›ç¤ºä¾‹å¦‚ä¸‹ã€‚docker-ce.x86_64        3:19.03.13-3.el7        docker-ce-stable\n\nè¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…Dockerdnf install -y docker-ce --nobest\n\nè®¾ç½®å¼€æœºè‡ªå¯sudo systemctl enable docker\n\nå¯åŠ¨dockersudo systemctl start docker\n\næ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸ docker -v æŸ¥çœ‹ç‰ˆæœ¬å·docker -v\n\n\nå®‰è£… docker-composeå®‰sudo curl -L \"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)\" -olink\n\nå¯¹äºŒè¿›åˆ¶æ–‡ä»¶åº”ç”¨å¯æ‰§è¡Œæƒé™sudo chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose\n\næ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸ docker-compose -v æŸ¥çœ‹ç‰ˆæœ¬å·docker-compose -v\n\nå®‰è£… Nginx é•œåƒå’Œ Jenkins é•œåƒå®‰è£… Nginxé•œåƒdocker pull nginx\n\n\n\n\n\n\n\n\n\n\n\nwarning: å¦‚æœæŠ¥é”™å†…å®¹æ˜¯ Error response from daemon: Get â€œhttps://registry-1.docker.io/v2/â€œ: net&#x2F;http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers) å°±æŒ‰ä¸‹æ–¹å‘½ä»¤æ‰§è¡Œ\n\nä¿®æ”¹ä¸‹è¿™ä¸ªjsonæ–‡ä»¶ï¼Œæ²¡æœ‰å°±åˆ›å»ºvim &#x2F;etc&#x2F;docker&#x2F;daemon.json\n\nå†™å…¥ä»¥ä¸‹å†…å®¹&#123;\n  &quot;registry-mirrors&quot;: [\n    &quot;https:&#x2F;&#x2F;2a6bf1988cb6428c877f723ec7530dbc.mirror.swr.myhuaweicloud.com&quot;,\n    &quot;https:&#x2F;&#x2F;docker.m.daocloud.io&quot;,\n    &quot;https:&#x2F;&#x2F;hub-mirror.c.163.com&quot;,\n    &quot;https:&#x2F;&#x2F;mirror.baidubce.com&quot;,\n    &quot;https:&#x2F;&#x2F;your_preferred_mirror&quot;,\n    &quot;https:&#x2F;&#x2F;dockerhub.icu&quot;,\n    &quot;https:&#x2F;&#x2F;docker.registry.cyou&quot;,\n    &quot;https:&#x2F;&#x2F;docker-cf.registry.cyou&quot;,\n    &quot;https:&#x2F;&#x2F;dockercf.jsdelivr.fyi&quot;,\n    &quot;https:&#x2F;&#x2F;docker.jsdelivr.fyi&quot;,\n    &quot;https:&#x2F;&#x2F;dockertest.jsdelivr.fyi&quot;,\n    &quot;https:&#x2F;&#x2F;mirror.aliyuncs.com&quot;,\n    &quot;https:&#x2F;&#x2F;dockerproxy.com&quot;,\n    &quot;https:&#x2F;&#x2F;mirror.baidubce.com&quot;,\n    &quot;https:&#x2F;&#x2F;docker.m.daocloud.io&quot;,\n    &quot;https:&#x2F;&#x2F;docker.nju.edu.cn&quot;,\n    &quot;https:&#x2F;&#x2F;docker.mirrors.sjtug.sjtu.edu.cn&quot;,\n    &quot;https:&#x2F;&#x2F;docker.mirrors.ustc.edu.cn&quot;,\n    &quot;https:&#x2F;&#x2F;mirror.iscas.ac.cn&quot;,\n    &quot;https:&#x2F;&#x2F;docker.rainbond.cc&quot;\n  ]\n&#125;\n\né‡æ–°åŠ è½½é…ç½®æ–‡ä»¶systemctl daemon-reload\n\né‡å¯dockeræœåŠ¡systemctl restart docker\n\næ£€æŸ¥ä¸‹dockeræ˜¯å¦å¯åŠ¨æ­£å¸¸systemctl status docker\n\nè¿™æ ·å†é‡æ–° pull Nginx å°±æ­£å¸¸äº†\nå®‰è£… JenkinsæŸ¥çœ‹é•œåƒlistdocker search jenkins\n\n\n\n\n\n\n\n\n\n\nwarning:å¯èƒ½ä¼šæŠ¥é”™ï¼Œéœ€è¦é…ç½®ä¸‹é•œåƒæºæ— æ‰€è°“ï¼Œåæ­£æ˜¯æŸ¥çœ‹åˆ—è¡¨çš„å‘½ä»¤ï¼Œå¾€ä¸‹èµ°æ¥ç€æ‹‰é•œåƒ\næ‹‰å–Jenkinsé•œåƒ æœ¬æ¬¡é•œåƒjenkins/jenkins:ltsdocker pull jenkins&#x2F;jenkins:lts\n\n\n\n\n\n\n\n\nWARNING\nå°±æ‹‰æœ€æ–°ç‰ˆçš„é•œåƒï¼Œlts ç‰ˆæœ¬æ˜¯æœ€ç¨³å®šçš„ç‰ˆæœ¬ï¼Œä¸€èˆ¬æƒ…å†µä¸‹éƒ½ç”¨è¿™ä¸ªç‰ˆæœ¬ï¼Œåˆ«æ•´æ²¡æœ‰ç”¨çš„\n\nå®‰è£…å®Œæˆåæ‰§è¡Œdocker images æŸ¥çœ‹å·²å®‰è£…é•œåƒdocker images\n\n\né…ç½®ç›®å½•ç¼–å†™\n\n\n\n\n\n\nWARNING\n!! æ³¨æ„ï¼šè¿™é‡Œçš„ docker æ˜¯æ”¾åœ¨æ ¹ç›®å½•çš„å’Œ&#x2F;root å¹³çº§çš„\n\n\ndocker\ncompose\ndocker-compose.yml &#x2F;&#x2F;docker-compose é…ç½®\n\n\nhtml &#x2F;&#x2F;å„ç¯å¢ƒä»£ç ç›®å½•(å®é™…é¡¹ç›®å¯èƒ½ä¸åœ¨åŒä¸€ç›®å½•)\ndev &#x2F;&#x2F;dev ç¯å¢ƒä»£ç ç›®å½•\nprod &#x2F;&#x2F;sit ç¯å¢ƒä»£ç ç›®å½•\n\n\njenkins_home &#x2F;&#x2F;Jenkins å·¥ç¨‹ç›®å½•\nnginx &#x2F;&#x2F;nginx å·¥ç¨‹ç›®å½•\nconf\nnginx.conf &#x2F;&#x2F;nginx é…ç½®\n\n\n\n\n\n\n\ndocker-compose.yml é…ç½®æ–‡ä»¶version: &quot;3&quot;\n\nservices: # å®¹å™¨\n  docker_jenkins:\n    privileged: true\n    user: root # rootæƒé™\n    restart: always # é‡å¯æ–¹å¼\n    image: jenkins&#x2F;jenkins:lts # ä½¿ç”¨çš„é•œåƒ\n    container_name: jenkins # å®¹å™¨åç§°\n    ports: # å¯¹å¤–æš´éœ²çš„ç«¯å£å®šä¹‰\n      - 8080:8080\n      - 50000:50000\n    volumes: # å·æŒ‚è½½è·¯å¾„\n      - &#x2F;docker&#x2F;jenkins_home&#x2F;:&#x2F;var&#x2F;jenkins_home # æŒ‚è½½åˆ°å®¹å™¨å†…çš„jenkins_homeç›®å½•\n      - &#x2F;var&#x2F;run&#x2F;docker.sock:&#x2F;var&#x2F;run&#x2F;docker.sock\n      - &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose:&#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose\n      - &#x2F;usr&#x2F;bin&#x2F;docker:&#x2F;usr&#x2F;bin&#x2F;docker\n\n  docker_nginx_dev: # nginx-devç¯å¢ƒ\n    restart: always\n    image: nginx\n    container_name: nginx_dev\n    ports:\n      - 8001:8001\n    volumes:\n      - &#x2F;docker&#x2F;nginx&#x2F;conf&#x2F;nginx.conf:&#x2F;etc&#x2F;nginx&#x2F;nginx.conf\n      - &#x2F;docker&#x2F;html:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html\n      - &#x2F;docker&#x2F;nginx&#x2F;logs:&#x2F;var&#x2F;log&#x2F;nginx\n\n  docker_nginx_prod: # nginx-prodç¯å¢ƒ\n    restart: always\n    image: nginx\n    container_name: nginx_prod\n    ports:\n      - 8002:8002\n    volumes:\n      - &#x2F;docker&#x2F;nginx&#x2F;conf&#x2F;nginx.conf:&#x2F;etc&#x2F;nginx&#x2F;nginx.conf\n      - &#x2F;docker&#x2F;html:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html\n      - &#x2F;docker&#x2F;nginx&#x2F;logs:&#x2F;var&#x2F;log&#x2F;nginx\n\nnginx.conf é…ç½®æ–‡ä»¶# nginx.conf ä¾‹ï¼š\nuser  nginx;\nworker_processes  1;\n\nerror_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log warn;\npid        &#x2F;var&#x2F;run&#x2F;nginx.pid;\n\n\nevents &#123;\n    worker_connections  1024;\n&#125;\n\n\nhttp &#123;\n    include       &#x2F;etc&#x2F;nginx&#x2F;mime.types;\n    default_type  application&#x2F;octet-stream;\n\n    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;\n                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;\n                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;\n\n    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    keepalive_timeout  65;\n\n    gzip  on;\n\n    #devç¯å¢ƒ\n    server &#123;\n            #ç›‘å¬çš„ç«¯å£\n        listen  8001;\n        server_name  localhost;\n        #è®¾ç½®æ—¥å¿—\n#        access_log  logs&#x2F;dev.access.log  main;\n\n        #å®šä½åˆ°index.html\n           location &#x2F; &#123;\n               #linuxä¸‹HTMLæ–‡ä»¶å¤¹,å°±æ˜¯ä½ çš„å‰ç«¯é¡¹ç›®æ–‡ä»¶å¤¹\n               root  &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;dev&#x2F;dist;\n#               root  &#x2F;home&#x2F;html&#x2F;dev&#x2F;dist;\n               #è¾“å…¥ç½‘å€ï¼ˆserver_nameï¼športï¼‰åï¼Œé»˜è®¤çš„è®¿é—®é¡µé¢\n               index  index.html;\n               try_files $uri $uri&#x2F; &#x2F;index.html;\n           &#125;\n    &#125;\n\n    #prodç¯å¢ƒ\n    server &#123;\n            #ç›‘å¬çš„ç«¯å£\n        listen  8002;\n        server_name  localhost;\n        #è®¾ç½®æ—¥å¿—\n#        access_log  logs&#x2F;prod.access.log  main;\n\n        #å®šä½åˆ°index.html\n           location &#x2F; &#123;\n               #linuxä¸‹HTMLæ–‡ä»¶å¤¹,å°±æ˜¯ä½ çš„å‰ç«¯é¡¹ç›®æ–‡ä»¶å¤¹\n               root  &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;prod&#x2F;dist;\n#               root  &#x2F;home&#x2F;html&#x2F;dev&#x2F;dist;\n               #è¾“å…¥ç½‘å€ï¼ˆserver_nameï¼športï¼‰åï¼Œé»˜è®¤çš„è®¿é—®é¡µé¢\n               index  index.html;\n               try_files $uri $uri&#x2F; &#x2F;index.html;\n           &#125;\n    &#125;\n\n\n#    include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;\n\n\n&#125;\n\n\n\n\n\n\n\n\nTIP\nåœ¨ docker-compose.yml æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤åˆ›å»ºå®¹å™¨\n\nå¯åŠ¨å®¹å™¨docker-compose up -d\n\næ‰§è¡Œdocker psæŸ¥çœ‹å®¹å™¨æƒ…å†µdocker ps\n\nJenkins é…ç½®çˆ†å‘æ¥äº†ï¼ï¼ï¼\né˜¿é‡Œäº‘å®‰å…¨ç»„é…ç½®\n\n\n\n\n\n\nWARNING\næ­¤æ—¶é€šè¿‡ ip:8080 æ‰“ä¸å¼€ jenkins çš„ï¼Œå› ä¸ºé˜¿é‡Œäº‘é‚£è¾¹éœ€è¦æ‰‹åŠ¨åŠ ä¸Šè¦è®¿é—®é‚£ä¸ªç«¯å£ï¼Œå°±æ”¾è¡Œå“ªä¸ªç«¯å£\n\né˜²ç«å¢™é…ç½®\n\n\n\n\n\n\n\n\nè¾“å…¥å‘½ä»¤å¼€å¯é˜²ç«å¢™å’Œ 8080 ç«¯å£\næ£€æŸ¥é˜²ç«å¢™è£…å¡«sudo systemctl status firewalld\n\nå¼€å¯é˜²ç«å¢™sudo systemctl start firewalld\n\nsudo systemctl enable firewalld\n\nå¼€å¯8080ç«¯å£sudo firewall-cmd --zone&#x3D;public --add-port&#x3D;8080&#x2F;tcp --permanent\n\né‡å¯é˜²ç«å¢™sudo firewall-cmd --reload\n\n\n\n\n\n\n\n\nWARNING\nåé¢æ¯å¼€æ”¾ä¸€ä¸ªç«¯å£å°±è¦åˆ°å®‰å…¨ç»„æ‰‹åŠ¨é…ç½®ä¸€ä¸‹ï¼Œç„¶åé˜²ç«å¢™å¼€å¯ç«¯å£ï¼Œé˜²ç«å¢™ reload ä¸€ä¸‹ï¼Œä¸‰æ­¥ï¼Œæ¯ä¸€æ­¥éƒ½ä¸èƒ½å°‘\n\nJenkins åˆæ¬¡å¯†ç åœ¨å®¹å™¨å¯åŠ¨åï¼Œå¯ä»¥åœ¨æµè§ˆå™¨è¾“å…¥æœåŠ¡å™¨ ip:8080 è¿›å…¥ jenkins ç®¡ç†ç•Œé¢ã€‚è‡³æ­¤ï¼Œjenkins é…ç½®å®Œæˆã€‚\nå¯†ç åœ¨ docker/jenkins_home/secrets/initialAdminPasswordå¯ä»¥é€šè¿‡å‘½ä»¤ï¼š\ncat &#x2F;docker&#x2F;jenkins_home&#x2F;secrets&#x2F;initialAdminPassword\n\nNginx é…ç½®åœ¨å¯¹åº”ç›®å½•/docker/html/dev/distã€/docker/html/prod/distå„æ–°å»ºä¸€ä¸ª index.html\nç»è¿‡ä¸Šè¿°æ­¥éª¤ä¹‹åï¼Œå¯ä»¥é€šè¿‡ ip+å¯¹åº”çš„ nignx ç«¯å£è®¿é—®åˆ°å¯¹åº”çš„ç¯å¢ƒçš„é¡µé¢ã€‚\n\n\nJenkins è¿›å…¥åçš„é…ç½®ä¸‹è½½æ’ä»¶\nlocalï¼ˆå¯é€‰ã€‚å°†ç•Œé¢è®¾ç½®ä¸ºä¸­æ–‡ï¼‰\nGitHub\npublish over SSH (ç”¨æ¥è¿æ¥è¿œç¨‹æœåŠ¡å™¨çš„)\nNodeJs\n\nä¸‹è½½æ’ä»¶åï¼ŒJenkins éœ€è¦é‡å¯åœ°å€æ è¾“å…¥ip:ç«¯å£/restart\n\nPublish Over SSH é…ç½®ç¬¬ä¸€æ­¥\nç¬¬äºŒæ­¥ è¿›å»æ‰¾åˆ° Publish Over SSH\nç¬¬ä¸‰æ­¥ ç‚¹å‡» Publish Over SSH ä¸‹æ–¹çš„ SSH Server,ç‚¹å‡»æ–°å¢\nç¬¬å››æ­¥ ç‚¹å‡»é«˜çº§\n\n\nNodeJs é…ç½®\n\næ·»åŠ å‡­æ®æ·»åŠ å‡­æ®ï¼ˆè´¦å·å¯†ç ï¼‰æ˜¯ä¸ºäº†æ–¹ä¾¿åç»­ä½¿ç”¨\n\n\næ·»åŠ  github è´¦å·å¯†ç \nåˆ›å»º jobæºç ç®¡ç†\nåº”ç”¨ä¿å­˜åï¼Œç‚¹å‡»ç«‹å³æ„å»º\n\næ— è®ºæ˜¯å¦æˆåŠŸï¼Œéƒ½å¯ä»¥åœ¨æ„å»ºè®°å½•æ§åˆ¶å°æŸ¥çœ‹\n\nGithub WebHooks é…ç½®webhooks é…ç½®\n\nåˆ›å»ºä¸€ä¸ª Personal access tokens\né…ç½® jenkinsè¿›å…¥ä¸€ä¸ª job\n\n\n\n\n\n\n(å›¾ç‰‡è¯´æ˜ï¼šæè¿°å°±æ˜¯å–ä¸€ä¸ªåç§°)\n\nBuild Stepsåœ¨&#x2F;docker&#x2F;jenkins_home&#x2F;workspace&#x2F;gitlab_web,æ¯æ¬¡æ„å»ºå¯¹åº”ä»£ç éƒ½ä¼šåŒæ­¥æ›´æ–°ï¼Œç”±äºä»£ç æ²¡æœ‰åœ¨ git ä¸Šä¼  node_moudle æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥åç»­éœ€è¦åœ¨æœåŠ¡å™¨é‡æ–°å®‰è£… node_moudle\nExecute NodeJS scriptè¿™é‡Œé€‰çš„ node æ˜¯ä¸Šé¢é…ç½®çš„\nç‚¹å‡»åº”ç”¨åä¿å­˜ï¼Œç„¶åç‚¹å‡»ç«‹å³æ„å»ºï¼Œæ­¤æ¬¡æ—¶é—´ä¼šé•¿ä¸€ç‚¹ï¼Œæ­¤æ—¶æ„å»ºä¼šå»è‡ªåŠ¨å®‰è£…å¯¹åº”çš„ nodejs å®‰è£…åŒ…åˆ° jenkins ç›®å½•å¹¶é…ç½®å¥½ç¯å¢ƒå˜é‡ï¼Œæ³¨æ„å°½é‡ä¸æœ¬åœ°å¼€å‘ç¯å¢ƒçš„nodeç‰ˆæœ¬ä¸€è‡´ï¼Œä¸ºäº†ä¿æŒç¯å¢ƒåŒæ­¥ï¼Œç­‰å¾…æ„å»ºå¥½åå†æ‰§è¡Œä¸‹ä¸€æ­¥\n\nåº”ç”¨ä¿å­˜å¹¶æ„å»ºæˆåŠŸåï¼Œå¯ä»¥è¿›å…¥ä¸‹ä¸€æ­¥\nShell å‘½ä»¤\nåœ¨ shell å‘½ä»¤è¿™å—æœ‰çš„æ‰§è¡Œ node -v éƒ½æŠ¥é”™ï¼Œæ­¤æ—¶è¯·æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦ä¸æœåŠ¡å™¨çš„ç¯å¢ƒå˜é‡æœ‰å·®å¼‚ï¼Œæ‰§è¡Œecho $PATHç¬¬ä¸€è¡Œä»£ç ä¸€èˆ¬è¦æ·»åŠ #!/bin/bashå¦‚æœç¯å¢ƒå˜é‡æœ‰é—®é¢˜å¯èƒ½è¦åœ¨ç¬¬äºŒè¡Œæ‰§è¡Œåˆ·æ–°ç¯å¢ƒå˜é‡å‘½ä»¤\nsource ~&#x2F;.bash_profile\nsource &#x2F;etc&#x2F;profile\n\nä¸Šé¢å“ªä¸ªæœ‰æ•ˆæœç”¨å“ªä¸ªç„¶åæ‰§è¡Œå¯¹åº”å‘½ä»¤ï¼ŒéªŒè¯ç¯å¢ƒå¯ç”¨\n\n#!&#x2F;bin&#x2F;bash\n\nnode -v\nnpm -v\necho $PATH\n\nä¿å­˜ä¹‹åå›åˆ°æ¡Œé¢åœ¨æ­¤æ„å»ºä¸€æ¬¡ä¸Šè¿°å‘½ä»¤å¦‚æˆåŠŸæ‰§è¡Œï¼Œè¿›è¡Œä¸‹ä¸€æ­¥\nå®‰è£…node_mouleå¹¶buildæ‰“åŒ…\n\n\n\n\n\n\nWARNING\nå…ˆè‡ªå·±æœ¬åœ°buildä¸€ä¸‹ï¼Œçœ‹çœ‹å“ªé‡Œæœ‰é—®é¢˜\n\nä¿®æ”¹jobçš„shellé…ç½®\nnode -v\nnpm -v\n\nnpm i \nnpm run build:dev\n\n\næ­¤æ—¶æœåŠ¡å™¨ä»£ç å‡ºç°distæ–‡ä»¶å¤¹ç›®å½•åœ¨&#x2F;docker&#x2F;jenkins_home&#x2F;workspace&#x2F;github_test_web\nä»£ç è‡ªåŠ¨éƒ¨ç½²åˆ°å¯¹åº”ç¯å¢ƒé¡¹ç›®ç›®å½•åŒä¸€æœåŠ¡å™¨å¯ä»¥ç”¨cpå‘½ä»¤ï¼Œå¯ä»¥å‚è€ƒlinux cpå‘½ä»¤\næ­¤å¤„ä¸ºå¦ä¸€ç§æ–¹å¼ï¼šå‹ç¼©åŒ…sshä¼ è¾“ï¼Œå› ä¸ºä½¿ç”¨cpå‘½ä»¤åˆ°&#x2F;docker&#x2F;html&#x2F;devç›®å½•æŠ¥é”™äº†ï¼Œé‚é‡‡ç”¨ç¬¬äºŒç§æ–¹å¼\n#!&#x2F;bin&#x2F;bash\n\nnode -v \nnpm -v \nnpm i\nnpm run build:dev\nrm -rf dist.tar\ntar -zcvf dist.tar .&#x2F;dist\n\næ„å»ºæˆåŠŸåå¤šäº†ä¸ªdist.taræ–‡ä»¶\nè¿æ¥SSHæœåŠ¡å™¨ç³»ç»Ÿé…ç½®å·²ç»è®¾ç½®è¿‡sshç›¸å…³é…ç½®å†æ“ä½œä¸‹é¢ï¼Œå¦‚æœªè®¾ç½®ï¼Œè¯·å¾€ä¸Šç¿» Publish Over SSH\n\nå­—æ®µè¯´æ˜ï¼šSource filesï¼šå‡†å¤‡å‘é€çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ˜¯ç›¸å¯¹äºè¿™ä¸ªé¡¹ç›®çš„workspaceç›®å½•ã€‚ä¾‹å¦‚è¦å‘é€/docker/jenkins_home/workspace/gitlab_web/dist.taråˆ°ç›®æ ‡ç›®å½•ï¼Œåˆ™è®¾ç½®Source filesä¸ºdist.tarRemove prefixï¼šç›®æ ‡æ–‡ä»¶å‰ç¼€æ·»åŠ ï¼Œä¾‹å¦‚è¦æ“ä½œsrcä¸‹é¢çš„æŸä¸ªæ–‡ä»¶ï¼Œå°±è®¾ç½®æˆsrc,æœ¬æ¡ˆä¾‹æ˜¯è·Ÿç›®å½•ï¼Œæ— éœ€è®¾ç½®Remote directoryï¼šç›®æ ‡ç›®å½•ï¼Œæœ¬æ¡ˆä¾‹è¦å¤åˆ¶åˆ°devç¯å¢ƒä¸‹çš„distæ–‡ä»¶ï¼Œ/docker/html/devExec commandï¼šæœ€åæ‰§è¡Œçš„å‘½ä»¤ï¼Œå¯åœ¨è¿™é‡Œè¿›è¡Œè§£å‹ï¼Œåˆ é™¤ï¼Œå¤åˆ¶ç­‰æ“ä½œ\næ‰§è¡Œæ„å»ºåï¼Œå¯¹åº”ç›®å½•å·²ç»æœ‰äº†ä¸€ä¸ªdist.taræ–‡ä»¶\n\nè¿™æ ·è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œè¿˜éœ€è¦åˆ é™¤åŸæœ‰distæ–‡ä»¶å¤¹ï¼Œè§£å‹dist.tar,å†åˆ é™¤dist.tar,æœ€ç»ˆå‘½ä»¤å¦‚ä¸‹ä¿®æ”¹åˆšæ‰é…ç½®çš„sshæœ€ä¸‹æ–¹æœ‰ä¸ªExec command\ncd &#x2F;docker&#x2F;html&#x2F;dev\nrm  -rf   dist&#x2F;\ntar zxvf dist.tar\nrm dist.tar\nè‡³æ­¤ï¼Œshellå‘½ä»¤æ‰§è¡Œç»“æŸï¼Œç›®å‰çš„æ•ˆæœæ˜¯:gitlab é¡¹ç›®devåˆ†æ”¯gitæäº¤åï¼Œè§¦å‘jenkinsè‡ªåŠ¨æ„å»ºï¼Œè‡ªåŠ¨æ„å»ºä¼šå…ˆåœ¨æœåŠ¡å™¨ä»gitlabçš„devåˆ†æ”¯æ‹‰å–æœ€æ–°ä»£ç ï¼Œæ‰§è¡Œbuildæ‰“åŒ…åç”Ÿæˆdist.taræ–‡ä»¶ï¼Œç„¶åé€šè¿‡sshå°†å¯¹åº”dist.tarå‘é€åˆ°å¯¹åº”devç¯å¢ƒçš„é¡¹ç›®ç›®å½•è§£å‹dist.tarå¹¶æ›´æ–°å¯¹åº”æ–‡ä»¶ï¼Œå®ç°è‡ªåŠ¨æ›´æ–°devç¯å¢ƒ\n","slug":"automated-deployment","date":"2024-10-20T04:18:31.000Z","categories_index":"Academic","tags_index":"docker,nginx,jenkins,linux","author_index":"X-29"},{"id":"9668cd611991e16937a9fdd60d6dd807","title":"webå¤šç¯å¢ƒé…ç½®","content":"web ç«¯å¤šç¯å¢ƒé…ç½®å¤šç¯å¢ƒæ— éå°±æ˜¯è¯·æ±‚çš„æ¥å£ä¸ä¸€æ ·æ‰€ä»¥æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨ web ç«¯é…ç½®ä¸åŒçš„è¯·æ±‚æ¥å£çš„ç¯å¢ƒ\n1. å‡†å¤‡å·¥ä½œnpm init vite@latest\n\nå®Œæˆä¹‹åé•¿è¿™æ ·\n2.é…ç½®ä¸€äº›å˜é‡2.1 åœ¨æ ¹ç›®å½•ä¸‹æ–°å¢ config æ–‡ä»¶å¤¹config\nâ”œâ”€â”€ plugins.ts\nâ”œâ”€â”€ constant.ts\n\nconstant ç”¨äºé…ç½®ä¸€äº›å¸¸é‡&#x2F;&#x2F; åŸºæœ¬è·¯å¾„\nexport const VITE_BASE_PATH &#x3D; &quot;&#x2F;&quot;;\n&#x2F;&#x2F; åº”ç”¨åç§°\nexport const VITE_APP_TITLE &#x3D; &quot;xxx&quot;;\n&#x2F;&#x2F; å¼€å¯åŒ…ä¾èµ–åˆ†æ å¯è§†åŒ–\nexport const VITE_APP_ANALYZE &#x3D; false;\n&#x2F;&#x2F; å¼€å¯Gzipå‹ç¼©\nexport const VITE_APP_COMPRESS_GZIP &#x3D; false;\n&#x2F;&#x2F; å¼€å¯Gzipå‹ç¼©ï¼Œåˆ é™¤åŸæ–‡ä»¶\nexport const VITE_APP_COMPRESS_GZIP_DELETE_FILE &#x3D; false;\n&#x2F;&#x2F; å»é™¤ console\nexport const VITE_DROP_CONSOLE &#x3D; true;\n&#x2F;&#x2F; å¼€å¯å…¼å®¹\nexport const VITE_APP_LEGACY &#x3D; true;\n\nplugins ç”¨äºåç»­ vite æ’ä»¶çš„é…ç½®npm install vite-plugin-compression vite-plugin-remove-console --save-dev\n\nimport react from &quot;@vitejs&#x2F;plugin-react&quot;;\nimport viteCompression from &quot;vite-plugin-compression&quot;;\n\nimport removeConsole from &quot;vite-plugin-remove-console&quot;;\nimport &#123;\n  VITE_APP_COMPRESS_GZIP,\n  VITE_APP_COMPRESS_GZIP_DELETE_FILE,\n&#125; from &quot;.&#x2F;constant&quot;;\n\nexport const createVitePlugins &#x3D; (isBuild: boolean) &#x3D;&gt; &#123;\n  const vitePlugins &#x3D; [react(), removeConsole()];\n\n  if (isBuild) &#123;\n    if (VITE_APP_COMPRESS_GZIP) &#123;\n      vitePlugins.push(\n        viteCompression(&#123;\n          disable: true,\n          deleteOriginFile: VITE_APP_COMPRESS_GZIP_DELETE_FILE,\n        &#125;)\n      );\n    &#125;\n  &#125;\n\n  return vitePlugins;\n&#125;;\n\n3.æŸ¥çœ‹ vite.config.ts æ–‡ä»¶import &#123; defineConfig &#125; from &quot;vite&quot;;\nimport react from &quot;@vitejs&#x2F;plugin-react&quot;;\n\nexport default defineConfig(&#123;\n  plugins: [react()],\n&#125;);\n\nä¿®æ”¹ vite.config.ts æ–‡ä»¶\n\n\n\n\n\n\n\n\nå¦‚æœæç¤ºï¼šæ‰¾ä¸åˆ°æ¨¡å—â€œpathâ€æˆ–å…¶ç›¸åº”çš„ç±»å‹å£°æ˜ï¼Œæ™ºèƒ½å¯¼å…¥ä¸€ä¸‹å¯¼å…¥ç±»å‹å°±è¡Œï¼Œè¿™æ ·å°±æŠ¥é”™äº†\nimport &#123; ConfigEnv, loadEnv, UserConfig &#125; from &quot;vite&quot;;\nimport &#123; createVitePlugins &#125; from &quot;.&#x2F;config&#x2F;plugins&quot;;\nimport &#123; resolve &#125; from &quot;path&quot;;\nimport &#123; VITE_DROP_CONSOLE &#125; from &quot;.&#x2F;config&#x2F;constant&quot;;\n\nexport default (&#123; command, mode &#125;: ConfigEnv): UserConfig &#x3D;&gt; &#123;\n  const isBuild &#x3D; command.includes(&quot;build&quot;);\n  const root &#x3D; process.cwd();\n  const env &#x3D; loadEnv(mode, root);\n  const &#123; VITE_PORT &#125; &#x3D; env;\n\n  return &#123;\n    root: process.cwd(),\n    publicDir: &quot;public&quot;,\n    base: &quot;.&#x2F;&quot;,\n    plugins: createVitePlugins(isBuild),\n    css: &#123;\n      modules: &#123;\n        generateScopedName: &quot;[name]__[local]___[hash:base64:5]&quot;,\n        hashPrefix: &quot;prefix&quot;,\n      &#125;,\n      postcss: &#123;\n        plugins: [],\n      &#125;,\n      preprocessorOptions: &#123;\n        less: &#123;\n          javascriptEnabled: true,\n        &#125;,\n      &#125;,\n    &#125;,\n    resolve: &#123;\n      alias: &#123;\n        &quot;@&quot;: &#96;$&#123;resolve(__dirname, &quot;src&quot;)&#125;&#96;,\n      &#125;,\n      mainFields: [&quot;module&quot;, &quot;jsnext:main&quot;, &quot;jsnext&quot;],\n    &#125;,\n    clearScreen: true,\n    logLevel: &quot;info&quot;,\n    server: &#123;\n      open: true,\n      host: &quot;0.0.0.0&quot;,\n      port: parseInt(VITE_PORT),\n    &#125;,\n    build: &#123;\n      target: &quot;modules&quot;,\n      outDir: &quot;build&quot;,\n      assetsDir: &quot;assets&quot;,\n      cssCodeSplit: true,\n      assetsInlineLimit: 4096,\n      sourcemap: !isBuild,\n      chunkSizeWarningLimit: 500,\n      emptyOutDir: true,\n      manifest: false,\n      terserOptions: &#123;\n        compress: &#123;\n          keep_infinity: true,\n          drop_console: VITE_DROP_CONSOLE,\n        &#125;,\n      &#125;,\n    &#125;,\n    define: &#123;\n      _GLOBAL_VARS_: JSON.stringify(&#123;\n        ...env,\n        MODE: mode,\n        BUILD_TIME: new Date().toLocaleString(),\n      &#125;),\n    &#125;,\n  &#125;;\n&#125;;\n\n4.ä¿®æ”¹ package.json æ–‡ä»¶åŸå…ˆçš„ scripts éƒ¨åˆ†\n&quot;scripts&quot;: &#123;\n  &quot;dev&quot;: &quot;vite&quot;,\n  &quot;build&quot;: &quot;tsc -b &amp;&amp; vite build&quot;,\n  &quot;lint&quot;: &quot;eslint .&quot;,\n  &quot;preview&quot;: &quot;vite preview&quot;\n&#125;,\n\nä¿®æ”¹åçš„ scripts éƒ¨åˆ†\n&quot;scripts&quot;: &#123;\n  &quot;dev&quot;: &quot;vite --mode dev&quot;,\n  &quot;prod&quot;: &quot;vite --mode prod&quot;,\n  &quot;build:dev&quot;: &quot;tsc -b &amp;&amp; vite build --mode dev&quot;,\n  &quot;build:prod&quot;: &quot;tsc -b &amp;&amp; vite build --mode prod&quot;,\n  &quot;lint&quot;: &quot;eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0&quot;,\n  &quot;preview&quot;: &quot;vite preview&quot;\n&#125;,\n\n5.æ ¹ç›®å½•ä¸‹æ–°å¢ .env æ–‡ä»¶VITE_PORT &#x3D; 7200\nVITE_HOST &#x3D; http:&#x2F;&#x2F;dev.example.com &#x2F;&#x2F; ä¿®æ”¹ä¸ºä½ çš„åŸŸå,è¿™é‡Œå°±æ˜¯æµ‹è¯•ç¯å¢ƒçš„æ¥å£å‰ç¼€\n\n6.æ ¹ç›®å½•ä¸‹æ–°å¢ .env.prod æ–‡ä»¶VITE_PORT &#x3D; 7200\nVITE_HOST &#x3D; http:&#x2F;&#x2F;prod.example.com &#x2F;&#x2F; ä¿®æ”¹ä¸ºä½ çš„åŸŸå,è¿™é‡Œå°±æ˜¯ç”Ÿäº§ç¯å¢ƒçš„æ¥å£å‰ç¼€\n\n7.æ–°å¢ types ç›®å½•ï¼Œé‡Œé¢æ–°å¢ global.d.ts æ–‡ä»¶declare const _GLOBAL_VARS_: &#123;\n  VITE_HOST: string;\n  MODE: string;\n  &#x2F;&#x2F; å¦‚æœè¿˜æœ‰å…¶ä»–å˜é‡ï¼Œå¯ä»¥åœ¨è¿™é‡Œç»§ç»­å£°æ˜\n&#125;;\n\n8.ä¿®æ”¹ tsconfig.node.json æ–‡ä»¶åœ¨ include ä¸­åŠ å…¥\n&quot;compilerOptions&quot;: &#123;\n  &quot;jsx&quot;: &quot;react-jsx&quot;,\n&#125;,\n&quot;include&quot;: [&quot;src&#x2F;**&#x2F;*&quot;,&quot;config&#x2F;*&quot;,&quot;vite.config.ts&quot;,&quot;.&#x2F;types&#x2F;global.d.ts&quot;],\n\nå®Œæ•´çš„ tsconfig.node.json æ–‡ä»¶å¦‚ä¸‹ï¼š\n&#123;\n  &quot;compilerOptions&quot;: &#123;\n    &quot;jsx&quot;: &quot;react-jsx&quot;, &#x2F;&#x2F; ä¸ºäº†é¿å…è¯†åˆ«ä¸å‡ºjsxå’Œé¿å…æç¤ºéœ€è¦å¯¼å…¥reactçš„æç¤º\n    &quot;target&quot;: &quot;ES2022&quot;,\n    &quot;lib&quot;: [&quot;ES2023&quot;],\n    &quot;module&quot;: &quot;ESNext&quot;,\n    &quot;skipLibCheck&quot;: true,\n\n    &#x2F;* Bundler mode *&#x2F;\n    &quot;moduleResolution&quot;: &quot;bundler&quot;,\n    &quot;allowImportingTsExtensions&quot;: true,\n    &quot;isolatedModules&quot;: true,\n    &quot;moduleDetection&quot;: &quot;force&quot;,\n    &quot;noEmit&quot;: true,\n\n    &#x2F;* Linting *&#x2F;\n    &quot;strict&quot;: true,\n    &quot;noUnusedLocals&quot;: true,\n    &quot;noUnusedParameters&quot;: true,\n    &quot;noFallthroughCasesInSwitch&quot;: true\n  &#125;,\n  &quot;include&quot;: [&quot;src&#x2F;**&#x2F;*&quot;, &quot;config&#x2F;*&quot;, &quot;vite.config.ts&quot;, &quot;.&#x2F;types&#x2F;global.d.ts&quot;]\n&#125;\n\n9.åœ¨ src ç›®å½•ä¸‹åˆ›å»º constant.ts æ–‡ä»¶export const HOST &#x3D; _GLOBAL_VARS_.VITE_HOST;\nexport const MODE &#x3D; _GLOBAL_VARS_.MODE;\n\næŸ¥çœ‹æ•ˆæœnpm run dev\n\n\nnpm run prod\n\n\n","slug":"multiple-environments","date":"2024-10-20T02:15:18.000Z","categories_index":"Skill","tags_index":"React,web,Vite","author_index":"X-29"}]