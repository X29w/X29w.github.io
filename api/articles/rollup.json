{"title":"rollup","uid":"6d1a44d72f500b2ae165cfd01771a531","slug":"rollup","date":"2024-12-22T08:39:14.000Z","updated":"2024-12-22T10:16:45.524Z","comments":true,"path":"api/articles/rollup.json","keywords":null,"cover":"/images/rollup/cover.png","content":"<h1 id=\"rollup\"><a href=\"#rollup\" class=\"headerlink\" title=\"rollup\"></a>rollup</h1><h2 id=\"å‰ç«¯å·¥ç¨‹åŒ–å†ç¨‹\"><a href=\"#å‰ç«¯å·¥ç¨‹åŒ–å†ç¨‹\" class=\"headerlink\" title=\"å‰ç«¯å·¥ç¨‹åŒ–å†ç¨‹\"></a>å‰ç«¯å·¥ç¨‹åŒ–å†ç¨‹</h2><p><img src=\"/images/rollup/1.png\" alt=\"img\"></p>\n<h2 id=\"é™¤å±‘ä¼˜åŒ–-tree-shaking\"><a href=\"#é™¤å±‘ä¼˜åŒ–-tree-shaking\" class=\"headerlink\" title=\"é™¤å±‘ä¼˜åŒ–(tree shaking)\"></a>é™¤å±‘ä¼˜åŒ–(tree shaking)</h2><p>é™¤äº†å¯ä»¥ä½¿ç”¨ ES æ¨¡å—ä¹‹å¤–ï¼ŒRollup è¿˜å¯ä»¥é™æ€åˆ†æä½ å¯¼å…¥çš„ä»£ç ï¼Œå¹¶å°†æ’é™¤ä»»ä½•å®é™…ä¸Šæ²¡æœ‰ä½¿ç”¨çš„å†…å®¹ï¼Œä»ä¸Šé¢çš„å¼•å…¥å’Œæœ€åçš„æ‰“åŒ…ç»“æœå°±å¯ä»¥çœ‹åˆ°ï¼Œæ²¡æœ‰ä½¿ç”¨åˆ°çš„å†…å®¹ç›´æ¥è¢«åˆ é™¤äº†ã€‚</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>æ³¨æ„ï¼Œ<strong>é™¤å±‘ä¼˜åŒ–çš„æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µé€šè¿‡é™æ€åˆ†æç¡®å®šä»£ç çš„ä½¿ç”¨æƒ…å†µï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶</strong>ã€‚</p></blockquote>\n<p>æ‰€ä»¥é™¤å±‘ä¼˜åŒ–ä¸€èˆ¬æ˜¯å»ºç«‹åœ¨<strong>ES6 æ¨¡å—åŒ–è¯­æ³•</strong>åŸºç¡€ä¹‹ä¸Šçš„ï¼ŒESM çš„å¯¼å…¥å¯¼å‡ºæ˜¯é™æ€çš„ã€‚</p>\n<p>CommonJS æ¨¡å—çš„å¯¼å…¥å’Œå¯¼å‡ºæ˜¯åŠ¨æ€çš„ï¼Œæ— æ³•åœ¨ç¼–è¯‘é˜¶æ®µé™æ€ç¡®å®šä»£ç çš„ä½¿ç”¨æƒ…å†µã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé™¤å±‘ä¼˜åŒ–å·¥å…·æ— æ³•åœ¨ CommonJS æ¨¡å—ä¸­è¿›è¡Œç²¾ç¡®çš„é™¤å±‘ï¼Œå› ä¸ºæ— æ³•é™æ€åˆ†ææ¨¡å—é—´çš„å¯¼å…¥å’Œå¯¼å‡ºå…³ç³»ã€‚</p>\n<p>ç„¶è€Œï¼Œä¸€äº›æ„å»ºå·¥å…·ï¼ˆå¦‚ Webpackï¼‰ä¼šå°è¯•é€šè¿‡é™æ€åˆ†æå’Œå¯å‘å¼æ–¹æ³•å¯¹ CommonJS æ¨¡å—è¿›è¡Œè¿‘ä¼¼çš„é™¤å±‘ä¼˜åŒ–ã€‚å®ƒä»¬ä¼šå°½å¯èƒ½åœ°è¯†åˆ«å‡ºé‚£äº›å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µç¡®å®šæœªè¢«ä½¿ç”¨çš„ä»£ç ï¼Œå¹¶è¿›è¡Œå‰”é™¤ã€‚ä½†è¿™ç§å¤„ç†æ–¹å¼å¯èƒ½ä¸å¦‚å¯¹ ES6 æ¨¡å—çš„ä¼˜åŒ–æ•ˆæœå¥½ï¼Œä¸”æœ‰ä¸€å®šçš„é™åˆ¶ã€‚</p>\n<p><strong>é™¤å±‘ä¼˜åŒ–çš„åŸç†ï¼š</strong></p>\n<ol start=\"0\">\n<li>é™æ€åˆ†æï¼šå¯¹ JavaScript ä»£ç è¿›è¡Œé™æ€åˆ†æï¼Œè¯†åˆ«å‡ºæ¨¡å—çš„å¯¼å…¥å’Œå¯¼å‡ºå…³ç³»ã€‚</li>\n<li>æ ‡è®°æœªä½¿ç”¨ä»£ç ï¼šæ ‡è®°å‡ºåœ¨å¯¼å…¥å’Œå¯¼å‡ºå…³ç³»ä¸Šæ²¡æœ‰è¢«ä½¿ç”¨çš„ä»£ç ã€‚è¿™äº›ä»£ç å¯èƒ½æ˜¯æ¨¡å—çš„å¯¼å‡ºå‡½æ•°ã€å˜é‡ã€ç±»ç­‰ã€‚</li>\n<li>å‰”é™¤æœªä½¿ç”¨ä»£ç ï¼šæ ¹æ®æ ‡è®°ç»“æœï¼Œæ„å»ºå·¥å…·ä¼šå°†æœªè¢«ä½¿ç”¨çš„ä»£ç ä»æœ€ç»ˆçš„æ‰“åŒ…ç»“æœä¸­å‰”é™¤ï¼Œåªä¿ç•™è¢«ä½¿ç”¨çš„éƒ¨åˆ†ã€‚</li>\n</ol>\n<p>ç”±äºæ˜¯é™æ€åˆ†æï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„è‡ªå·±çš„å†™æ³•ï¼Œç®€å•æ¥è¯´ï¼Œå°½é‡çš„ä½¿ç”¨æœ€å°å¯¼å…¥ï¼Œæ¯”å¦‚ä½ å¯ä»¥æ¯”è¾ƒä¸€ä¸‹æˆ‘ä»¬è¿™é‡Œå¯¼å…¥ä»£ç ä¹‹åï¼Œæ‰“åŒ…çš„åŒºåˆ«ï¼š</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; ç›´æ¥é»˜è®¤å¯¼å…¥æ•´ä¸ªå¯¹è±¡\nimport util from &quot;.&#x2F;util.js&quot;;\nconst r &#x3D; util.getRandomNum(1, 10)\nconsole.log(r)\nâ€‹\n&#x2F;&#x2F; å…·åå¯¼å…¥å…·ä½“çš„å‡½æ•°\nimport &#123; getRandomNum &#125; from &quot;.&#x2F;util.js&quot;;\nconst r &#x3D; getRandomNum(1, 10)\nconsole.log(r)</code></pre>\n\n<h2 id=\"ä¸-webpack-æ‰“åŒ…çš„åŒºåˆ«\"><a href=\"#ä¸-webpack-æ‰“åŒ…çš„åŒºåˆ«\" class=\"headerlink\" title=\"ä¸ webpack æ‰“åŒ…çš„åŒºåˆ«\"></a>ä¸ webpack æ‰“åŒ…çš„åŒºåˆ«</h2><p>è¿™ä¸ªæ‰“åŒ…ç»“æœå…¶å®å°±å·²ç»å’Œæˆ‘ä»¬ç†ŸçŸ¥çš„<strong>webpack</strong>æœ‰äº†å¾ˆé²œæ˜çš„åŒºåˆ«ï¼Œæˆ‘ä»¬æŠŠ webpack å®‰è£…ä¸€ä¸‹è¯•è¯•</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pnpm add webpack webpack-cli -D</code></pre>\n\n<p>è¿è¡Œ webpack-cliï¼š</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># --entry å…¥å£æ–‡ä»¶ -o æ‰“åŒ…æ–‡ä»¶å¤¹ä½ç½® --mode æ‰“åŒ…æ¨¡å¼\nnpx webpack --entry .&#x2F;src&#x2F;index.js -o dist --mode development</code></pre>\n\n<p>å½“ç„¶æˆ‘ä»¬å¯ä»¥é€‰æ‹©ç”Ÿæˆæ¨¡å¼è¿›è¡Œæ‰“åŒ…</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">npx webpack --entry .&#x2F;src&#x2F;index.js -o dist --mode production</code></pre>\n\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">(() &#x3D;&gt; &#123;\n  &quot;use strict&quot;;\n  const o &#x3D;\n    ((t &#x3D; 1),\n    (a &#x3D; 10),\n    (t &#x3D; Math.ceil(t)),\n    (a &#x3D; Math.floor(a)),\n    Math.floor(Math.random() * (a - t + 1)) + t);\n  var t, a;\n  console.log(o);\n&#125;)();</code></pre>\n\n<p>ç°åœ¨æ‰“åŒ…å‡ºæ¥çš„å†…å®¹å°±ç›´æ¥æ˜¯å‹ç¼©ä¹‹åçš„ä»£ç äº†</p>\n<h2 id=\"é…ç½®æ–‡ä»¶\"><a href=\"#é…ç½®æ–‡ä»¶\" class=\"headerlink\" title=\"é…ç½®æ–‡ä»¶\"></a>é…ç½®æ–‡ä»¶</h2><p><code>Rollup</code>é…ç½®æ–‡ä»¶æ˜¯ä¸€ä¸ª ES æ¨¡å—ã€‚é€šå¸¸ï¼Œå®ƒè¢«ç§°ä¸º <code>rollup.config.js</code> æˆ– <code>rollup.config.mjs</code>ï¼Œå¹¶ä½äºé¡¹ç›®çš„æ ¹ç›®å½•ä¸­ã€‚å®ƒå¯¼å‡ºä¸€ä¸ªé»˜è®¤å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æ‰€éœ€çš„é€‰é¡¹ï¼š</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>æ³¨æ„ : <strong>å¦‚æœæƒ³è¦ç±»å‹æç¤ºï¼Œè¯·åœ¨ rollup.config.js æ–‡ä»¶é¡¶éƒ¨æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</strong></p></blockquote>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\n\nexport default &#123;\n  input: &quot;src&#x2F;index.js&quot;,\n  output: &#123;\n    file: &quot;dist&#x2F;bundle.js&quot;,\n    format: &quot;esm&quot;,\n  &#125;,\n&#125;;</code></pre>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><strong>æ³¨æ„</strong>ï¼šnodejs ç¯å¢ƒä¸‹è¦è¿è¡Œ esm æ¨¡å—åŒ–çš„å†…å®¹ï¼Œè¦ä¹ˆæ–‡ä»¶ååç¼€å¤„ç†ä¸º <strong>.mjs</strong>ï¼Œè¦ä¹ˆ package.json æ–‡ä»¶ä¸­é…ç½® <strong>â€œtypeâ€:â€moduleâ€</strong> ï¼Œå› ä¸º Rollup å°†éµå¾ª <a href=\"https://nodejs.org/docs/latest-v14.x/api/packages.html#packages_determining_module_system\">Node ESM è¯­ä¹‰</a>ã€‚</p></blockquote>\n<h1 id=\"å¸¸ç”¨é…ç½®\"><a href=\"#å¸¸ç”¨é…ç½®\" class=\"headerlink\" title=\"å¸¸ç”¨é…ç½®\"></a>å¸¸ç”¨é…ç½®</h1><h2 id=\"å¤šäº§ç‰©é…ç½®\"><a href=\"#å¤šäº§ç‰©é…ç½®\" class=\"headerlink\" title=\"å¤šäº§ç‰©é…ç½®\"></a>å¤šäº§ç‰©é…ç½®</h2><p>æˆ‘ä»¬å¯ä»¥å°† output æ”¹é€ æˆä¸€ä¸ªæ•°ç»„ï¼Œå¯¹å¤–æš´éœ²å‡ºä¸åŒæ ¼å¼çš„äº§ç‰©ä¾›ä»–äººä½¿ç”¨ï¼Œä¸ä»…åŒ…æ‹¬ <code>ESM</code>ï¼Œä¹Ÿéœ€è¦åŒ…æ‹¬è¯¸å¦‚<code>CommonJS</code>ã€<code>UMD</code>ç­‰æ ¼å¼ï¼Œä¿è¯è‰¯å¥½çš„å…¼å®¹æ€§</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; defineConfig &#125; from &quot;rollup&quot;;\n\nexport default defineConfig(&#123;\n  input: &quot;src&#x2F;index.js&quot;,\n  output: [\n    &#123;\n      file: &quot;dist&#x2F;bundle-iife.js&quot;,\n      format: &quot;iife&quot;,\n    &#125;,\n    &#123;\n      file: &quot;dist&#x2F;bundle-esm.js&quot;,\n      format: &quot;esm&quot;,\n    &#125;,\n    &#123;\n      file: &quot;dist&#x2F;bundle-cjs.js&quot;,\n      format: &quot;cjs&quot;,\n    &#125;,\n    &#123;\n      file: &quot;dist&#x2F;bundle-umd.js&quot;,\n      format: &quot;umd&quot;,\n      name: &quot;bundle&quot;,\n    &#125;,\n  ],\n&#125;);</code></pre>\n\n<h2 id=\"å¤šå…¥å£é…ç½®\"><a href=\"#å¤šå…¥å£é…ç½®\" class=\"headerlink\" title=\"å¤šå…¥å£é…ç½®\"></a>å¤šå…¥å£é…ç½®</h2><p>é™¤äº†å¤šäº§ç‰©é…ç½®ï¼ŒRollup ä¸­ä¹Ÿæ”¯æŒå¤šå…¥å£é…ç½®</p>\n<p><strong>main.js</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; src&#x2F;main.js\nimport util from &quot;.&#x2F;util.js&quot;;\nconst r &#x3D; util.getRandomNum(1, 10);\nconsole.log(&quot;ğŸš€ ~ r:&quot;, r);\n\nconst obj &#x3D; &#123;\n  a: 1,\n  b: &#123;\n    c: 3,\n  &#125;,\n&#125;;\nconst cloneObj &#x3D; util.deepClone(obj);\ncloneObj.b.c &#x3D; 4;\nconsole.log(&quot;ğŸš€ ~ obj:&quot;, obj);\nconsole.log(&quot;ğŸš€ ~ cloneObj:&quot;, cloneObj);</code></pre>\n\n<p><strong>rollup.config.js</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; defineConfig &#125; from &#39;rollup&#39;\n\nexport default defineConfig(&#123;\n  input: [&#39;src&#x2F;index.js&#39;,&#39;src&#x2F;main.js&#39;],\n  output: [\n    &#123;\n      dir: &#39;dist&#39;,\n      format: &#39;cjs&#39;\n    &#125;\n  ],\n&#125;)</code></pre>\n\n<p>é€šå¸¸æƒ…å†µä¸‹å¤šäº§ç‰©å’Œå¤šå…¥å£ä¸¤è€…ä¼šè¢«ç»“åˆèµ·æ¥ä½¿ç”¨</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; defineConfig &#125; from &#39;rollup&#39;\nexport default defineConfig(&#123;\n  input: [&#39;src&#x2F;index.js&#39;,&#39;src&#x2F;main.js&#39;],\n  output: [\n    &#123;\n      dir: &#39;cjs&#39;,\n      format: &#39;cjs&#39;\n    &#125;,\n    &#123;\n      dir: &#39;esm&#39;,\n      format: &#39;esm&#39;\n    &#125;\n  ],\n&#125;)</code></pre>\n\n<p>å½“ç„¶ï¼Œä¸Šé¢è¿™æ ·çš„å†™çš„è¯ï¼Œç”Ÿæˆçš„äº§ç‰©ä¼šæŠŠä¸¤ä¸ªå…¥å£ä¸€èµ·è¿›è¡Œæ„å»ºï¼Œæˆ‘ä»¬å¯èƒ½çš„æƒ³æ³•æ˜¯ä¸€ä¸ªå…¥å£ä¸€ç§æ„å»ºæ–¹å¼ï¼š</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; defineConfig &#125; from &#39;rollup&#39;\n&#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildIndexOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;umd&#x2F;&#39;,\n    format: &#39;umd&#39;,\n    name: &#39;bundle&#39;\n  &#125;\n&#125;\n\n&#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildMainOptions &#x3D; &#123;\n  input: &#39;src&#x2F;main.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    format: &#39;esm&#39;,\n  &#125;\n&#125;\nexport default [buildIndexOptions, buildMainOptions];</code></pre>\n\n<h2 id=\"åŠ¨æ€å¯¼å…¥ä¸é»˜è®¤ä»£ç åˆ†å‰²\"><a href=\"#åŠ¨æ€å¯¼å…¥ä¸é»˜è®¤ä»£ç åˆ†å‰²\" class=\"headerlink\" title=\"åŠ¨æ€å¯¼å…¥ä¸é»˜è®¤ä»£ç åˆ†å‰²\"></a>åŠ¨æ€å¯¼å…¥ä¸é»˜è®¤ä»£ç åˆ†å‰²</h2><p>ä½¿ç”¨è·¯ç”±æ¥è¯´æ˜æ‡’åŠ è½½æ˜¯å¤§å®¶å–œé—»ä¹è§çš„æ–¹å¼ï¼Œä¼°è®¡å¤§å¤šæ•°åŒå­¦å¯¹äºæ‡’åŠ è½½éƒ½åªæ˜¯åœç•™åœ¨è·¯ç”±çš„æ‡’åŠ è½½ï¼Œå…¶å®ï¼Œä»»ä½•æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä½¿ç”¨ import åŠ¨æ€æ‡’åŠ è½½çš„æ–¹å¼ã€‚é‡æ–°ç¼–è¾‘ä¸€ä¸‹ main.js å…¥å£ï¼š</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; src&#x2F;main.js\nfunction run() &#123;\n  &#x2F;&#x2F; å¦‚æœä¸æ¸…æ¥šimportåŠ¨æ€å¯¼å…¥è¿”å›çš„æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥å…ˆæ‰“å°ä¸€ä¸‹ä¸‹é¢ç»“æœ\n  &#x2F;&#x2F; import(&quot;.&#x2F;util.js&quot;).then(chunk &#x3D;&gt; console.log(&quot;ğŸš€ ~ chunk:&quot;, chunk));\n\n  import(&quot;.&#x2F;util.js&quot;).then((&#123; default: foo &#125;) &#x3D;&gt; &#123;\n    const r &#x3D; foo.getRandomNum(1, 10);\n    console.log(&quot;ğŸš€ ~ r:&quot;, r);\n  &#125;);\n&#125;\nrun();</code></pre>\n\n<p>é‡æ–°è¿è¡Œå¯ä»¥çœ‹åˆ° dist ç›®å½•å½¢æˆäº†ä¸‹é¢çš„ç»“æ„:</p>\n<pre class=\"line-numbers language-erlang\" data-language=\"erlang\"><code class=\"language-erlang\">.\nâ”œâ”€â”€ dist\nâ”‚ â”œâ”€â”€ esm\nâ”‚ â”‚ â”œâ”€â”€ main.js\nâ”‚ â”‚ â””â”€â”€ util-371e3ef9.js\nâ”‚ â””â”€â”€ umd\nâ”‚     â””â”€â”€ index.js\nâ””â”€â”€ ...</code></pre>\n\n<p>Rollup å°†ä½¿ç”¨åŠ¨æ€å¯¼å…¥åˆ›å»ºä¸€ä¸ªä»…åœ¨éœ€è¦æ—¶åŠ è½½çš„å•ç‹¬å—ã€‚æ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°è¿™é‡Œå¤šäº†ä¸€ä¸ª<code>util-371e3ef9.js</code>çš„æ–‡ä»¶</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><strong>æ³¨æ„ï¼š</strong> ä¸ºäº†è®© Rollup çŸ¥é“åœ¨å“ªé‡Œæ”¾ç½®ç¬¬äºŒä¸ªå—ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨ <code>--file</code> é€‰é¡¹ï¼Œè€Œæ˜¯ä½¿ç”¨ <code>--dir</code> é€‰é¡¹è®¾ç½®ä¸€ä¸ªè¾“å‡ºæ–‡ä»¶å¤¹</p></blockquote>\n<p>å…¶ä¸­ï¼Œ<code>util-371e3ef9.js</code>æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„<code>chunk-[hash].js</code>çš„åå­—ï¼Œ<code>[hash]</code> æ˜¯åŸºäºå†…å®¹çš„å“ˆå¸Œå­—ç¬¦ä¸²ã€‚ä½ å¯ä»¥é€šè¿‡æŒ‡å®š <a href=\"https://cn.rollupjs.org/configuration-options/#output-chunkfilenames\"><code>output.chunkFileNames</code></a> (chunk æ–‡ä»¶)å’Œ <a href=\"https://cn.rollupjs.org/configuration-options/#output-entryfilenames\"><code>output.entryFileNames</code></a> (æ‰“åŒ…å…¥å£æ–‡ä»¶)é€‰é¡¹æ¥æä¾›è‡ªå·±çš„å‘½åæ¨¡å¼ã€‚</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildMainOptions &#x3D; &#123;\n  input: &#39;src&#x2F;main.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    entryFileNames: &#39;[name].js&#39;,\n    chunkFileNames: &#39;chunk-[name]-[hash].js&#39;,\n    format: &#39;esm&#39;,\n  &#125;\n&#125;</code></pre>\n\n<p>è€Œä¸”ï¼Œå¾ˆæ™ºèƒ½çš„æ˜¯ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘å®šä¹‰äº†åˆå¤šä¸ªå…¥å£ç‚¹éƒ½è°ƒç”¨äº†<code>util.js</code>æ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨çš„å¼•å…¥åˆ†å‰²å‡ºæ¥çš„æ–‡ä»¶</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildMainOptions &#x3D; &#123;\n  input: [&#39;src&#x2F;main.js&#39;, &#39;src&#x2F;main2.js&#39;],\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    entryFileNames: &#39;[name].js&#39;,\n    chunkFileNames: &#39;chunk-[name]-[hash].js&#39;,\n    format: &#39;esm&#39;,\n  &#125;\n&#125;</code></pre>\n\n<p>åœ¨æ‰“åŒ…åçš„ main2.js ä¸­ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ ·çš„å¼•ç”¨ï¼š</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import util from &quot;.&#x2F;chunk-util-371e3ef9.js&quot;;</code></pre>\n\n<h2 id=\"ä½¿ç”¨æ’ä»¶\"><a href=\"#ä½¿ç”¨æ’ä»¶\" class=\"headerlink\" title=\"ä½¿ç”¨æ’ä»¶\"></a>ä½¿ç”¨æ’ä»¶</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ç”¨å…¥å£æ–‡ä»¶å’Œé€šè¿‡ç›¸å¯¹è·¯å¾„å¯¼å…¥çš„æ¨¡å—æ‰“äº†ä¸€ä¸ªç®€å•çš„åŒ…ã€‚éšç€ä½ éœ€è¦æ‰“åŒ…æ›´å¤æ‚çš„ä»£ç ï¼Œé€šå¸¸éœ€è¦æ›´çµæ´»çš„é…ç½®ï¼Œä¾‹å¦‚å¯¼å…¥ä½¿ç”¨ NPM å®‰è£…çš„æ¨¡å—ã€ä½¿ç”¨ Babel ç¼–è¯‘ä»£ç ã€å¤„ç† JSON æ–‡ä»¶ç­‰ç­‰ã€‚</p>\n<p>æ’ä»¶åˆ—è¡¨ ï¼š <a href=\"https://github.com/rollup/awesome\">the Rollup Awesome List</a>ã€‚</p>\n<h3 id=\"rollup-x2F-plugin-node-resolve\"><a href=\"#rollup-x2F-plugin-node-resolve\" class=\"headerlink\" title=\"@rollup&#x2F;plugin-node-resolve\"></a><a href=\"https://github.com/rollup/plugins/tree/master/packages/node-resolve\">@rollup&#x2F;plugin-node-resolve</a></h3><p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨å¼•å…¥ lodash-es åº“</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pnpm add lodash-es -D</code></pre>\n\n<p>åœ¨ index.js ä¸­ä½¿ç”¨</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; chunk &#125; from &quot;lodash-es&quot;;\nconst r &#x3D; chunk([1, 2, 3, 4], 2);\nconsole.log(&quot;ğŸš€ ~ r:&quot;, r);</code></pre>\n\n<p>ç°åœ¨ç›´æ¥æ‰“åŒ…</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildIndexOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    format: &#39;esm&#39;,\n  &#125;\n&#125;\nexport default buildIndexOptions</code></pre>\n\n<p>ä¼šå‡ºç°ä¸‹é¢çš„è­¦å‘Šï¼š</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">src&#x2F;index.js â†’ dist&#x2F;esm&#x2F;...\n(!) Unresolved dependencies\nhttps:&#x2F;&#x2F;rollupjs.org&#x2F;troubleshooting&#x2F;#warning-treating-module-as-external-dependency\nlodash-es (imported by &quot;src&#x2F;index.js&quot;)\ncreated dist&#x2F;esm&#x2F; in 13ms</code></pre>\n\n<p>æ„æ€æ˜¯ï¼Œä¸èƒ½è§£æ<code>lodash-es</code>è¿™ä¸ªä¾èµ–ï¼ŒæŠ¥å‡ºäº†è­¦å‘Šï¼Œé—®ä½ æ˜¯ä¸æ˜¯éœ€è¦<code>external</code>ï¼Œå¹¶æç¤ºä½ ç‚¹å‡»é“¾æ¥æœ‰è¿™ä¸ªè­¦å‘Šçš„è§£é‡Šã€‚å½“æˆ‘ä»¬ç‚¹å‡»è¿™ä¸ªé“¾æ¥ï¼ŒæŒ‰ç…§æç¤ºè§£å†³è¿™ä¸ª external è­¦å‘Šé—®é¢˜ï¼Œå¾ˆç®€å•ï¼Œå°±åŠ ä¸Š externalï¼Œä¹Ÿå°±æ˜¯æŠŠ<code>lodash-es</code>è¿™ä¸ªåº“ç»™æ’é™¤å‡ºå»</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">const buildIndexOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    format: &#39;esm&#39;,\n  &#125;,\n+  external: [&#39;lodash-es&#39;]\n&#125;\nexport default buildIndexOptions</code></pre>\n\n<p>å†æ­¤æ‰“åŒ…ï¼Œæœç„¶æ²¡è­¦å‘Šäº†ï¼Œè€Œä¸”æˆ‘ä»¬åœ¨ nodejs ç¯å¢ƒä¸­ç¡®å®ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œäº†</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><strong>æ³¨æ„ï¼šå¯¹äºæ²¡æœ‰å¤ªå¤šå¼€å‘ç»éªŒçš„åŒå­¦æ¥è¯´ï¼Œè¿™é‡Œæ„Ÿè§‰é—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯éœ€è¦ç†è§£ä¸ºä»€ä¹ˆ</strong></p>\n<p><strong>æ³¨æ„ï¼šå¯¹äºæ²¡æœ‰å¤ªå¤šå¼€å‘ç»éªŒçš„åŒå­¦æ¥è¯´ï¼Œè¿™é‡Œæ„Ÿè§‰é—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯éœ€è¦ç†è§£ä¸ºä»€ä¹ˆ</strong></p>\n<p><strong>æ³¨æ„ï¼šå¯¹äºæ²¡æœ‰å¤ªå¤šå¼€å‘ç»éªŒçš„åŒå­¦æ¥è¯´ï¼Œè¿™é‡Œæ„Ÿè§‰é—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯éœ€è¦ç†è§£ä¸ºä»€ä¹ˆ</strong></p></blockquote>\n<p>é‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼Œè¿™é‡Œè™½ç„¶çœ‹ä¼¼ä¸€ä¸ªå¾ˆå°çš„é—®é¢˜ï¼Œä½†æ˜¯å´æœ‰å¾ˆå¤šåŸºæœ¬ç†è®ºç‚¹</p>\n<p>1ã€rollup é»˜è®¤åªèƒ½è§£æå¯¼å…¥çš„ç›¸å¯¹è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯<code>/</code> ï¼Œ <code>./</code>æˆ–è€…<code>../</code>å¼€å¤´çš„è·¯å¾„ï¼Œå¯¹äº<code>bare import</code>ï¼Œä¹Ÿå°±æ˜¯<code>import &#123; chunk &#125; from &#39;lodash-es&#39;;</code>è¿™ç§ç›´æ¥å¯¼å…¥çš„ç¬¬ä¸‰æ–¹åŒ…çš„æ ¼å¼ï¼Œå¹¶ä¸æ”¯æŒ</p>\n<p>2ã€<code>rollup</code>ç›¸æ¯”<code>webpack</code>æœ€å¤§çš„ä¼˜åŠ¿å¹¶ä¸æ˜¯æ„å»ºä¸€ä¸ªè¶³å¤Ÿå¤§çš„åº”ç”¨æ‰“åŒ…ï¼Œå¤§å¤šæ˜¯æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>rollup</code>ç”¨æ¥æ„å»ºå·¥å…·åº“ï¼Œå› æ­¤ï¼Œè¿™é‡Œå¯¼å…¥çš„<code>lodash-es</code>å¹¶æ²¡æœ‰æŠ¥é”™ï¼Œè€Œä»…ä»…æŠ¥å‡ºè­¦å‘Šï¼Œå› ä¸º<code>rollup</code>è®¤ä¸º<code>lodash-es</code>è¿™ä¸ªåº“å¹¶æ²¡æœ‰åŠ å…¥æ„å»ºï¼Œé‚£ä¹ˆä½ çš„æ„æ€æ˜¯å°†æ¥ç”¨ä½œç¬¬ä¸‰æ–¹åº“æ¥ä½¿ç”¨ï¼Œå› æ­¤å°†<code>lodash-es</code>ä½¿ç”¨é…ç½®<code>external</code>æ’é™¤æ‰å°±å¥½ã€‚</p>\n<p>3ã€<code>lodash-es</code>è¿™ä¸ªåŒ…æœ¬èº«å°±æ˜¯æ”¯æŒ ESM çš„</p>\n<p>4ã€æœ€åæ‰“åŒ…å¥½çš„<code>index.js</code>æ–‡ä»¶åªæ‰€ä»¥åœ¨<code>nodejs</code>ç¯å¢ƒä¸‹è¿è¡Œï¼Œæ˜¯å› ä¸º<code>nodejs</code>å¯ä»¥å¸®æˆ‘ä»¬è§£æ<code>bare import</code>ï¼Œæˆ‘ä»¬å¯ä»¥è¯•ç€å°†<code>index.js</code>æ”¾å…¥åˆ°<code>html</code>æ–‡ä»¶ä¸­è¿è¡Œï¼Œä½ å°±å¯ä»¥çœ‹åˆ°å…¶ä¸­çš„é—®é¢˜æ‰€åœ¨ï¼Œåœ¨ html ç¯å¢ƒä¸­å°±ä¼šæŠ¥é”™äº†ï¼š<code>index.html:1 Uncaught TypeError: Failed to resolve module specifier &quot;lodash-es&quot;. Relative references must start with either &quot;/&quot;, &quot;./&quot;, or &quot;../&quot;.</code></p>\n<p>å¦‚æœå¸Œæœ›åœ¨æœ€åçš„æ‰“åŒ…ä¸­ï¼Œå°†<code>lodash-es</code>å†…å®¹è§£ææ‰“åŒ…è¿›å»ï¼Œå°±å¯ä»¥ä½¿ç”¨<code>@rollup/plugin-node-resolve</code></p>\n<p><strong>å®‰è£…:</strong></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pnpm add @rollup&#x2F;plugin-node-resolve --save-dev</code></pre>\n\n<p><strong>ä½¿ç”¨ï¼š</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; nodeResolve &#125; from &#39;@rollup&#x2F;plugin-node-resolve&#39;;\n&#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildIndexOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    format: &#39;esm&#39;,\n  &#125;,\n  plugins: [nodeResolve()]\n  &#x2F;&#x2F; external: [&#39;lodash-es&#39;]\n&#125;\nexport default buildIndexOptions</code></pre>\n\n<p>ç°åœ¨ï¼Œå†æ­¤è¿›è¡Œæ‰“åŒ…ï¼Œæ— è®ºæ˜¯æ‰“åŒ…æ—¶é—´ï¼Œè¿˜æ˜¯æ‰“åŒ…å†…å®¹å’Œä¹‹å‰éƒ½å¾ˆä¸ä¸€æ ·äº†ï¼ŒæŠŠ<code>lodash-es</code>ä¸­ï¼Œå…³äº<code>chunk()</code>å‡½æ•°çš„å†…å®¹ï¼Œéƒ½æ‰“åŒ…è¿›äº†<code>index.js</code>æ–‡ä»¶ä¸­</p>\n<h3 id=\"output-manualChunks\"><a href=\"#output-manualChunks\" class=\"headerlink\" title=\"output.manualChunks\"></a><a href=\"https://cn.rollupjs.org/configuration-options/#output-manualchunks\">output.manualChunks</a></h3><p>ä¸Šé¢è®²äº†å¯¹äºåŠ¨æ€åŠ è½½æ¨¡å—ï¼Œrollup å¸®æˆ‘ä»¬è‡ªåŠ¨åšäº†ä»£ç åˆ†å‰²ï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨çš„æ“ä½œï¼Œç›´æ¥åœ¨ rollup é…ç½®ä¸­å£°æ˜</p>\n<pre class=\"line-numbers language-less\" data-language=\"less\"><code class=\"language-less\">const buildIndexOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    format: &#39;esm&#39;,\n    entryFileNames: &#39;[name].js&#39;,\n    chunkFileNames: &#39;chunk-[name]-[hash].js&#39;,\n    manualChunks: &#123;\n      &#39;lodash-es&#39;: [&#39;lodash-es&#39;],\n    &#125;\n    &#x2F;&#x2F;ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°å½¢å¼\n    &#x2F;&#x2F; manualChunks(id)&#123;\n    &#x2F;&#x2F;   if(id.includes(&#39;lodash-es&#39;))&#123;\n    &#x2F;&#x2F;     return &#39;lodash-es&#39;\n    &#x2F;&#x2F;   &#125;\n    &#x2F;&#x2F; &#125;\n\t&#125;,\n  plugins: [nodeResolve()]\n&#125;</code></pre>\n\n<h3 id=\"rollup-x2F-plugin-commonjs\"><a href=\"#rollup-x2F-plugin-commonjs\" class=\"headerlink\" title=\"@rollup&#x2F;plugin-commonjs\"></a><a href=\"https://github.com/rollup/plugins/tree/master/packages/commonjs\">@rollup&#x2F;plugin-commonjs</a></h3><p>ä¸Šé¢æœ€å¼€å§‹å¯¼å…¥<code>lodash-es</code>ï¼Œæ²¡æœ‰åŠ å…¥<code>external</code>å’Œ<code>plugins</code>ï¼Œä¹‹æ‰€ä»¥è¿˜èƒ½ç›´æ¥è¿è¡Œï¼Œè¿˜å› ä¸º<code>lodash-es</code>æœ¬èº«å°±æ˜¯æ”¯æŒ ESM çš„ï¼Œå› ä¸º rollup é»˜è®¤å¹¶ä¸æ”¯æŒ Commonjs æ¨¡å—åŒ–ï¼Œæ¯”å¦‚å°† lodash-es æ¢ä½ lodashï¼Œé©¬ä¸Šå°±èƒ½çœ‹åˆ°ä¸ä¸€æ ·çš„æ•ˆæœ,ç›´æ¥æ‰“åŒ…å¤±è´¥</p>\n<pre class=\"line-numbers language-vbnet\" data-language=\"vbnet\"><code class=\"language-vbnet\">[!] RollupError: &quot;chunk&quot; is not exported by &quot;node_modules&#x2F;.pnpm&#x2F;lodash@4.17.21&#x2F;node_modules&#x2F;lodash&#x2F;lodash.js&quot;, imported by &quot;src&#x2F;index.js&quot;.\nhttps:&#x2F;&#x2F;rollupjs.org&#x2F;troubleshooting&#x2F;#error-name-is-not-exported-by-module</code></pre>\n\n<p>è¿™ä¸ªé”™è¯¯åœ¨å®˜ç½‘ä¸Šè§£é‡Šçš„å¾ˆæ¸…æ¥šäº†ï¼Œæ— éå°±æ˜¯ commonjs æ²¡æœ‰è¿™ç§å¯¼å‡ºï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦<code>@rollup/plugin-commonjs</code>å¸®æˆ‘ä»¬å¤„ç† commonjs æ¨¡å—åŒ–çš„é—®é¢˜</p>\n<p><strong>å®‰è£…:</strong></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pnpm add @rollup&#x2F;plugin-commonjs --save-dev</code></pre>\n\n<p><strong>ä½¿ç”¨:</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; nodeResolve &#125; from &#39;@rollup&#x2F;plugin-node-resolve&#39;;\n+import commonjs from &#39;@rollup&#x2F;plugin-commonjs&#39;;\n&#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildIndexOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    format: &#39;esm&#39;,\n  &#125;,\n+  plugins: [nodeResolve(), commonjs()]\n&#125;\nexport default buildIndexOptions</code></pre>\n\n<h3 id=\"rollup-x2F-plugin-babel\"><a href=\"#rollup-x2F-plugin-babel\" class=\"headerlink\" title=\"@rollup&#x2F;plugin-babel\"></a><a href=\"https://github.com/rollup/plugins/tree/master/packages/babel\">@rollup&#x2F;plugin-babel</a></h3><p>ä½¿ç”¨ <a href=\"https://babeljs.io/\">Babel</a> æ¥ä½¿ç”¨å°šæœªè¢«æµè§ˆå™¨å’Œ Node.js æ”¯æŒçš„æœ€æ–° JavaScript ç‰¹æ€§ã€‚</p>\n<p>ä½¿ç”¨ Babel å’Œ Rollup æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ <a href=\"https://github.com/rollup/plugins/tree/master/packages/babel\">@rollup&#x2F;plugin-babel</a></p>\n<p><strong>å®‰è£…:</strong></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pnpm add @rollup&#x2F;plugin-babel -D</code></pre>\n\n<p><strong>ä½¿ç”¨ï¼š</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; nodeResolve &#125; from &#39;@rollup&#x2F;plugin-node-resolve&#39;;\nimport commonjs from &#39;@rollup&#x2F;plugin-commonjs&#39;;\n+import babel from &#39;@rollup&#x2F;plugin-babel&#39;;\n&#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildIndexOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    format: &#39;esm&#39;,\n  &#125;,\n  plugins: [\n    nodeResolve(),\n    commonjs(),\n+    babel(&#123; babelHelpers: &#39;bundled&#39; &#125;)\n  ]\n&#125;\nexport default buildIndexOptions</code></pre>\n\n<p>ä¸è¿‡è¿™ä¹ˆåšä¹‹åï¼Œæ‰“åŒ…ä»£ç å¹¶ä¸ä¼šæœ‰ä»€ä¹ˆå˜åŒ–ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½çŸ¥é“ babel æ˜¯éœ€è¦é¢„è®¾çš„.</p>\n<p>å®‰è£… <a href=\"https://babeljs.io/docs/en/babel-core\"><code>babel-core</code></a> å’Œ <a href=\"https://babeljs.io/docs/en/babel-preset-env\"><code>env</code></a> é¢„è®¾</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pnpm add -D @babel&#x2F;core @babel&#x2F;preset-env</code></pre>\n\n<p>åœ¨ Babel å®é™…ç¼–è¯‘ä»£ç ä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œé…ç½®ã€‚åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªåä¸º <code>.babelrc.json</code> çš„æ–°æ–‡ä»¶</p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&#123;\n  &quot;presets&quot;: [&quot;@babel&#x2F;preset-env&quot;]\n&#125;</code></pre>\n\n<p>å…·ä½“çš„ babel è®¾ç½®ï¼Œå¯ä»¥å‚è€ƒ<a href=\"https://babeljs.io/docs/config-files#project-wide-configuration\"><strong>babel æ–‡æ¡£</strong></a></p>\n<h4 id=\"é¢˜å¤–è¯ï¼š-babel-x2F-runtime\"><a href=\"#é¢˜å¤–è¯ï¼š-babel-x2F-runtime\" class=\"headerlink\" title=\"é¢˜å¤–è¯ï¼š@babel&#x2F;runtime\"></a>é¢˜å¤–è¯ï¼š@babel&#x2F;runtime</h4><p>æˆ‘ä»¬åœ¨<code>index.js</code>ä»£ç ä¸­åŠ å…¥å¦‚ä¸‹çš„ api</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; getRandomNum &#125; from &quot;.&#x2F;util.js&quot;;\nconst r &#x3D; getRandomNum(1, 10);\nconsole.log(r);\n\nconst arr &#x3D; [1, 2, 3, 4].map((item) &#x3D;&gt; item * item);\nconsole.log(&quot;ğŸš€ ~ arr:&quot;, arr);\n\nPromise.resolve(1).then((res) &#x3D;&gt; &#123;\n  console.log(res);\n&#125;);</code></pre>\n\n<p>æˆ‘ä»¬é€šè¿‡ babel å¤„ç†ä¹‹åä¼šå‘ç°ä¸€äº›é—®é¢˜ï¼š</p>\n<p>@babel&#x2F;preset-env åªè½¬æ¢äº†è¯­æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„ç®­å¤´å‡½æ•°ã€const ä¸€ç±»ï¼Œä½†æ˜¯å¯¹äºè¿›ä¸€æ­¥éœ€è¦è½¬æ¢å†…ç½®å¯¹è±¡ã€å®ä¾‹æ–¹æ³•ç­‰ç­‰ APIï¼Œå°±æ˜¾å¾—æ— èƒ½ä¸ºåŠ›äº†ï¼Œè¿™äº›ä»£ç éœ€è¦<strong>polyfill(å…¼å®¹æ€§å«ç‰‡)</strong> ã€‚æ‰€ä»¥è¿™ä¸ªæˆ‘éœ€è¦<code>@babel/runtime</code>æ¥å¸®æˆ‘ä»¬å¤„ç†ã€‚</p>\n<p><code>@babel/runtime</code>æ˜¯ä¸€ä¸ªæ ¸å¿ƒï¼Œ ä¸€ç§å®ç°æ–¹å¼ï¼Œä½†æ˜¯åœ¨å®ç° polyfill å«ç‰‡çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå¾ˆå¤šé‡å¤çš„ä»£ç ï¼Œæ‰€ä»¥éœ€è¦<code>@babel/plugin-transform-runtime</code>é˜²æ­¢æ±¡æŸ“å…¨å±€ï¼Œ æŠ½ç¦»å…¬å…±çš„ helper function , é˜²æ­¢å†—ä½™ï¼Œå½“ç„¶åœ¨å¤„ç† polyfill çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ core-js çš„è¾…åŠ©ï¼ŒåŸºäº babelï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>@babel/runtime-corejs3</code></p>\n<p><strong>å®‰è£…ï¼š</strong></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pnpm add @babel&#x2F;plugin-transform-runtime -D\npnpm add @babel&#x2F;runtime @babel&#x2F;runtime-corejs3</code></pre>\n\n<p>è¦ä½¿ç”¨<code>@babel/plugin-transform-runtime</code>ï¼Œ<code>@rollup/plugin-babel</code>çš„<a href=\"https://github.com/rollup/plugins/tree/master/packages/babel#babelhelpers\"><strong>babelHelper</strong></a>å¤„ç†å¿…é¡»æ”¹ä¸º runtime</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; nodeResolve &#125; from &#39;@rollup&#x2F;plugin-node-resolve&#39;;\nimport commonjs from &#39;@rollup&#x2F;plugin-commonjs&#39;;\nimport babel from &#39;@rollup&#x2F;plugin-babel&#39;;\nimport typescript from &#39;@rollup&#x2F;plugin-typescript&#39;;\n&#x2F;**\n * @type &#123;import(&#39;rollup&#39;).RollupOptions&#125;\n *&#x2F;\nconst buildIndexOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  output: &#123;\n    dir: &#39;dist&#x2F;esm&#x2F;&#39;,\n    format: &#39;esm&#39;,\n  &#125;,\n  plugins: [\n    nodeResolve(),\n    commonjs(),\n    babel(&#123;\n      babelHelpers: &#39;runtime&#39;,\n      include: &#39;src&#x2F;**&#39;,\n      exclude: &#39;node_modules&#x2F;**&#39;,\n      extensions:[&#39;.js&#39;, &#39;.ts&#39;]\n    &#125;),\n    typescript(),\n  ]\n&#125;\nexport default buildIndexOptions</code></pre>\n\n<p><strong>.babelrc.jsonï¼š</strong></p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&#123;\n  &quot;presets&quot;: [\n    [\n      &quot;@babel&#x2F;preset-env&quot;,\n      &#123;\n        &quot;targets&quot;: &quot;&gt; 0.25%, not dead&quot;,\n        &quot;useBuiltIns&quot;: &quot;usage&quot;,\n        &quot;corejs&quot;: 3\n      &#125;\n    ]\n  ],\n  &quot;plugins&quot;: [\n    [\n      &quot;@babel&#x2F;plugin-transform-runtime&quot;,\n      &#123;\n        &quot;corejs&quot;: 3\n      &#125;\n    ]\n  ]\n&#125;</code></pre>\n\n<p>è¿™ä¸ªæ—¶å€™ä½ å†è¿›è¡Œæ„å»ºï¼Œä¼šå‘ç°æ‰“åŒ…åçš„æ–‡ä»¶å¤šå‡ºäº†ä¸€å¤§å †ï¼Œè¿™å…¶å®å°±æ˜¯ polyfill ä¸­çš„ä»£ç ã€‚</p>\n<h3 id=\"rollup-x2F-plugin-typescript\"><a href=\"#rollup-x2F-plugin-typescript\" class=\"headerlink\" title=\"@rollup&#x2F;plugin-typescript\"></a><a href=\"https://github.com/rollup/plugins/tree/master/packages/typescript\">@rollup&#x2F;plugin-typescript</a></h3><p>è¦ä½¿ç”¨ typescript å°±éœ€è¦ä¾èµ–è¿™ä¸ªæ’ä»¶ï¼Œå½“ç„¶è¿™ä¸ªæ’ä»¶æœ¬èº«è¿˜ä¾èµ–äº†<code>typescript</code>å’Œ<code>tslib</code>ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¼å…¥ 3 ä¸ªåŒ…</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pnpm add typescript tslib @rollup&#x2F;plugin-typescript -D</code></pre>\n\n<p><strong>util.ts</strong></p>\n<pre class=\"line-numbers language-typescript\" data-language=\"typescript\"><code class=\"language-typescript\">&#x2F;**\n * æ·±æ‹·è´\n * @param obj éœ€è¦æ·±æ‹·è´çš„å¯¹è±¡\n * @returns æ·±æ‹·è´å¯¹è±¡\n *&#x2F;\nexport const deepClone &#x3D; &lt;T&gt;(obj: T): T &#x3D;&gt; &#123;\n  if (typeof obj !&#x3D;&#x3D; &quot;object&quot; || obj &#x3D;&#x3D;&#x3D; null) &#123;\n    return obj;\n  &#125;\n  const result: any &#x3D; Array.isArray(obj) ? [] : &#123;&#125;;\n  for (let key in obj) &#123;\n    if (obj.hasOwnProperty(key)) &#123;\n      result[key] &#x3D; deepClone(obj[key]);\n    &#125;\n  &#125;\n  return result;\n&#125;;\n\nexport const getRandomNum &#x3D; (min: number, max: number): number &#x3D;&gt; &#123;\n  let num &#x3D; Math.floor(Math.random() * (min - max) + max);\n  return num;\n&#125;;</code></pre>\n\n<p>Index.ts</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; getRandomNum,deepClone &#125; from &#39;.&#x2F;util.ts&#39;;\nconst r &#x3D; getRandomNum(1, 10);\nconsole.log(r);\n\nconst obj &#x3D; &#123; a: 1, b: &#123; c: 3 &#125; &#125;;\nconst obj2 &#x3D; deepClone(obj);\nobj2.b.c &#x3D; 4;\n\nconsole.log(obj);\nconsole.log(obj2);</code></pre>\n\n<p>å½“ç„¶ï¼Œé…ç½®æ–‡ä»¶æˆ‘ä»¬ä¹Ÿå®Œå…¨å¯ä»¥æ˜¯ ts çš„</p>\n<p><strong>rollup.config.ts</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; RollupOptions &#125; from &quot;rollup&quot;\nimport &#123; nodeResolve &#125; from &#39;@rollup&#x2F;plugin-node-resolve&#39;;\nimport commonjs from &#39;@rollup&#x2F;plugin-commonjs&#39;;\nimport babel from &#39;@rollup&#x2F;plugin-babel&#39;;\nimport typescript from &#39;@rollup&#x2F;plugin-typescript&#39;;\n\nconst config: RollupOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.ts&#39;,\n  output: &#123;\n    file: &#39;dist&#x2F;umd&#x2F;index.js&#39;,\n    format: &#39;umd&#39;,\n    name: &#39;rollupDemo&#39;,\n  &#125;,\n  plugins: [\n    nodeResolve(),\n    commonjs(),\n    babel(&#123;\n      babelHelpers: &#39;runtime&#39;,\n      include: &#39;src&#x2F;**&#39;,\n      exclude: &#39;node_modules&#x2F;**&#39;,\n      extensions:[&#39;.js&#39;, &#39;.ts&#39;]\n    &#125;),\n    typescript(),\n  ],\n&#125;\nexport default config;</code></pre>\n\n<p><strong>tsconfig.json</strong></p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&#123;\n  &quot;compilerOptions&quot;: &#123;\n    &quot;module&quot;: &quot;esnext&quot;,\n    &quot;target&quot;: &quot;es5&quot;,\n    &quot;lib&quot;: [&quot;esnext&quot;, &quot;dom&quot;, &quot;dom.iterable&quot;],\n    &quot;skipLibCheck&quot;: true,\n\n    &quot;moduleResolution&quot;: &quot;bundler&quot;,\n    &quot;noEmit&quot;: true,\n    &quot;allowImportingTsExtensions&quot;: true,\n    &quot;resolveJsonModule&quot;: true,\n    &quot;isolatedModules&quot;: true\n  &#125;,\n  &quot;include&quot;: [&quot;src&#x2F;**&#x2F;*&quot;, &quot;rollup.config.ts&quot;]\n&#125;</code></pre>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><strong>æ³¨æ„ï¼š</strong> åˆ«å¿˜è®° tsconfig.json æ–‡ä»¶ä¸­éœ€è¦åŠ å…¥ rollup.config.ts é…ç½®æ–‡ä»¶,ä¸ç„¶è¦æŠ¥é”™</p></blockquote>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&#123;\n  &quot;compilerOptions&quot;: &#123;\n    ......\n  &#125;,\n+  &quot;include&quot;: [&quot;src&#x2F;**&#x2F;*&quot;,&quot;rollup.config.ts&quot;],\n&#125;</code></pre>\n\n<p><strong>è¿è¡Œï¼š</strong></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">npx rollup -c rollup.config.ts --configPlugin typescript</code></pre>\n\n<h1 id=\"æ„å»º-react-åº”ç”¨\"><a href=\"#æ„å»º-react-åº”ç”¨\" class=\"headerlink\" title=\"æ„å»º react åº”ç”¨\"></a>æ„å»º react åº”ç”¨</h1><h2 id=\"node-modules\"><a href=\"#node-modules\" class=\"headerlink\" title=\"node_modules\"></a>node_modules</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># react\npnpm add react react-dom\n\n# @types&#x2F;react\npnpm add @types&#x2F;react @types&#x2F;react-dom -D\n\n# reacté¢„è®¾\npnpm add @babel&#x2F;preset-react -D\n\n# rollup\npnpm add rollup -D\n\n# rollupå¸¸è§„æ’ä»¶\npnpm add @rollup&#x2F;plugin-node-resolve @rollup&#x2F;plugin-commonjs -D\n\n# typescriptç›¸å…³\npnpm add typescript tslib @rollup&#x2F;plugin-typescript -D\n\n# @rollup&#x2F;plugin-babelç›¸å…³\npnpm add @rollup&#x2F;plugin-babel @babel&#x2F;core @babel&#x2F;preset-env -D\n\n# @babel&#x2F;runtimeç›¸å…³\npnpm add @babel&#x2F;plugin-transform-runtime @babel&#x2F;runtime @babel&#x2F;runtime-corejs3 -D\n\n# htmlæ–‡ä»¶æ¨¡æ¿\npnpm add rollup-plugin-generate-html-template -D\n\n# æ›¿æ¢å­—ç¬¦ä¸²\npnpm add @rollup&#x2F;plugin-replace -D\n\n# å¼€å‘æœåŠ¡å™¨ä¸live server\npnpm add rollup-plugin-serve rollup-plugin-livereload -D\n\n# clearæ’ä»¶\npnpm add rollup-plugin-clear -D\n\n# scss\npnpm add rollup-plugin-scss sass -D\n\n# postcss\npnpm add postcss rollup-plugin-postcss -D\n\n# å›¾ç‰‡å¤„ç†\npnpm add @rollup&#x2F;plugin-image -D\n\n# nodejs typescriptç±»å‹\npnpm add @types&#x2F;node -D\n\n# åˆ«åæ’ä»¶\npnpm add @rollup&#x2F;plugin-alias -D\n\n# terser\npnpm add @rollup&#x2F;plugin-terser -D\n\n# visualizer\npnpm add rollup-plugin-visualizer -D</code></pre>\n\n<h2 id=\"tsconfig-json\"><a href=\"#tsconfig-json\" class=\"headerlink\" title=\"tsconfig.json\"></a>tsconfig.json</h2><pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&#123;\n  &quot;compilerOptions&quot;: &#123;\n    &quot;module&quot;: &quot;esnext&quot;,\n    &quot;target&quot;: &quot;es5&quot;,\n    &quot;lib&quot;: [&quot;esnext&quot;, &quot;dom&quot;, &quot;dom.iterable&quot;],\n    &quot;skipLibCheck&quot;: true,\n\n    &quot;moduleResolution&quot;: &quot;bundler&quot;,\n    &quot;noEmit&quot;: true,\n    &quot;allowImportingTsExtensions&quot;: true,\n    &quot;resolveJsonModule&quot;: true,\n    &quot;isolatedModules&quot;: true,\n    &quot;jsx&quot;: &quot;preserve&quot;,\n\n    &quot;baseUrl&quot;: &quot;.&#x2F;&quot;,\n    &quot;paths&quot;: &#123;\n      &quot;@&#x2F;*&quot;: [&quot;src&#x2F;*&quot;]\n    &#125;\n  &#125;,\n  &quot;include&quot;: [&quot;src&#x2F;**&#x2F;*&quot;, &quot;rollup.config.ts&quot;, &quot;global.d.ts&quot;]\n&#125;</code></pre>\n\n<h2 id=\"babelrc-json\"><a href=\"#babelrc-json\" class=\"headerlink\" title=\".babelrc.json\"></a>.babelrc.json</h2><pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&#123;\n  &quot;presets&quot;: [\n    [\n      &quot;@babel&#x2F;preset-env&quot;,\n      &#123;\n        &quot;targets&quot;: &quot;&gt; 0.25%, not dead&quot;,\n        &quot;useBuiltIns&quot;: &quot;usage&quot;,\n        &quot;corejs&quot;: 3\n      &#125;\n    ],\n    [&quot;@babel&#x2F;preset-react&quot;]\n  ],\n  &quot;plugins&quot;: [\n    [\n      &quot;@babel&#x2F;plugin-transform-runtime&quot;,\n      &#123;\n        &quot;corejs&quot;: 3\n      &#125;\n    ]\n  ]\n&#125;</code></pre>\n\n<h2 id=\"rollup-config-ts\"><a href=\"#rollup-config-ts\" class=\"headerlink\" title=\"rollup.config.ts\"></a>rollup.config.ts</h2><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; RollupOptions &#125; from &quot;rollup&quot;;\nimport &#123; nodeResolve &#125; from &quot;@rollup&#x2F;plugin-node-resolve&quot;;\nimport commonjs from &quot;@rollup&#x2F;plugin-commonjs&quot;;\nimport babel from &quot;@rollup&#x2F;plugin-babel&quot;;\nimport typescript from &quot;@rollup&#x2F;plugin-typescript&quot;;\nimport htmlTemplate from &quot;rollup-plugin-generate-html-template&quot;;\nimport serve from &quot;rollup-plugin-serve&quot;;\nimport livereload from &quot;rollup-plugin-livereload&quot;;\nimport replace from &quot;@rollup&#x2F;plugin-replace&quot;;\nimport postcss from &quot;rollup-plugin-postcss&quot;;\nimport alias from &quot;@rollup&#x2F;plugin-alias&quot;;\nimport clear from &quot;rollup-plugin-clear&quot;;\nimport image from &quot;@rollup&#x2F;plugin-image&quot;\nimport terser from &#39;@rollup&#x2F;plugin-terser&#39;;\nimport &#123; fileURLToPath &#125; from &quot;node:url&quot;;\nimport &#123; visualizer &#125; from &quot;rollup-plugin-visualizer&quot;;\n\nconst config: RollupOptions &#x3D; &#123;\n  input: &quot;src&#x2F;main.tsx&quot;,\n  output: &#123;\n    dir: &quot;dist&#x2F;&quot;,\n    format: &quot;esm&quot;,\n    name: &quot;rollupDemo&quot;,\n    sourcemap: true,\n    plugins: [terser()],\n    entryFileNames: &quot;[name].[hash:6].js&quot;,\n    chunkFileNames: &quot;chunks&#x2F;chunk-[name]-[hash].js&quot;,\n    &#x2F;&#x2F; ä»£ç åˆ†å‰²\n    &#x2F;&#x2F; manualChunks: &#123;\n    &#x2F;&#x2F;   react: [&quot;react&quot;, &quot;react-dom&quot;]\n    &#x2F;&#x2F; &#125;,\n    globals: &#123;\n      react: &quot;React&quot;,\n      &quot;react-dom&quot;: &quot;ReactDOM&quot;,\n    &#125;,\n    paths: &#123;\n      react: &quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;react@18.2.0&#x2F;+esm&quot;,\n      &quot;react-dom&quot;: &quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;react-dom@18.2.0&#x2F;+esm&quot;,\n    &#125;\n  &#125;,\n  external: [&quot;react&quot;, &quot;react-dom&quot;],\n  plugins: [\n    visualizer(),\n    nodeResolve(&#123;\n      extensions: [&quot;.js&quot;, &quot;jsx&quot;, &quot;ts&quot;, &quot;tsx&quot;],\n    &#125;),\n    commonjs(),\n    typescript(),\n    babel(&#123;\n      babelHelpers: &quot;runtime&quot;,\n      include: &quot;src&#x2F;**&quot;,\n      exclude: &quot;node_modules&#x2F;**&quot;,\n      extensions: [&quot;.js&quot;, &quot;.ts&quot;, &quot;jsx&quot;, &quot;tsx&quot;],\n    &#125;),\n    alias(&#123;\n      entries: [\n        &#123;\n          find: &quot;@&quot;,\n          replacement: fileURLToPath(new URL(&quot;src&quot;, import.meta.url)),\n        &#125;,\n      ],\n    &#125;),\n    postcss(&#123;\n      extensions: [&quot;.js&quot;], &#x2F;&#x2F; å°†scssè§£ææˆcss\n      extract: true,\n      modules: true,\n    &#125;),\n    replace(&#123;\n      preventAssignment: true,\n      &quot;process.env.NODE_ENV&quot;: JSON.stringify(&quot;production&quot;), &#x2F;&#x2F; å¦åˆ™ä¼šæŠ¥ï¼šprocess is not definedçš„é”™\n    &#125;),\n    clear(&#123;\n      targets: [&quot;dist&quot;],\n    &#125;),\n    htmlTemplate(&#123;\n      template: &quot;public&#x2F;index.html&quot;,\n      target: &quot;dist&#x2F;index.html&quot;,\n      attrs: [&#39;type&#x3D;&quot;module&quot;&#39;],\n    &#125;),\n    image(),\n    serve(&quot;dist&quot;),\n    livereload(&quot;src&quot;),\n  ],\n&#125;;\nexport default config;</code></pre>\n\n<h1 id=\"npm-å‘åŒ…\"><a href=\"#npm-å‘åŒ…\" class=\"headerlink\" title=\"npm å‘åŒ…\"></a>npm å‘åŒ…</h1><h1 id=\"npm-å‘å¸ƒ\"><a href=\"#npm-å‘å¸ƒ\" class=\"headerlink\" title=\"npm å‘å¸ƒ\"></a>npm å‘å¸ƒ</h1><h2 id=\"node-modules-1\"><a href=\"#node-modules-1\" class=\"headerlink\" title=\"node_modules\"></a>node_modules</h2><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># rollup\npnpm add rollup -D\n\n# rollupå¸¸è§„æ’ä»¶\npnpm add @rollup&#x2F;plugin-node-resolve @rollup&#x2F;plugin-commonjs -D\n\n# typescriptç›¸å…³\npnpm add typescript tslib @rollup&#x2F;plugin-typescript -D\n\n# @rollup&#x2F;plugin-babelç›¸å…³\npnpm add @rollup&#x2F;plugin-babel @babel&#x2F;core @babel&#x2F;preset-env -D\n\n# lodash-es\npnpm add lodash-es\n\n# @types&#x2F;lodash-es\npnpm add @types&#x2F;lodash-es -D</code></pre>\n\n<h2 id=\"tsconfig-json-æ–‡ä»¶\"><a href=\"#tsconfig-json-æ–‡ä»¶\" class=\"headerlink\" title=\"tsconfig.json æ–‡ä»¶\"></a>tsconfig.json æ–‡ä»¶</h2><pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&#x2F;&#x2F; tsconfig.json\n&#123;\n  &quot;compilerOptions&quot;: &#123;\n    &quot;target&quot;: &quot;es5&quot;,\n    &quot;module&quot;: &quot;ESNext&quot;,\n    &quot;declaration&quot;: true,&#x2F;&#x2F; æ ¹æ®tsæ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆ.d.tså£°æ˜æ–‡ä»¶å’Œjsæ–‡ä»¶\n    &quot;emitDeclarationOnly&quot;: true, &#x2F;&#x2F; åªè¾“å‡º.d.tså£°æ˜æ–‡ä»¶ï¼Œä¸ç”Ÿæˆjsæ–‡ä»¶\n    &quot;outDir&quot;: &quot;.&#x2F;dist&quot;, &#x2F;&#x2F; è¾“å‡ºç›®å½•\n\t\t......\n  &#125;\n&#125;</code></pre>\n\n<h2 id=\"æœ¬åœ°è°ƒè¯•-link-å®‰è£…\"><a href=\"#æœ¬åœ°è°ƒè¯•-link-å®‰è£…\" class=\"headerlink\" title=\"æœ¬åœ°è°ƒè¯• link å®‰è£…\"></a>æœ¬åœ°è°ƒè¯• link å®‰è£…</h2><p>æœ€ç»ˆæ‰“åŒ…çš„æ–‡ä»¶å¤¹æ˜¯ dist æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ package.json æ–‡ä»¶å’Œ README.md æ–‡ä»¶éƒ½æ‹·è´åˆ° dist ç›®å½•ä¸­ã€‚</p>\n<p>npm link åœ°å€å…¶å®å°±æ˜¯å…¨å±€å®‰è£…åœ°å€ï¼š</p>\n<p><strong>mac:</strong> <code>/usr/local/lib/node_modules/</code></p>\n<p><strong>Windows:</strong> <code>c:\\ç”¨æˆ·(Users)\\ä½ çš„ç”¨æˆ·å\\AppData(éšè—æ–‡ä»¶å¤¹)\\Roaming\\npm\\node_modules</code></p>\n<p><a href=\"https://pnpm.io/zh/cli/link#pnpm-link---global\">pnpm link</a></p>\n<p>åœ¨åº“æ–‡ä»¶çš„ dist ç›®å½•ä¸‹æ‰§è¡Œï¼š</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pnpm link --global</code></pre>\n\n<p>è¿™ä¸ªå‘½ä»¤ä¼šè¯»å– package.json æ–‡ä»¶ä¸­çš„ nameï¼Œä½œä¸ºåŒ…æ–‡ä»¶çš„åå­—ï¼Œä½ å¯ä»¥ç†è§£ä¸ºï¼Œç›¸å½“äº pnpm å°†æˆ‘ä»¬æ‰“åŒ…çš„é¡¹ç›®ï¼Œå…¨å±€å®‰è£…åœ¨äº†æœ¬åœ°</p>\n<p>åœ¨ç›®æ ‡é¡¹ç›®ä¸­ï¼Œä½¿ç”¨å‘½ä»¤</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pnpm link --global åŒ…å</code></pre>\n\n<p>è¿›è¡Œå®‰è£…ã€‚</p>\n<p><strong>å¸è½½ link</strong> <a href=\"https://pnpm.io/zh/cli/unlink\">pnpm unlink</a></p>\n<h2 id=\"å‘å¸ƒåˆ°-npm\"><a href=\"#å‘å¸ƒåˆ°-npm\" class=\"headerlink\" title=\"å‘å¸ƒåˆ° npm\"></a>å‘å¸ƒåˆ° npm</h2><p>å¸¸ç”¨å‘½ä»¤ï¼š</p>\n<ul>\n<li><code>npm whoami</code> æ£€æµ‹å½“å‰ç™»å½•çŠ¶æ€</li>\n<li><code>npm config ls</code> æ˜¾ç¤ºå½“å‰ npm é…ç½®ä¿¡æ¯</li>\n<li><code>npm addUser</code> ã€<code>npm login</code> ç™»å½•</li>\n<li><code>npm config set registry é“¾æ¥åœ°å€</code> åˆ‡æ¢æºåœ°å€</li>\n<li><code>npm publish</code> å‘å¸ƒ</li>\n</ul>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>æ³¨æ„å¿…é¡»ä½¿ç”¨ npm æºé•œåƒæ‰èƒ½å‘å¸ƒï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯é˜¿é‡Œæºç­‰é•œåƒï¼Œéœ€è¦åˆ‡æ¢æˆæºé•œåƒæ‰èƒ½å‘å¸ƒ <code>https://registry.npmjs.org/</code></p></blockquote>\n<h1 id=\"JavaScript-API\"><a href=\"#JavaScript-API\" class=\"headerlink\" title=\"JavaScript API\"></a>JavaScript API</h1><p>Rollup æä¾›äº†ä¸€ä¸ªå¯ä» Node.js ä½¿ç”¨çš„ JavaScript APIã€‚ä½ å¾ˆå°‘éœ€è¦ä½¿ç”¨å®ƒï¼Œä¸è¿‡é€šè¿‡è¿™ä¸ª API æˆ‘ä»¬å¯ä»¥æ¯”è¾ƒæ˜æ˜¾çš„çŸ¥é“ rollup çš„æ„å»ºå¤§è‡´æµç¨‹ã€‚</p>\n<p>å†…å®¹å…¶å®å¹¶ä¸å¤šï¼Œä¸»è¦æ ¸å¿ƒä¸¤ä¸ªå‡½æ•°ï¼Œrollup()ä¸ watch()</p>\n<ul>\n<li><p>rollup.rollup</p>\n<ul>\n<li>inputOptions å¯¹è±¡</li>\n<li>outputOptions å¯¹è±¡</li>\n</ul>\n</li>\n<li><p>rollup.watch</p>\n<ul>\n<li>watchOptions</li>\n</ul>\n</li>\n</ul>\n<p>å…¶å®ç”¨èµ·æ¥çš„åŸºæœ¬æ€è·¯å’Œé…ç½®æ–‡ä»¶å·®ä¸å¤šã€‚ç›´æ¥æ¥çœ‹ä¸€ä¸‹æ•ˆæœï¼š</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">const rollup &#x3D; require(&#39;rollup&#39;);\n\nconst inputOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  external: [],\n  plugins: []\n&#125;\n\nconst outputOptions &#x3D; &#123;\n  dir: &#39;dist&#39;,\n  format: &#39;esm&#39;,\n  sourcemap: true,\n  entryFileNames: &#39;[name].[hash].js&#39;\n&#125;\n\nasync function build() &#123;\n  let bundle;\n  let buildFailed &#x3D; false;\n  try &#123;\n    bundle &#x3D; await rollup.rollup(inputOptions);\n    await bundle.write(outputOptions);\n  &#125; catch (error) &#123;\n    buildFailed &#x3D; true;\n    console.error(error);\n  &#125;\n\n  if (bundle) &#123;\n    &#x2F;&#x2F; å…³é—­æ‰“åŒ…è¿‡ç¨‹\n    await bundle.close();\n  &#125;\n  process.exit(buildFailed ? 1 : 0);\n&#125;\n\nbuild();\n\nconst watchOptions &#x3D; &#123;\n  ...inputOptions,\n  output: [outputOptions],\n  watch: &#123;\n    include: &#39;src&#x2F;**&#39;,\n    exclude: &#39;node_modules&#x2F;**&#39;\n  &#125;\n&#125;;\nconst watcher &#x3D; rollup.watch(watchOptions);\n\nwatcher.on(&#39;event&#39;, event &#x3D;&gt; &#123;\n  console.log(event);\n  &#x2F;&#x2F;ç¡®ä¿æ¯æ¬¡æ‰“åŒ…å®Œæˆåæ­£ç¡®çš„å…³é—­æ‰“åŒ…\n  if (event.result) &#123;\n    event.result.close();\n  &#125;\n&#125;)</code></pre>\n\n<p>å…¶å®æ•´ä¸ªè¿‡ç¨‹æ— éå°±æ˜¯æŠŠæˆ‘ä»¬ä¹‹å‰é…ç½®çš„æµç¨‹è½¬æ¢ä½äº† js ä»£ç çš„å½¢å¼ã€‚<code>watch api</code>å¾ˆæ˜æ˜¾å°±æ˜¯å‘½ä»¤è¡Œä¸­ä½¿ç”¨ <code>--watch</code> æ ‡å¿—è¿è¡Œ Rollup æ—¶çš„æ•ˆæœã€‚</p>\n<h2 id=\"ä¸¤å¤§æ„å»ºå·¥ä½œæµ\"><a href=\"#ä¸¤å¤§æ„å»ºå·¥ä½œæµ\" class=\"headerlink\" title=\"ä¸¤å¤§æ„å»ºå·¥ä½œæµ\"></a>ä¸¤å¤§æ„å»ºå·¥ä½œæµ</h2><p>æˆ‘ä»¬ä¸»è¦æ¥çœ‹ä¸€ä¸‹<code>rollup()</code>å‡½æ•°ï¼Œä»<code>rollup()</code>å‡½æ•°å°±å¯ä»¥çœ‹å‡ºï¼Œrollup æ‰“åŒ…æ„å»ºæµç¨‹ä¸»è¦æ˜¯ä¸¤å¤§æ­¥éª¤ï¼š</p>\n<h3 id=\"1ã€build\"><a href=\"#1ã€build\" class=\"headerlink\" title=\"1ã€build\"></a>1ã€build</h3><p>ä¸»è¦è´Ÿè´£åˆ›å»ºæ¨¡å—ä¾èµ–ï¼Œåˆå§‹åŒ–å“¥å“¥æ¨¡å—çš„ AST(æŠ½è±¡è¯­æ³•æ ‘)ï¼Œä»¥åŠæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">const rollup &#x3D; require(&#39;rollup&#39;);\n\nconst inputOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  external: [],\n  plugins: []\n&#125;\n\nasync function build() &#123;\n  const bundle &#x3D; await rollup.rollup(inputOptions);\n  console.log(bundle); &#x2F;&#x2F; æ‰“å°bundleå¯¹è±¡\n  console.log(bundle.cache.modules); &#x2F;&#x2F;æ‰“å°æ¨¡å—å†…å®¹\n&#125;\n\nbuild();</code></pre>\n\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; æ‰“å°bundleå¯¹è±¡\n&#123;\n  cache: &#123;\n    modules: [ [Object], [Object], [Object] ],\n    plugins: [Object: null prototype] &#123;&#125;\n  &#125;,\n  close: [AsyncFunction: close],\n  closed: false,\n  generate: [AsyncFunction: generate],\n  watchFiles: [\n    &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;index.js&#39;,\n    &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;randomNumber.js&#39;,\n    &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;deepClone.js&#39;\n  ],\n  write: [AsyncFunction: write]\n&#125;</code></pre>\n\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; æ‰“å°æ¨¡å—å†…å®¹\n[\n  &#123;\n    assertions: &#123;&#125;,\n    ast: Node &#123;\n      type: &#39;Program&#39;,\n      start: 0,\n      end: 262,\n      body: [Array],\n      sourceType: &#39;module&#39;\n    &#125;,\n    code: &#39;&#x2F;**\\n&#39; +\n      &#39; * éšæœºæ•°\\n&#39; +\n      &#39; * @param &#123;*&#125; min æœ€å°å€¼\\n&#39; +\n      &#39; * @param &#123;*&#125; max æœ€å¤§å€¼\\n&#39; +\n      &#39; * @returns min-maxä¹‹é—´çš„éšæœºæ•´æ•°\\n&#39; +\n      &#39; *&#x2F;\\n&#39; +\n      &#39;const randomNumber &#x3D; (min, max) &#x3D;&gt; &#123;\\n&#39; +\n      &#39;  min &#x3D; Math.ceil(min);\\n&#39; +\n      &#39;  max &#x3D; Math.floor(max);\\n&#39; +\n      &#39;  return Math.floor(Math.random() * (max - min + 1)) + min;\\n&#39; +\n      &#39;&#125;\\n&#39; +\n      &#39;\\n&#39; +\n      &#39;export default randomNumber&#39;,\n    customTransformCache: false,\n    dependencies: [],\n    id: &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;randomNumber.js&#39;,\n    meta: &#123;&#125;,\n    moduleSideEffects: true,\n    originalCode: &#39;&#x2F;**\\n&#39; +\n      &#39; * éšæœºæ•°\\n&#39; +\n      &#39; * @param &#123;*&#125; min æœ€å°å€¼\\n&#39; +\n      &#39; * @param &#123;*&#125; max æœ€å¤§å€¼\\n&#39; +\n      &#39; * @returns min-maxä¹‹é—´çš„éšæœºæ•´æ•°\\n&#39; +\n      &#39; *&#x2F;\\n&#39; +\n      &#39;const randomNumber &#x3D; (min, max) &#x3D;&gt; &#123;\\n&#39; +\n      &#39;  min &#x3D; Math.ceil(min);\\n&#39; +\n      &#39;  max &#x3D; Math.floor(max);\\n&#39; +\n      &#39;  return Math.floor(Math.random() * (max - min + 1)) + min;\\n&#39; +\n      &#39;&#125;\\n&#39; +\n      &#39;\\n&#39; +\n      &#39;export default randomNumber&#39;,\n    originalSourcemap: null,\n    resolvedIds: [Object: null prototype] &#123;&#125;,\n    sourcemapChain: [],\n    syntheticNamedExports: false,\n    transformDependencies: [],\n    transformFiles: undefined\n  &#125;,\n  &#123;\n    assertions: &#123;&#125;,\n    ast: Node &#123;\n      type: &#39;Program&#39;,\n      start: 0,\n      end: 349,\n      body: [Array],\n      sourceType: &#39;module&#39;\n    &#125;,\n    code: &#39;&#x2F;**\\n&#39; +\n      &#39; * æ·±æ‹·è´\\n&#39; +\n      &#39; * @param obj éœ€è¦æ·±æ‹·è´çš„å¯¹è±¡\\n&#39; +\n      &#39; * @returns æ·±æ‹·è´å¯¹è±¡\\n&#39; +\n      &#39; *&#x2F;\\n&#39; +\n      &#39;const deepClone &#x3D; (obj) &#x3D;&gt; &#123;\\n&#39; +\n      &quot;  if(typeof obj !&#x3D;&#x3D; &#39;object&#39; || obj &#x3D;&#x3D;&#x3D; null) &#123;\\n&quot; +\n      &#39;    return obj\\n&#39; +\n      &#39;  &#125;\\n&#39; +\n      &#39;  const result &#x3D; Array.isArray(obj) ? [] : &#123;&#125;;\\n&#39; +\n      &#39;  for(let key in obj) &#123;\\n&#39; +\n      &#39;    if(obj.hasOwnProperty(key)) &#123;\\n&#39; +\n      &#39;      result[key] &#x3D; deepClone(obj[key])\\n&#39; +\n      &#39;    &#125;\\n&#39; +\n      &#39;  &#125;\\n&#39; +\n      &#39;  return result\\n&#39; +\n      &#39;&#125;\\n&#39; +\n      &#39;export default deepClone&#39;,\n    customTransformCache: false,\n    dependencies: [],\n    id: &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;deepClone.js&#39;,\n    meta: &#123;&#125;,\n    moduleSideEffects: true,\n    originalCode: &#39;&#x2F;**\\n&#39; +\n      &#39; * æ·±æ‹·è´\\n&#39; +\n      &#39; * @param obj éœ€è¦æ·±æ‹·è´çš„å¯¹è±¡\\n&#39; +\n      &#39; * @returns æ·±æ‹·è´å¯¹è±¡\\n&#39; +\n      &#39; *&#x2F;\\n&#39; +\n      &#39;const deepClone &#x3D; (obj) &#x3D;&gt; &#123;\\n&#39; +\n      &quot;  if(typeof obj !&#x3D;&#x3D; &#39;object&#39; || obj &#x3D;&#x3D;&#x3D; null) &#123;\\n&quot; +\n      &#39;    return obj\\n&#39; +\n      &#39;  &#125;\\n&#39; +\n      &#39;  const result &#x3D; Array.isArray(obj) ? [] : &#123;&#125;;\\n&#39; +\n      &#39;  for(let key in obj) &#123;\\n&#39; +\n      &#39;    if(obj.hasOwnProperty(key)) &#123;\\n&#39; +\n      &#39;      result[key] &#x3D; deepClone(obj[key])\\n&#39; +\n      &#39;    &#125;\\n&#39; +\n      &#39;  &#125;\\n&#39; +\n      &#39;  return result\\n&#39; +\n      &#39;&#125;\\n&#39; +\n      &#39;export default deepClone&#39;,\n    originalSourcemap: null,\n    resolvedIds: [Object: null prototype] &#123;&#125;,\n    sourcemapChain: [],\n    syntheticNamedExports: false,\n    transformDependencies: [],\n    transformFiles: undefined\n  &#125;,\n  &#123;\n    assertions: &#123;&#125;,\n    ast: Node &#123;\n      type: &#39;Program&#39;,\n      start: 0,\n      end: 131,\n      body: [Array],\n      sourceType: &#39;module&#39;\n    &#125;,\n    code: &#39;import randomNumber from &quot;.&#x2F;randomNumber.js&quot;;\\n&#39; +\n      &#39;import deepClone from &quot;.&#x2F;deepClone.js&quot;;\\n&#39; +\n      &#39;\\n&#39; +\n      &#39;export default &#123; randomNumber, deepClone &#125;\\n&#39; +\n      &#39;\\n&#39;,\n    customTransformCache: false,\n    dependencies: [\n      &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;randomNumber.js&#39;,\n      &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;deepClone.js&#39;\n    ],\n    id: &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;index.js&#39;,\n    meta: &#123;&#125;,\n    moduleSideEffects: true,\n    originalCode: &#39;import randomNumber from &quot;.&#x2F;randomNumber.js&quot;;\\n&#39; +\n      &#39;import deepClone from &quot;.&#x2F;deepClone.js&quot;;\\n&#39; +\n      &#39;\\n&#39; +\n      &#39;export default &#123; randomNumber, deepClone &#125;\\n&#39; +\n      &#39;\\n&#39;,\n    originalSourcemap: null,\n    resolvedIds: [Object: null prototype] &#123;\n      &#39;.&#x2F;randomNumber.js&#39;: [Object],\n      &#39;.&#x2F;deepClone.js&#39;: [Object]\n    &#125;,\n    sourcemapChain: [],\n    syntheticNamedExports: false,\n    transformDependencies: [],\n    transformFiles: undefined\n  &#125;\n]</code></pre>\n\n<p>é€šè¿‡ä¸Šé¢ä¸¤ä¸ªæ‰“å°è¯­å¥çš„ç»“æœï¼Œå…¶å®å°±å¯ä»¥åˆ†æå‡ºï¼Œåœ¨<code>build</code>é˜¶æ®µäº§ç”Ÿçš„<code>bunlde</code>å¯¹è±¡ï¼Œå¹¶æ²¡æœ‰æ¨¡å—æ‰“åŒ…ï¼Œè¿™ä¸ªå¯¹è±¡çš„ä½œç”¨åœ¨äºå­˜å‚¨å„ä¸ªæ¨¡å—çš„å†…å®¹åŠä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”æä¾›äº†<code>generate(ä¸å†™å…¥)</code>ï¼Œ<code>write(å†™å…¥ç£ç›˜)</code>æ–¹æ³•ï¼Œæ–¹ä¾¿åç»­ output é˜¶æ®µè¾“å‡ºäº§ç‰©</p>\n<h3 id=\"2ã€output\"><a href=\"#2ã€output\" class=\"headerlink\" title=\"2ã€output\"></a>2ã€output</h3><p>é€šè¿‡ rollup()å‡½æ•°è¿”å›çš„å¯¹è±¡ bundle æœ‰ä¸¤ä¸ªé‡è¦çš„å‡½æ•°</p>\n<ul>\n<li>generate ç”Ÿæˆæ‰“åŒ…äº§ç‰©ï¼Œä¸å†™å…¥ç£ç›˜</li>\n<li>write ç”Ÿæˆæ‰“åŒ…äº§ç‰©ï¼Œå†™å…¥ç£ç›˜</li>\n</ul>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">const rollup &#x3D; require(&#39;rollup&#39;);\n\nconst inputOptions &#x3D; &#123;\n  input: &#39;src&#x2F;index.js&#39;,\n  external: [],\n  plugins: []\n&#125;\n\nconst outputOptions &#x3D; &#123;\n  dir: &#39;dist&#39;,\n  format: &#39;esm&#39;,\n  sourcemap: true,\n  entryFileNames: &#39;[name].[hash].js&#39;\n&#125;\n\nasync function build() &#123;\n  const bundle &#x3D; await rollup.rollup(inputOptions);\n  const resp &#x3D; await bundle.generate(outputOptions);\n  console.log(resp)\n&#125;\n\nbuild();</code></pre>\n\n<p><strong>æ‰§è¡Œç»“æœï¼š</strong></p>\n<pre class=\"line-numbers language-swift\" data-language=\"swift\"><code class=\"language-swift\">&#123;\n  output: [\n    &#123;\n      exports: [Array],\n      facadeModuleId: &#39;&#x2F;Users&#x2F;yingside&#x2F;Desktop&#x2F;rollup-api-demo&#x2F;src&#x2F;index.js&#39;,\n      isDynamicEntry: false,\n      isEntry: true,\n      isImplicitEntry: false,\n      moduleIds: [Array],\n      name: &#39;index&#39;,\n      type: &#39;chunk&#39;,\n      dynamicImports: [],\n      fileName: &#39;index.1730c9fc.js&#39;,\n      implicitlyLoadedBefore: [],\n      importedBindings: &#123;&#125;,\n      imports: [],\n      modules: [Object: null prototype],\n      referencedFiles: [],\n      code: &#39;&#x2F;**\\n&#39; +\n        &#39; * éšæœºæ•°\\n&#39; +\n        &#39; * @param &#123;*&#125; min æœ€å°å€¼\\n&#39; +\n        &#39; * @param &#123;*&#125; max æœ€å¤§å€¼\\n&#39; +\n        &#39; * @returns min-maxä¹‹é—´çš„éšæœºæ•´æ•°\\n&#39; +\n        &#39; *&#x2F;\\n&#39; +\n        &#39;const randomNumber &#x3D; (min, max) &#x3D;&gt; &#123;\\n&#39; +\n        &#39;  min &#x3D; Math.ceil(min);\\n&#39; +\n        &#39;  max &#x3D; Math.floor(max);\\n&#39; +\n        &#39;  return Math.floor(Math.random() * (max - min + 1)) + min;\\n&#39; +\n        &#39;&#125;;\\n&#39; +\n        &#39;\\n&#39; +\n        &#39;&#x2F;**\\n&#39; +\n        &#39; * æ·±æ‹·è´\\n&#39; +\n        &#39; * @param obj éœ€è¦æ·±æ‹·è´çš„å¯¹è±¡\\n&#39; +\n        &#39; * @returns æ·±æ‹·è´å¯¹è±¡\\n&#39; +\n        &#39; *&#x2F;\\n&#39; +\n        &#39;const deepClone &#x3D; (obj) &#x3D;&gt; &#123;\\n&#39; +\n        &quot;  if(typeof obj !&#x3D;&#x3D; &#39;object&#39; || obj &#x3D;&#x3D;&#x3D; null) &#123;\\n&quot; +\n        &#39;    return obj\\n&#39; +\n        &#39;  &#125;\\n&#39; +\n        &#39;  const result &#x3D; Array.isArray(obj) ? [] : &#123;&#125;;\\n&#39; +\n        &#39;  for(let key in obj) &#123;\\n&#39; +\n        &#39;    if(obj.hasOwnProperty(key)) &#123;\\n&#39; +\n        &#39;      result[key] &#x3D; deepClone(obj[key]);\\n&#39; +\n        &#39;    &#125;\\n&#39; +\n        &#39;  &#125;\\n&#39; +\n        &#39;  return result\\n&#39; +\n        &#39;&#125;;\\n&#39; +\n        &#39;\\n&#39; +\n        &#39;var index &#x3D; &#123; randomNumber, deepClone &#125;;\\n&#39; +\n        &#39;\\n&#39; +\n        &#39;export &#123; index as default &#125;;\\n&#39; +\n        &#39;&#x2F;&#x2F;# sourceMappingURL&#x3D;index.1730c9fc.js.map\\n&#39;,\n      map: [SourceMap],\n      preliminaryFileName: &#39;index.!~&#123;001&#125;~.js&#39;,\n      sourcemapFileName: &#39;index.1730c9fc.js.map&#39;\n    &#125;,\n    &#123;\n      fileName: &#39;index.1730c9fc.js.map&#39;,\n      name: undefined,\n      needsCodeReference: false,\n      source: &#96;&#123;&quot;version&quot;:3,&quot;file&quot;:&quot;index.1730c9fc.js&quot;,&quot;sources&quot;:[&quot;..&#x2F;src&#x2F;randomNumber.js&quot;,&quot;..&#x2F;src&#x2F;deepClone.js&quot;,&quot;..&#x2F;src&#x2F;index.js&quot;],&quot;sourcesContent&quot;:[&quot;&#x2F;**\\n * éšæœºæ•°\\n * @param &#123;*&#125; min æœ€å°å€¼\\n * @param &#123;*&#125; max æœ€å¤§å€¼\\n * @returns min-maxä¹‹é—´çš„éšæœºæ•´æ•°\\n *&#x2F;\\nconst randomNumber &#x3D; (min, max) &#x3D;&gt; &#123;\\n  min &#x3D; Math.ceil(min);\\n  max &#x3D; Math.floor(max);\\n  return Math.floor(Math.random() * (max - min + 1)) + min;\\n&#125;\\n\\nexport default randomNumber&quot;,&quot;&#x2F;**\\n * æ·±æ‹·è´\\n * @param obj éœ€è¦æ·±æ‹·è´çš„å¯¹è±¡\\n * @returns æ·±æ‹·è´å¯¹è±¡\\n *&#x2F;\\nconst deepClone &#x3D; (obj) &#x3D;&gt; &#123;\\n  if(typeof obj !&#x3D;&#x3D; &#39;object&#39; || obj &#x3D;&#x3D;&#x3D; null) &#123;\\n    return obj\\n  &#125;\\n  const result &#x3D; Array.isArray(obj) ? [] : &#123;&#125;;\\n  for(let key in obj) &#123;\\n    if(obj.hasOwnProperty(key)) &#123;\\n      result[key] &#x3D; deepClone(obj[key])\\n    &#125;\\n  &#125;\\n  return result\\n&#125;\\nexport default deepClone&quot;,&quot;import randomNumber from \\&quot;.&#x2F;randomNumber.js\\&quot;;\\nimport deepClone from \\&quot;.&#x2F;deepClone.js\\&quot;;\\n\\nexport default &#123; randomNumber, deepClone &#125;\\n\\n&quot;],&quot;names&quot;:[],&quot;mappings&quot;:&quot;AAAA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,YAAY,GAAG,CAAC,GAAG,EAAE,GAAG,KAAK;AACnC,EAAE,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AACvB,EAAE,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AACxB,EAAE,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;AAC3D;;ACVA;AACA;AACA;AACA;AACA;AACA,MAAM,SAAS,GAAG,CAAC,GAAG,KAAK;AAC3B,EAAE,GAAG,OAAO,GAAG,KAAK,QAAQ,IAAI,GAAG,KAAK,IAAI,EAAE;AAC9C,IAAI,OAAO,GAAG;AACd,GAAG;AACH,EAAE,MAAM,MAAM,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,CAAC;AAC9C,EAAE,IAAI,IAAI,GAAG,IAAI,GAAG,EAAE;AACtB,IAAI,GAAG,GAAG,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;AAChC,MAAM,MAAM,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,GAAG,CAAC,GAAG,CAAC,EAAC;AACvC,KAAK;AACL,GAAG;AACH,EAAE,OAAO,MAAM;AACf;;ACbA,YAAe,EAAE,YAAY,EAAE,SAAS;;;;&quot;&#125;&#96;,\n      type: &#39;asset&#39;\n    &#125;\n  ]\n&#125;</code></pre>\n\n<h1 id=\"æ’ä»¶æœºåˆ¶\"><a href=\"#æ’ä»¶æœºåˆ¶\" class=\"headerlink\" title=\"æ’ä»¶æœºåˆ¶\"></a>æ’ä»¶æœºåˆ¶</h1><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>ä»£ç ï¼š<a href=\"https://github.com/Sunny-117/rollup-plugins\">github.com&#x2F;Sunny-117&#x2F;râ€¦</a></p></blockquote>\n<h2 id=\"Rollup-æ’ä»¶æ¦‚è¿°\"><a href=\"#Rollup-æ’ä»¶æ¦‚è¿°\" class=\"headerlink\" title=\"Rollup æ’ä»¶æ¦‚è¿°\"></a>Rollup æ’ä»¶æ¦‚è¿°</h2><blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>Rollup æ’ä»¶æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…·æœ‰ <a href=\"https://cn.rollupjs.org/plugin-development/#properties\">å±æ€§</a>ã€<a href=\"https://cn.rollupjs.org/plugin-development/#build-hooks\">æ„å»ºé’©å­</a> å’Œ <a href=\"https://cn.rollupjs.org/plugin-development/#output-generation-hooks\">è¾“å‡ºç”Ÿæˆé’©å­</a> ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œå¹¶éµå¾ªæˆ‘ä»¬çš„ <a href=\"https://cn.rollupjs.org/plugin-development/#conventions\">çº¦å®š</a>ã€‚æ’ä»¶åº”ä½œä¸ºä¸€ä¸ªå¯¼å‡ºä¸€ä¸ªå‡½æ•°çš„åŒ…è¿›è¡Œå‘å¸ƒï¼Œè¯¥å‡½æ•°å¯ä»¥ä½¿ç”¨æ’ä»¶ç‰¹å®šçš„é€‰é¡¹è¿›è¡Œè°ƒç”¨å¹¶è¿”å›æ­¤ç±»å¯¹è±¡ã€‚</p></blockquote>\n<p>ç®€å•æ¥è¯´ï¼Œrollup æ’ä»¶ä¸€èˆ¬ä¼šåšæˆä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿”å›çš„å¯¹è±¡ä¸­åŒ…å«ä¸€äº›å±æ€§å’Œä¸åŒé˜¶æ®µçš„é’©å­å‡½æ•°ã€‚</p>\n<h3 id=\"çº¦å®š\"><a href=\"#çº¦å®š\" class=\"headerlink\" title=\"çº¦å®š\"></a>çº¦å®š</h3><p>æ’ä»¶åº”è¯¥æœ‰ä¸€ä¸ªæ˜ç¡®çš„åç§°ï¼Œå¹¶ä»¥<code>rollup-plugin-</code>ä½œä¸ºå‰ç¼€ã€‚</p>\n<h3 id=\"å±æ€§\"><a href=\"#å±æ€§\" class=\"headerlink\" title=\"å±æ€§\"></a>å±æ€§</h3><p>nameï¼šæ’ä»¶çš„åç§°ï¼Œç”¨äºåœ¨è­¦å‘Šå’Œé”™è¯¯æ¶ˆæ¯ä¸­æ ‡è¯†æ’ä»¶ã€‚</p>\n<p>versionï¼šæ’ä»¶çš„ç‰ˆæœ¬</p>\n<h2 id=\"é’©å­å‡½æ•°çš„ç‰¹ç‚¹\"><a href=\"#é’©å­å‡½æ•°çš„ç‰¹ç‚¹\" class=\"headerlink\" title=\"é’©å­å‡½æ•°çš„ç‰¹ç‚¹\"></a>é’©å­å‡½æ•°çš„ç‰¹ç‚¹</h2><ul>\n<li>é’©å­å‡½æ•°åŒºåˆ†ä¸åŒçš„è°ƒç”¨æ—¶æœº</li>\n<li>é’©å­å‡½æ•°æ˜¯æœ‰æ‰§è¡Œé¡ºåºçš„</li>\n<li>é’©å­å‡½æ•°æœ‰ä¸åŒçš„æ‰§è¡Œæ–¹å¼</li>\n<li>é’©å­å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡çš„å½¢å¼</li>\n<li>å¯¹è±¡å½¢å¼çš„é’©å­å‡½æ•°å¯ä»¥æ”¹å˜é’©å­çš„æ‰§è¡Œï¼Œè®©ä¸åŒæ’ä»¶çš„åŒåé’©å­å‡½æ•°è·å–ä¸é€šçš„æ‰§è¡Œå…ˆå</li>\n</ul>\n<h3 id=\"é’©å­å‡½æ•°çš„è°ƒç”¨æ—¶æœº\"><a href=\"#é’©å­å‡½æ•°çš„è°ƒç”¨æ—¶æœº\" class=\"headerlink\" title=\"é’©å­å‡½æ•°çš„è°ƒç”¨æ—¶æœº\"></a>é’©å­å‡½æ•°çš„è°ƒç”¨æ—¶æœº</h3><p>è¿™é‡Œçš„è°ƒç”¨æ—¶æœºï¼Œå…¶å®å°±æ˜¯ä»¥æˆ‘ä»¬ä¸Šé¢çš„ APIï¼Œbuild å’Œ output ä¸¤å¤§å·¥ä½œæµçš„ä¸åŒé˜¶æ®µè¿›è¡Œåˆ†ç±»ã€‚æ ¹æ®è¿™ä¸¤ä¸ªä¸åŒé˜¶æ®µï¼Œrollup æä¾›çš„ä¸åŒçš„å‡½æ•°è®©æˆ‘ä»¬è°ƒç”¨</p>\n<ul>\n<li>const bundle &#x3D; await rollup.rollup(inputOptions) æ‰§è¡ŒæœŸé—´çš„æ„å»ºé’©å­å‡½æ•° - <a href=\"https://cn.rollupjs.org/plugin-development/#build-hooks\">build-hooks</a></li>\n<li>await bundle.generate(outputOptions)&#x2F;write(outputOptions) æ‰§è¡ŒæœŸé—´çš„è¾“å‡ºé’©å­å‡½æ•°-<a href=\"https://cn.rollupjs.org/plugin-development/#output-generation-hooks\">output-generation-hooks</a></li>\n</ul>\n<h3 id=\"é’©å­å‡½æ•°çš„æ‰§è¡Œæ–¹å¼\"><a href=\"#é’©å­å‡½æ•°çš„æ‰§è¡Œæ–¹å¼\" class=\"headerlink\" title=\"é’©å­å‡½æ•°çš„æ‰§è¡Œæ–¹å¼\"></a>é’©å­å‡½æ•°çš„æ‰§è¡Œæ–¹å¼</h3><p>é™¤äº†ä¸Šé¢ç®€å•çš„åˆ’åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µçš„è°ƒç”¨æ—¶æœºä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä»¥é’©å­å‡½æ•°çš„æ‰§è¡Œæ–¹å¼æ¥åˆ†ç±»ã€‚</p>\n<ul>\n<li><code>async/sync</code>ï¼šå¼‚æ­¥&#x2F;åŒæ­¥é’©å­ï¼Œasync æ ‡è®°çš„é’©å­å¯ä»¥è¿”å›ä¸€ä¸ªè§£æä¸ºç›¸åŒç±»å‹çš„å€¼çš„ Promiseï¼›å¦åˆ™ï¼Œè¯¥é’©å­è¢«æ ‡è®°ä¸º <code>sync</code>ã€‚</li>\n<li><code>first</code>ï¼šå¦‚æœæœ‰å¤šä¸ªæ’ä»¶å®ç°æ­¤é’©å­ï¼Œåˆ™é’©å­æŒ‰é¡ºåºè¿è¡Œï¼Œç›´åˆ°é’©å­è¿”å›ä¸€ä¸ªä¸æ˜¯ <code>null</code> æˆ– <code>undefined</code> çš„å€¼ã€‚</li>\n<li><code>sequential</code>ï¼šå¦‚æœæœ‰å¤šä¸ªæ’ä»¶å®ç°æ­¤é’©å­ï¼Œåˆ™æ‰€æœ‰è¿™äº›é’©å­å°†æŒ‰æŒ‡å®šçš„æ’ä»¶é¡ºåºè¿è¡Œã€‚å¦‚æœé’©å­æ˜¯ <code>async</code>ï¼Œåˆ™æ­¤ç±»åç»­é’©å­å°†ç­‰å¾…å½“å‰é’©å­è§£å†³åå†è¿è¡Œã€‚</li>\n<li><code>parallel</code>ï¼šå¦‚æœæœ‰å¤šä¸ªæ’ä»¶å®ç°æ­¤é’©å­ï¼Œåˆ™æ‰€æœ‰è¿™äº›é’©å­å°†æŒ‰æŒ‡å®šçš„æ’ä»¶é¡ºåºè¿è¡Œã€‚å¦‚æœé’©å­æ˜¯ <code>async</code>ï¼Œåˆ™æ­¤ç±»åç»­é’©å­å°†å¹¶è¡Œè¿è¡Œï¼Œè€Œä¸æ˜¯ç­‰å¾…å½“å‰é’©å­ã€‚</li>\n</ul>\n<h3 id=\"é’©å­å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡\"><a href=\"#é’©å­å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡\" class=\"headerlink\" title=\"é’©å­å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡\"></a>é’©å­å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡</h3><p>é™¤äº†å‡½æ•°ä¹‹å¤–ï¼Œé’©å­ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®é™…çš„é’©å­å‡½æ•°ï¼ˆæˆ– <code>banner/footer/intro/outro</code> çš„å€¼ï¼‰å¿…é¡»æŒ‡å®šä¸º <code>handler</code>ã€‚è¿™å…è®¸ä½ æä¾›æ›´å¤šçš„å¯é€‰å±æ€§ï¼Œä»¥æ”¹å˜é’©å­çš„æ‰§è¡Œï¼š</p>\n<ul>\n<li>order: â€œpreâ€ | â€œpostâ€ | null</li>\n</ul>\n<p>å¦‚æœæœ‰å¤šä¸ªæ’ä»¶å®ç°æ­¤é’©å­ï¼Œåˆ™å¯ä»¥å…ˆè¿è¡Œæ­¤æ’ä»¶ï¼ˆ<code>&quot;pre&quot;</code>ï¼‰ï¼Œæœ€åè¿è¡Œæ­¤æ’ä»¶ï¼ˆ<code>&quot;post&quot;</code>ï¼‰ï¼Œæˆ–åœ¨ç”¨æˆ·æŒ‡å®šçš„ä½ç½®è¿è¡Œï¼ˆæ²¡æœ‰å€¼æˆ– <code>null</code>ï¼‰ã€‚</p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">export default function resolveFirst() &#123;\n  return &#123;\n    name: &quot;resolve-first&quot;,\n    resolveId: &#123;\n      order: &quot;pre&quot;,\n      handler(source) &#123;\n        console.log(source);\n        return null;\n      &#125;,\n    &#125;,\n  &#125;;\n&#125;</code></pre>\n\n<h3 id=\"æ„å»ºé’©å­æ‰§è¡Œé¡ºåº\"><a href=\"#æ„å»ºé’©å­æ‰§è¡Œé¡ºåº\" class=\"headerlink\" title=\"æ„å»ºé’©å­æ‰§è¡Œé¡ºåº\"></a>æ„å»ºé’©å­æ‰§è¡Œé¡ºåº</h3><p><img src=\"/images/rollup/2.png\" alt=\"img\"></p>\n<ol start=\"0\">\n<li>é€šè¿‡ <code>options</code> é’©å­è¯»å–é…ç½®ï¼Œå¹¶è¿›è¡Œé…ç½®çš„è½¬æ¢ï¼Œå¾—åˆ°å¤„ç†åçš„é…ç½®å¯¹è±¡</li>\n<li>è°ƒç”¨ <code>buildStart</code> é’©å­ï¼Œè€ƒè™‘äº†æ‰€æœ‰ <code>options</code>é’©å­é…ç½®çš„è½¬æ¢ï¼ŒåŒ…å«æœªè®¾ç½®é€‰é¡¹çš„æ­£ç¡®é»˜è®¤å€¼ï¼Œæ­£å¼å¼€å§‹æ„å»ºæµç¨‹</li>\n<li>è°ƒç”¨ <code>resolveId</code> é’©å­è§£ææ¨¡å—æ–‡ä»¶è·¯å¾„ã€‚rollup ä¸­æ¨¡å—æ–‡ä»¶çš„ id å°±æ˜¯æ–‡ä»¶åœ°å€ï¼Œæ‰€ä»¥ï¼Œç±»ä¼¼ resolveId è¿™ç§å°±æ˜¯è§£ææ–‡ä»¶åœ°å€çš„æ„æ€ã€‚ä»<code>inputOption</code>çš„<code>input</code>é…ç½®æŒ‡å®šçš„å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œæ¯å½“åŒ¹é…åˆ°å¼•å…¥å¤–éƒ¨æ¨¡å—çš„è¯­å¥(å¦‚ï¼š<code>import moudleA from &#39;./moduleA&#39;</code>)ä¾¿ä¾æ¬¡æ‰§è¡Œæ³¨å†Œæ’ä»¶ä¸­çš„æ¯ä¸€ä¸ª <code>resolveId</code> é’©å­ï¼Œç›´åˆ°æŸä¸€ä¸ªæ’ä»¶ä¸­çš„ <code>resolveId</code> æ‰§è¡Œå®Œåè¿”å›é <code>null</code> æˆ–é <code>undefined</code> çš„å€¼ï¼Œå°†åœæ­¢æ‰§è¡Œåç»­æ’ä»¶çš„ <code>resolveId</code> é€»è¾‘å¹¶è¿›å…¥ä¸‹ä¸€ä¸ªé’©å­</li>\n<li>è°ƒç”¨<code>load</code>é’©å­åŠ è½½æ¨¡å—å†…å®¹ï¼Œ<code>resolveId</code>ä¸­çš„è·¯å¾„ä¸€èˆ¬ä¸ºç›¸å¯¹è·¯å¾„ï¼Œload ä¸­çš„è·¯å¾„ä¸ºå¤„ç†ä¹‹åçš„ç»å¯¹è·¯å¾„</li>\n<li>æ¥ç€åˆ¤æ–­å½“å‰è§£æçš„æ¨¡å—æ˜¯å¦å­˜åœ¨ç¼“å­˜ï¼Œè‹¥ä¸å­˜åœ¨åˆ™æ‰§è¡Œæ‰€æœ‰çš„ <code>transform</code> é’©å­æ¥å¯¹æ¨¡å—å†…å®¹è¿›è¡Œè¿›è¡Œè‡ªå®šä¹‰çš„è½¬æ¢ï¼›è‹¥å­˜åœ¨åˆ™åˆ¤æ–­<code>shouldTransformCachedModule</code>å±æ€§ï¼Œtrue åˆ™æ‰§è¡Œæ‰€æœ‰çš„ <code>transform</code> é’©å­ï¼Œfalse åˆ™è¿›å…¥<code>moduleParsed</code>é’©å­é€»è¾‘</li>\n<li>æ‹¿åˆ°æœ€åçš„æ¨¡å—å†…å®¹ï¼Œè¿›è¡Œ <code>AST</code> åˆ†æï¼Œè°ƒç”¨ <code>moduleParsed</code> é’©å­ã€‚å¦‚æœå†…éƒ¨æ²¡æœ‰<code>imports</code>å†…å®¹ï¼Œè¿›å…¥<code>buildEnd</code>ç¯èŠ‚ã€‚å¦‚æœè¿˜æœ‰<code>imports</code>å†…å®¹åˆ™ç»§ç»­ï¼Œå¦‚æœæ˜¯æ™®é€šçš„ <code>import</code>ï¼Œåˆ™æ‰§è¡Œ<code>resolveId</code> é’©å­ï¼Œç»§ç»­å›åˆ°<strong>æ­¥éª¤ 3-è°ƒç”¨ resolveId</strong>ï¼›å¦‚æœæ˜¯åŠ¨æ€ <code>import</code>ï¼Œåˆ™æ‰§è¡Œ<code>resolveDynamicImport</code> é’©å­è§£æè·¯å¾„ï¼Œå¦‚æœè§£ææˆåŠŸï¼Œåˆ™å›åˆ°<strong>æ­¥éª¤ 4-load</strong>åŠ è½½æ¨¡å—ï¼Œå¦åˆ™å›åˆ°æ­¥éª¤ 3 é€šè¿‡ <code>resolveId</code> è§£æè·¯å¾„</li>\n<li>ç›´åˆ°æ‰€æœ‰çš„ <code>import</code> éƒ½è§£æå®Œæ¯•ï¼Œ<code>Rollup</code> æ‰§è¡Œ<code>buildEnd</code>é’©å­ï¼ŒBuild é˜¶æ®µç»“æŸ</li>\n</ol>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">&#x2F;&#x2F; rollup-plugin-example.js\n\nexport default function myExample() &#123;\n  return &#123;\n    name: &quot;my-example&quot;,\n    options(options) &#123;\n      console.log(&quot;ğŸ‰ -- options:&quot;, options);\n    &#125;,\n    buildStart(options) &#123;\n      console.log(&quot;âœ¨ -- buildStart:&quot;, options);\n    &#125;,\n    resolveId(source, importer) &#123;\n      console.log(&quot;ğŸš€ -- resolveId(source):&quot;, source);\n      console.log(&quot;ğŸš€ -- resolveId(importer):&quot;, importer);\n      return null;\n    &#125;,\n    load(id) &#123;\n      console.log(&quot;ğŸŒˆ ~ id:&quot;, id);\n      return null;\n    &#125;,\n    transform(code, id) &#123;\n      console.log(&quot;ğŸŒŸ -- transform&quot;);\n      console.log(&quot;---&quot;, code);\n      console.log(&quot;---&quot;, id);\n    &#125;,\n    moduleParsed(info) &#123;\n      console.log(&quot;â­ï¸ -- moduleParsed:&quot;, info);\n    &#125;,\n    buildEnd() &#123;\n      console.log(&quot;ğŸ˜ -- buildEnd&quot;);\n    &#125;,\n  &#125;;\n&#125;</code></pre>\n\n<h4 id=\"è°ƒç”¨è™šæ‹Ÿæ¨¡å—æ’ä»¶ç¤ºä¾‹\"><a href=\"#è°ƒç”¨è™šæ‹Ÿæ¨¡å—æ’ä»¶ç¤ºä¾‹\" class=\"headerlink\" title=\"è°ƒç”¨è™šæ‹Ÿæ¨¡å—æ’ä»¶ç¤ºä¾‹\"></a>è°ƒç”¨è™šæ‹Ÿæ¨¡å—æ’ä»¶ç¤ºä¾‹</h4><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">const virtualModuleId &#x3D; &quot;virtual-module&quot;;\n&#x2F;&#x2F; rollupçº¦å®šæ’ä»¶ä½¿ç”¨â€œè™šæ‹Ÿæ¨¡å—â€ï¼Œä½¿ç”¨\\0å‰ç¼€æ¨¡å— IDã€‚è¿™å¯ä»¥é˜²æ­¢å…¶ä»–æ’ä»¶å°è¯•å¤„ç†å®ƒã€‚\nconst resolvedVirtualModuleId &#x3D; &quot;\\0&quot; + virtualModuleId;\nexport default function virtualModule() &#123;\n  return &#123;\n    name: &quot;virtual-module&quot;,\n    resolveId(source) &#123;\n      if (source &#x3D;&#x3D;&#x3D; &quot;virtual-module&quot;) &#123;\n        return resolvedVirtualModuleId; &#x2F;&#x2F; å‘Šè¯‰Rollupï¼Œè¿™ä¸ªIDæ˜¯å¤–éƒ¨æ¨¡å—ï¼Œä¸è¦åœ¨æ­¤å¤„æŸ¥æ‰¾å®ƒ\n      &#125;\n      return null; &#x2F;&#x2F; å…¶ä»–IDåº”æŒ‰é€šå¸¸æ–¹å¼å¤„ç†\n    &#125;,\n    load(id) &#123;\n      console.log(&quot;ğŸŒˆ - id:&quot;, id);\n      if (id &#x3D;&#x3D;&#x3D; resolvedVirtualModuleId) &#123;\n        &#x2F;&#x2F; return &#39;export default &quot;This is virtual!&quot;&#39;; &#x2F;&#x2F; å‘Šè¯‰Rollupï¼Œå¦‚ä½•åŠ è½½æ­¤æ¨¡å—\n        return &quot;export default function fib(n) &#123; return n &lt;&#x3D; 1 ? n : fib(n - 1) + fib(n - 2); &#125;&quot;;\n      &#125;\n      return null; &#x2F;&#x2F; å…¶ä»–IDåº”æŒ‰é€šå¸¸æ–¹å¼å¤„ç†\n    &#125;,\n  &#125;;\n&#125;</code></pre>\n\n<p><strong>ç•Œé¢è°ƒç”¨</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import fib from &quot;virtual-module&quot;;\nconsole.log(fib(10));</code></pre>\n\n<h4 id=\"JSON-æ’ä»¶ç¤ºä¾‹\"><a href=\"#JSON-æ’ä»¶ç¤ºä¾‹\" class=\"headerlink\" title=\"JSON æ’ä»¶ç¤ºä¾‹\"></a>JSON æ’ä»¶ç¤ºä¾‹</h4><p>rollup é»˜è®¤æ˜¯ä¸èƒ½ç›´æ¥è¯»å– json æ–‡ä»¶çš„å†…å®¹çš„ï¼Œæˆ‘ä»¬è‡ªå·±å†™ä¸€ä¸ªæ’ä»¶å¤„ç†ä¸€ä¸‹ï¼Œä¸è¿‡å†™è¿™ä¸ªæ’ä»¶ä¹‹å‰ï¼Œæœ‰ä¸€äº›å°çŸ¥è¯†ç‚¹éœ€è¦è¡¥å……ä¸€ä¸‹</p>\n<p><a href=\"https://github.com/rollup/plugins/tree/master/packages/pluginutils\">@rollup&#x2F;pluginutils</a> rollup å®˜æ–¹æä¾›çš„å·¥å…·æ’ä»¶,é‡Œé¢æœ‰ä¸€äº›åˆ¶ä½œæ’ä»¶å¸¸ç”¨çš„æ–¹æ³•</p>\n<p><strong>å®‰è£…</strong></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pnpm add @rollup&#x2F;plugin-commonjs @rollup&#x2F;plugin-node-resolve @rollup&#x2F;pluginutils -D</code></pre>\n\n<p><a href=\"https://cn.rollupjs.org/plugin-development/#plugin-context\">æ’ä»¶ä¸Šä¸‹æ–‡</a></p>\n<p>è¿™ä¸ªå…¶å®ä¹Ÿæ˜¯æ’ä»¶ä¸­å¾ˆå¸¸ç”¨çš„ä¸€äº› apiï¼Œå¯ä»¥é€šè¿‡ <code>this</code> ä»å¤§å¤šæ•°<a href=\"https://cn.rollupjs.org/plugin-development/#build-hooks\">é’©å­</a>ä¸­è®¿é—®ä¸€äº›å®ç”¨å‡½æ•°å’Œä¿¡æ¯ä½</p>\n<p><strong>rollup-plugin-json</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; createFilter, dataToEsm &#125; from &quot;@rollup&#x2F;pluginutils&quot;;\nimport path from &quot;path&quot;;\n\nexport default function myJson(options &#x3D; &#123;&#125;) &#123;\n  &#x2F;&#x2F; createFilter è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªidè·¯å¾„å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼\n  &#x2F;&#x2F; è¿™ä¸ªå¸ƒå°”å€¼è¡¨ç¤ºæ˜¯å¦è¦å¤„ç†è¿™ä¸ªidè·¯å¾„\n  &#x2F;&#x2F; rollup æ¨èæ¯ä¸€ä¸ª transform ç±»å‹çš„æ’ä»¶éƒ½éœ€è¦æä¾› include å’Œ exclude é€‰é¡¹ï¼Œç”Ÿæˆè¿‡æ»¤è§„åˆ™\n  const filter &#x3D; createFilter(options.include, options.exclude);\n  return &#123;\n    name: &quot;rollup-plugin-json&quot;,\n    transform: &#123;\n      order: &quot;pre&quot;,\n      handler(code, id) &#123;\n        if (!filter(id) || path.extname(id) !&#x3D;&#x3D; &quot;.json&quot;) return null;\n        try &#123;\n          const parse &#x3D; JSON.stringify(JSON.parse(code));\n          return &#123;\n            &#x2F;&#x2F; dataToEsm å°†æ•°æ®è½¬æ¢æˆesmæ¨¡å—\n            &#x2F;&#x2F; å…¶å®å°±æ˜¯ export default &quot;xxx&quot;\n            code: dataToEsm(parse),\n            map: &#123; mappings: &quot;&quot; &#125;,\n          &#125;;\n        &#125; catch (err) &#123;\n          const message &#x3D; &quot;Could not parse JSON file&quot;;\n          this.error(&#123; message, id, cause: err &#125;);\n          return null;\n        &#125;\n      &#125;,\n    &#125;,\n  &#125;;\n&#125;</code></pre>\n\n<p><strong>ç•Œé¢è°ƒç”¨</strong></p>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import pkg from &quot;..&#x2F;package.json&quot;;\nimport test from &quot;..&#x2F;test.json&quot;; &#x2F;&#x2F; é”™è¯¯jsonæ ¼å¼æ¼”ç¤º\nconsole.log(pkg.name);</code></pre>\n\n<h4 id=\"æ’ä»¶ä¸Šä¸‹æ–‡\"><a href=\"#æ’ä»¶ä¸Šä¸‹æ–‡\" class=\"headerlink\" title=\"æ’ä»¶ä¸Šä¸‹æ–‡\"></a><a href=\"https://cn.rollupjs.org/plugin-development/#plugin-context\">æ’ä»¶ä¸Šä¸‹æ–‡</a></h4><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; createFilter &#125; from &quot;@rollup&#x2F;pluginutils&quot;;\n\nexport default function customPlugin(options) &#123;\n  const filter &#x3D; createFilter(options.include, options.exclude);\n\n  return &#123;\n    name: &quot;custom-plugin&quot;,\n\n    transform(code, id) &#123;\n      if (!filter(id)) &#123;\n        return null;\n      &#125;\n\n      const parsedCode &#x3D; this.parse(code); &#x2F;&#x2F; è§£æä»£ç ,è·å–AST\n\n      const source &#x3D; &#96;$&#123;code&#125;\\n\\n$&#123;JSON.stringify(parsedCode, null, 2)&#125;&#96;;\n\n      const fileName &#x3D; id.split(&quot;&#x2F;&quot;).pop();\n\n      if (options.emitFile) &#123;\n        this.emitFile(&#123;\n          type: &quot;asset&quot;,\n          fileName: fileName + &quot;.txt&quot;,\n          source,\n        &#125;);\n      &#125;\n    &#125;,\n  &#125;;\n&#125;</code></pre>\n\n<h4 id=\"å›¾ç‰‡è¯»å–\"><a href=\"#å›¾ç‰‡è¯»å–\" class=\"headerlink\" title=\"å›¾ç‰‡è¯»å–\"></a>å›¾ç‰‡è¯»å–</h4><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; createFilter, dataToEsm &#125; from &quot;@rollup&#x2F;pluginutils&quot;;\nimport &#123; extname, resolve, basename, relative, normalize, sep &#125; from &quot;path&quot;;\nimport fs from &quot;fs&quot;;\nimport svgToMiniDataURI from &quot;mini-svg-data-uri&quot;;\n\nconst defaults &#x3D; &#123;\n  fileSize: 1024 * 4,\n  target: &quot;.&#x2F;dist&quot;,\n  include: null,\n  exclude: null,\n&#125;;\n\nconst mimeTypes &#x3D; &#123;\n  &quot;.png&quot;: &quot;image&#x2F;png&quot;,\n  &quot;.jpg&quot;: &quot;image&#x2F;jpeg&quot;,\n  &quot;.jpeg&quot;: &quot;image&#x2F;jpeg&quot;,\n  &quot;.gif&quot;: &quot;image&#x2F;gif&quot;,\n  &quot;.svg&quot;: &quot;image&#x2F;svg+xml&quot;,\n  &quot;.ico&quot;: &quot;image&#x2F;x-icon&quot;,\n  &quot;.webp&quot;: &quot;image&#x2F;webp&quot;,\n  &quot;.avif&quot;: &quot;image&#x2F;avif&quot;,\n&#125;;\n\nconst getDataUri &#x3D; (&#123; format, isSvg, mime, source &#125;) &#x3D;&gt;\n  isSvg ? svgToMiniDataURI(source) : &#96;data:$&#123;mime&#125;;$&#123;format&#125;,$&#123;source&#125;&#96;;\n\nconst ensureDirExists &#x3D; async (dirPath) &#x3D;&gt; &#123;\n  try &#123;\n    await fs.promises.access(dirPath);\n    return true;\n  &#125; catch (err) &#123;\n    &#x2F;&#x2F; æ–‡ä»¶å¤¹ä¸å­˜åœ¨å°±åˆ›å»ºæ–‡ä»¶å¤¹\n    try &#123;\n      await fs.promises.mkdir(dirPath, &#123; recursive: true &#125;);\n      return true;\n    &#125; catch (err) &#123;\n      console.error(err);\n      return false;\n    &#125;\n  &#125;\n&#125;;\n\nexport default function myImage(opts &#x3D; &#123;&#125;) &#123;\n  const options &#x3D; Object.assign(&#123;&#125;, defaults, opts);\n  const filter &#x3D; createFilter(options.include, options.exclude);\n  return &#123;\n    name: &quot;my-image&quot;,\n    async transform(code, id) &#123;\n      if (!filter(id)) return null;\n\n      &#x2F;&#x2F; è·å–åç¼€\n      const ext &#x3D; extname(id);\n      &#x2F;&#x2F; åˆ¤æ–­æ˜¯å¦æ˜¯å›¾ç‰‡\n      if (!mimeTypes.hasOwnProperty(ext)) &#123;\n        return null;\n      &#125;\n\n      &#x2F;&#x2F; è·å–å›¾ç‰‡çš„mimeç±»å‹\n      const mime &#x3D; mimeTypes[ext];\n      &#x2F;&#x2F; åˆ¤æ–­æ˜¯å¦svg\n      const isSvg &#x3D; mime &#x3D;&#x3D;&#x3D; mimeTypes[&quot;.svg&quot;];\n      &#x2F;&#x2F; å›¾ç‰‡formatæ ¼å¼\n      const format &#x3D; isSvg ? &quot;utf-8&quot; : &quot;base64&quot;;\n\n      &#x2F;&#x2F; ç›®æ ‡è·¯å¾„\n      const assetsPath &#x3D; resolve(process.cwd(), options.target);\n      console.log(&quot;---&quot;, process.cwd());\n      console.log(&quot;---&quot;, options.target);\n      console.log(&quot;---&quot;, assetsPath);\n\n      &#x2F;&#x2F;è·å–æ–‡ä»¶å\n      const fileName &#x3D; basename(id);\n      &#x2F;&#x2F; æœ€ç»ˆæ–‡ä»¶è·¯å¾„\n      const filePath &#x3D; resolve(assetsPath, fileName);\n      console.log(&quot;&#x3D;&#x3D;&#x3D;&quot;, filePath);\n\n      let relativePath &#x3D; normalize(relative(process.cwd(), filePath));\n      relativePath &#x3D; relativePath.substring(relativePath.indexOf(sep) + 1);\n\n      console.log(relativePath);\n\n      try &#123;\n        &#x2F;&#x2F; å¦‚æœå›¾ç‰‡æ–‡ä»¶è¿‡å¤§ï¼Œå°±åº”è¯¥ç›´æ¥æ‹·è´æ–‡ä»¶ï¼Œè¿”å›æ–‡ä»¶è·¯å¾„\n        &#x2F;&#x2F; è¯»å–å›¾ç‰‡æ–‡ä»¶å¤§å°ä¸è®¾ç½®çš„å¤§å°è¿›è¡Œæ¯”è¾ƒ\n        const stat &#x3D; await fs.promises.stat(id);\n        if (stat.size &gt; options.fileSize) &#123;\n          &#x2F;&#x2F; æ–‡ä»¶çš„æ‹·è´ï¼Œä»¥åŠå¯¹è±¡çš„è¿”å›\n          &#x2F;&#x2F; æ–‡ä»¶æ‹·è´ï¼Œæ— éå°±æ˜¯æ–‡ä»¶æºè·¯å¾„ï¼Œç›®æ ‡è·¯å¾„\n          &#x2F;&#x2F;copyFile æ‹·è´æ–‡ä»¶åœ°å€çš„æ–‡ä»¶å¤¹å¿…é¡»å­˜åœ¨\n          &#x2F;&#x2F; å¦‚æœæ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±åˆ›å»ºæ–‡ä»¶å¤¹\n          const dirExists &#x3D; await ensureDirExists(assetsPath);\n          dirExists &amp;&amp; (await fs.promises.copyFile(id, filePath));\n          return &#123;\n            code: dataToEsm(relativePath), &#x2F;&#x2F;è¿”å›æ‹·è´ä¹‹åå¤„ç†çš„è·¯å¾„\n            map: &#123; mappings: &quot;&quot; &#125;,\n          &#125;;\n        &#125; else &#123;\n          &#x2F;&#x2F; å¦åˆ™è½¬æ¢ä¸ºbase64æ ¼å¼\n          &#x2F;&#x2F; è¯»å–æ–‡ä»¶\n          const source &#x3D; await fs.promises.readFile(id, format);\n\n          return &#123;\n            code: dataToEsm(getDataUri(&#123; format, isSvg, mime, source &#125;)),\n            map: &#123; mappings: &quot;&quot; &#125;,\n          &#125;;\n        &#125;\n      &#125; catch (err) &#123;\n        const message &#x3D; &quot;å›¾ç‰‡è½¬æ¢å¤±è´¥:&quot; + id;\n        this.error(&#123; message, id, cause: err &#125;);\n        return null;\n      &#125;\n    &#125;,\n  &#125;;\n&#125;</code></pre>\n\n<h3 id=\"è¾“å‡ºé’©å­æ‰§è¡Œé¡ºåº\"><a href=\"#è¾“å‡ºé’©å­æ‰§è¡Œé¡ºåº\" class=\"headerlink\" title=\"è¾“å‡ºé’©å­æ‰§è¡Œé¡ºåº\"></a>è¾“å‡ºé’©å­æ‰§è¡Œé¡ºåº</h3><p><img src=\"/images/rollup/3.png\" alt=\"img\"></p>\n<ol start=\"0\">\n<li>æ‰§è¡Œæ‰€æœ‰æ’ä»¶çš„ <code>outputOptions</code> é’©å­å‡½æ•°ï¼Œå¯¹ <code>output</code> é…ç½®è¿›è¡Œè½¬æ¢</li>\n<li>æ‰§è¡Œ <code>renderStart</code>ï¼Œè¯¥é’©å­è¯»å–æ‰€æœ‰ outputOptions é’©å­çš„è½¬æ¢ä¹‹åçš„è¾“å‡ºé€‰é¡¹</li>\n<li>æ‰«æ <code>åŠ¨æ€import</code> è¯­å¥æ‰§è¡Œ <code>renderDynamicImport</code> é’©å­ï¼Œè®©å¼€å‘è€…èƒ½è‡ªå®šä¹‰<code>åŠ¨æ€import</code>çš„å†…å®¹ä¸è¡Œä¸º</li>\n<li>å¹¶å‘æ‰§è¡Œæ‰€æœ‰æ’ä»¶çš„ <code>bannerã€footerã€introã€outro</code> é’©å­ï¼Œè¿™å››ä¸ªé’©å­åŠŸèƒ½ç®€å•ï¼Œå°±æ˜¯å¾€æ‰“åŒ…äº§ç‰©çš„å›ºå®šä½ç½®(æ¯”å¦‚å¤´éƒ¨å’Œå°¾éƒ¨)æ’å…¥ä¸€äº›è‡ªå®šä¹‰çš„å†…å®¹ï¼Œæ¯”å¦‚ç‰ˆæœ¬å·ã€ä½œè€…ã€å†…å®¹ã€é¡¹ç›®ä»‹ç»ç­‰ç­‰</li>\n<li>æ˜¯å¦å­˜åœ¨ <code>import.meta</code> è¯­å¥ï¼Œæ²¡æœ‰å°±ç›´æ¥è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œå¦åˆ™ï¼šå¯¹äº<code>import.meta.url</code>è°ƒç”¨ <code>resolveFileUrl</code> æ¥è‡ªå®šä¹‰ url è§£æé€»è¾‘ã€‚å¯¹äº<code>import.meta</code>è°ƒç”¨ <code>resolveImportMeta</code> æ¥è¿›è¡Œè‡ªå®šä¹‰å…ƒä¿¡æ¯è§£æ</li>\n<li>ç”Ÿæˆ chunk è°ƒç”¨<code>renderChunk</code>é’©å­ï¼Œä¾¿äºåœ¨è¯¥é’©å­ä¸­è¿›è¡Œè‡ªå®šä¹‰æ“ä½œã€‚å¦‚æœç”Ÿæˆçš„ chunk æ–‡ä»¶æœ‰ hash å€¼ï¼Œæ‰§è¡Œ <code>augmentChunkHash</code> é’©å­ï¼Œæ¥å†³å®šæ˜¯å¦æ›´æ”¹ <code>chunk</code> çš„å“ˆå¸Œå€¼ã€‚</li>\n<li>è°ƒç”¨ <code>generateBundle</code> é’©å­ï¼Œè¿™ä¸ªé’©å­çš„å…¥å‚é‡Œé¢ä¼šåŒ…å«æ‰€æœ‰çš„æ‰“åŒ…äº§ç‰©ä¿¡æ¯ï¼ŒåŒ…æ‹¬ <code>chunk</code> (æ‰“åŒ…åçš„ä»£ç )ã€<code>asset</code>(æœ€ç»ˆçš„é™æ€èµ„æºæ–‡ä»¶)ã€‚åœ¨è¿™ä¸ªé’©å­ä¸­ä½ åšè‡ªå®šä¹‰è‡ªå·±çš„æ“ä½œï¼Œæ¯”å¦‚ï¼šå¯ä»¥åœ¨è¿™é‡Œåˆ é™¤ä¸€äº› <code>chunk</code> æˆ–è€… <code>asset</code>ï¼Œæœ€ç»ˆè¢«åˆ é™¤çš„å†…å®¹å°†ä¸ä¼šä½œä¸ºäº§ç‰©è¾“å‡º</li>\n<li>ä¸ŠèŠ‚è¯¾è®²è§£çš„ javascript apiâ€”<code>rollup.rollup</code>æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª<code>bundle</code>å¯¹è±¡ï¼Œ<code>bundle</code>å¯¹è±¡çš„ write æ–¹æ³•ï¼Œä¼šè§¦å‘<code>writeBundle</code>é’©å­ï¼Œä¼ å…¥æ‰€æœ‰çš„æ‰“åŒ…äº§ç‰©ä¿¡æ¯ï¼ŒåŒ…æ‹¬ <code>chunk</code> å’Œ <code>asset</code>ï¼Œä¸<code>generateBundle</code>é’©å­éå¸¸ç›¸ä¼¼ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯<code>writeBundle</code>é’©å­æ‰§è¡Œçš„æ—¶å€™ï¼Œäº§ç‰©å·²ç»è¾“å‡ºäº†ã€‚è€Œ <code>generateBundle</code> æ‰§è¡Œçš„æ—¶å€™äº§ç‰©è¿˜å¹¶æ²¡æœ‰è¾“å‡ºã€‚ç®€å•æ¥è¯´ï¼Œé¡ºåºæ˜¯ï¼š<code>generateBundle---&gt;è¾“å‡ºå¹¶ä¿å­˜äº§ç‰©åˆ°ç£ç›˜---&gt;writeBundle</code></li>\n<li>å½“<code>bundle</code>çš„<code>close</code>æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šè§¦å‘<code>closeBundle</code>é’©å­ï¼Œè¿™ä¸ª output é˜¶æ®µç»“æŸ</li>\n</ol>\n<pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">export default function myExample2() &#123;\n  return &#123;\n    name: &quot;my-example2&quot;,\n    outputOptions(options) &#123;\n      console.log(&quot;ğŸ‰ ~ options:&quot;, options);\n    &#125;,\n    renderStart(options) &#123;\n      console.log(&quot;âœ¨ ~ renderStart:&quot;, options);\n    &#125;,\n    renderDynamicImport(options) &#123;\n      console.log(&quot;âœ¨~ renderDynamicImport:&quot;, options);\n    &#125;,\n    banner(chunk) &#123;\n      console.log(&quot;ğŸ”¥ ~ banner(chunk):&quot;, chunk);\n      return &quot;&quot;;\n    &#125;,\n    renderChunk(source) &#123;\n      console.log(&quot;ğŸš€ ~ source:&quot;, source);\n      return null;\n    &#125;,\n    augmentChunkHash(chunk) &#123;\n      console.log(&quot;ğŸ‰ ~ augmentChunkHash:&quot;, chunk);\n    &#125;,\n    generateBundle(options, bundle) &#123;\n      console.log(&quot;ğŸŒˆ ~ options:&quot;, options);\n      console.log(&quot;ğŸŒˆ ~ bundle:&quot;, bundle);\n      Object.keys(bundle).forEach((key) &#x3D;&gt; &#123;\n        if (key.includes(&quot;sum&quot;)) &#123;\n          &#x2F;&#x2F;åˆ é™¤å¯¹è±¡ä¸­çš„è¿™ä¸ªé”®å€¼å¯¹\n          delete bundle[key];\n        &#125;\n      &#125;);\n    &#125;,\n    closeBundle() &#123;\n      console.log(&quot;ğŸ˜ ~ closeBundle&quot;);\n    &#125;,\n  &#125;;\n&#125;</code></pre>\n\n<h4 id=\"æ‰“åŒ…å¤§å°å’Œæ—¶é—´ç¤ºä¾‹ï¼š\"><a href=\"#æ‰“åŒ…å¤§å°å’Œæ—¶é—´ç¤ºä¾‹ï¼š\" class=\"headerlink\" title=\"æ‰“åŒ…å¤§å°å’Œæ—¶é—´ç¤ºä¾‹ï¼š\"></a>æ‰“åŒ…å¤§å°å’Œæ—¶é—´ç¤ºä¾‹ï¼š</h4><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">export default function bundleStats() &#123;\n let startTime;\n return &#123;\n  name: &#39;bundle-stats&#39;,\n  options() &#123;\n   startTime &#x3D; Date.now();\n   &#125;,\n  generateBundle(_, bundle) &#123;\n   const fileSizes &#x3D; &#123;&#125;;\nâ€‹\n   for (const [fileName, output] of Object.entries(bundle)) &#123;\n    if (output.type &#x3D;&#x3D;&#x3D; &#39;chunk&#39;) &#123;\n     const content &#x3D; output.code;\n     const size &#x3D; Buffer.byteLength(content, &#39;utf8&#39;);\n     const sizeInKB &#x3D; (size &#x2F; 1024).toFixed(2);\nâ€‹\n     fileSizes[fileName] &#x3D; &#96;$&#123;sizeInKB&#125; KB&#96;;\n     &#125;\n    &#125;\n   console.log(&#39;Bundle Stats:&#39;);\n   console.log(&#39;-------------&#39;);\n   console.log(&#39;File Sizes:&#39;);\n   console.log(fileSizes);\n   console.log(&#39;-------------&#39;);\n   &#125;,\n  closeBundle() &#123;\n   const totalTime &#x3D; Date.now() - startTime;\n   console.log(&#96;Total Bundle Time: $&#123;totalTime&#125; ms&#96;);\n   console.log(&#39;-------------&#39;);\n   &#125;\n  &#125;;\n&#125;</code></pre>\n\n<h4 id=\"ä»£ç å‹ç¼©\"><a href=\"#ä»£ç å‹ç¼©\" class=\"headerlink\" title=\"ä»£ç å‹ç¼©\"></a>ä»£ç å‹ç¼©</h4><pre class=\"line-numbers language-javascript\" data-language=\"javascript\"><code class=\"language-javascript\">import &#123; minify &#125; from &#39;uglify-js&#39;;\nâ€‹\nexport default function uglifyPlugin() &#123;\n return &#123;\n  name: &#39;uglify&#39;,\nâ€‹\n  renderChunk(code) &#123;\n   const result &#x3D; minify(code);\n   if (result.error) &#123;\n    throw new Error(&#96;minify error: $&#123;result.error&#125;&#96;);\n    &#125;\n   return &#123;\n    code: result.code,\n    map: &#123; mappings: &#39;&#39; &#125;\n    &#125;;\n   &#125;,\n  &#125;;\n&#125;</code></pre>\n","feature":true,"text":"rollupå‰ç«¯å·¥ç¨‹åŒ–å†ç¨‹ é™¤å±‘ä¼˜åŒ–(tree shaking)é™¤äº†å¯ä»¥ä½¿ç”¨ ES æ¨¡å—ä¹‹å¤–ï¼ŒRollup è¿˜å¯ä»¥é™æ€åˆ†æä½ å¯¼å…¥çš„ä»£ç ï¼Œå¹¶å°†æ’é™¤ä»»ä½•å®é™…ä¸Šæ²¡æœ‰ä½¿ç”¨çš„å†…å®¹ï¼Œä»ä¸Šé¢çš„å¼•å…¥å’Œæœ€åçš„æ‰“åŒ…ç»“æœå°±å¯ä»¥çœ‹åˆ°ï¼Œæ²¡æœ‰ä½¿ç”¨åˆ°çš„å†…å®¹ç›´æ¥è¢«åˆ é™¤äº†ã€‚ æ³¨æ„ï¼Œé™¤å±‘ä¼˜åŒ–çš„æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µé€š...","link":"","photos":[],"count_time":{"symbolsCount":"53k","symbolsTime":"48 mins."},"categories":[{"name":"Academic","slug":"Academic","count":2,"path":"api/categories/Academic.json"}],"tags":[{"name":"rollup","slug":"rollup","count":1,"path":"api/tags/rollup.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#rollup\"><span class=\"toc-text\">rollup</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96%E5%8E%86%E7%A8%8B\"><span class=\"toc-text\">å‰ç«¯å·¥ç¨‹åŒ–å†ç¨‹</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%99%A4%E5%B1%91%E4%BC%98%E5%8C%96-tree-shaking\"><span class=\"toc-text\">é™¤å±‘ä¼˜åŒ–(tree shaking)</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%8E-webpack-%E6%89%93%E5%8C%85%E7%9A%84%E5%8C%BA%E5%88%AB\"><span class=\"toc-text\">ä¸ webpack æ‰“åŒ…çš„åŒºåˆ«</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">é…ç½®æ–‡ä»¶</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">å¸¸ç”¨é…ç½®</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A4%9A%E4%BA%A7%E7%89%A9%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">å¤šäº§ç‰©é…ç½®</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A4%9A%E5%85%A5%E5%8F%A3%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">å¤šå…¥å£é…ç½®</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8A%A8%E6%80%81%E5%AF%BC%E5%85%A5%E4%B8%8E%E9%BB%98%E8%AE%A4%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2\"><span class=\"toc-text\">åŠ¨æ€å¯¼å…¥ä¸é»˜è®¤ä»£ç åˆ†å‰²</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8%E6%8F%92%E4%BB%B6\"><span class=\"toc-text\">ä½¿ç”¨æ’ä»¶</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#rollup-x2F-plugin-node-resolve\"><span class=\"toc-text\">@rollup&#x2F;plugin-node-resolve</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#output-manualChunks\"><span class=\"toc-text\">output.manualChunks</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#rollup-x2F-plugin-commonjs\"><span class=\"toc-text\">@rollup&#x2F;plugin-commonjs</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#rollup-x2F-plugin-babel\"><span class=\"toc-text\">@rollup&#x2F;plugin-babel</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%A2%98%E5%A4%96%E8%AF%9D%EF%BC%9A-babel-x2F-runtime\"><span class=\"toc-text\">é¢˜å¤–è¯ï¼š@babel&#x2F;runtime</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#rollup-x2F-plugin-typescript\"><span class=\"toc-text\">@rollup&#x2F;plugin-typescript</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%9E%84%E5%BB%BA-react-%E5%BA%94%E7%94%A8\"><span class=\"toc-text\">æ„å»º react åº”ç”¨</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#node-modules\"><span class=\"toc-text\">node_modules</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#tsconfig-json\"><span class=\"toc-text\">tsconfig.json</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#babelrc-json\"><span class=\"toc-text\">.babelrc.json</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#rollup-config-ts\"><span class=\"toc-text\">rollup.config.ts</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#npm-%E5%8F%91%E5%8C%85\"><span class=\"toc-text\">npm å‘åŒ…</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#npm-%E5%8F%91%E5%B8%83\"><span class=\"toc-text\">npm å‘å¸ƒ</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#node-modules-1\"><span class=\"toc-text\">node_modules</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#tsconfig-json-%E6%96%87%E4%BB%B6\"><span class=\"toc-text\">tsconfig.json æ–‡ä»¶</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9C%AC%E5%9C%B0%E8%B0%83%E8%AF%95-link-%E5%AE%89%E8%A3%85\"><span class=\"toc-text\">æœ¬åœ°è°ƒè¯• link å®‰è£…</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%91%E5%B8%83%E5%88%B0-npm\"><span class=\"toc-text\">å‘å¸ƒåˆ° npm</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#JavaScript-API\"><span class=\"toc-text\">JavaScript API</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%A4%E5%A4%A7%E6%9E%84%E5%BB%BA%E5%B7%A5%E4%BD%9C%E6%B5%81\"><span class=\"toc-text\">ä¸¤å¤§æ„å»ºå·¥ä½œæµ</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1%E3%80%81build\"><span class=\"toc-text\">1ã€build</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2%E3%80%81output\"><span class=\"toc-text\">2ã€output</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%8F%92%E4%BB%B6%E6%9C%BA%E5%88%B6\"><span class=\"toc-text\">æ’ä»¶æœºåˆ¶</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Rollup-%E6%8F%92%E4%BB%B6%E6%A6%82%E8%BF%B0\"><span class=\"toc-text\">Rollup æ’ä»¶æ¦‚è¿°</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%BA%A6%E5%AE%9A\"><span class=\"toc-text\">çº¦å®š</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%B1%9E%E6%80%A7\"><span class=\"toc-text\">å±æ€§</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0%E7%9A%84%E7%89%B9%E7%82%B9\"><span class=\"toc-text\">é’©å­å‡½æ•°çš„ç‰¹ç‚¹</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0%E7%9A%84%E8%B0%83%E7%94%A8%E6%97%B6%E6%9C%BA\"><span class=\"toc-text\">é’©å­å‡½æ•°çš„è°ƒç”¨æ—¶æœº</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0%E7%9A%84%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8F\"><span class=\"toc-text\">é’©å­å‡½æ•°çš„æ‰§è¡Œæ–¹å¼</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0%E4%B9%9F%E5%8F%AF%E4%BB%A5%E6%98%AF%E5%AF%B9%E8%B1%A1\"><span class=\"toc-text\">é’©å­å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9E%84%E5%BB%BA%E9%92%A9%E5%AD%90%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F\"><span class=\"toc-text\">æ„å»ºé’©å­æ‰§è¡Œé¡ºåº</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E8%B0%83%E7%94%A8%E8%99%9A%E6%8B%9F%E6%A8%A1%E5%9D%97%E6%8F%92%E4%BB%B6%E7%A4%BA%E4%BE%8B\"><span class=\"toc-text\">è°ƒç”¨è™šæ‹Ÿæ¨¡å—æ’ä»¶ç¤ºä¾‹</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#JSON-%E6%8F%92%E4%BB%B6%E7%A4%BA%E4%BE%8B\"><span class=\"toc-text\">JSON æ’ä»¶ç¤ºä¾‹</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%8F%92%E4%BB%B6%E4%B8%8A%E4%B8%8B%E6%96%87\"><span class=\"toc-text\">æ’ä»¶ä¸Šä¸‹æ–‡</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%9B%BE%E7%89%87%E8%AF%BB%E5%8F%96\"><span class=\"toc-text\">å›¾ç‰‡è¯»å–</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BE%93%E5%87%BA%E9%92%A9%E5%AD%90%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F\"><span class=\"toc-text\">è¾“å‡ºé’©å­æ‰§è¡Œé¡ºåº</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%89%93%E5%8C%85%E5%A4%A7%E5%B0%8F%E5%92%8C%E6%97%B6%E9%97%B4%E7%A4%BA%E4%BE%8B%EF%BC%9A\"><span class=\"toc-text\">æ‰“åŒ…å¤§å°å’Œæ—¶é—´ç¤ºä¾‹ï¼š</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E4%BB%A3%E7%A0%81%E5%8E%8B%E7%BC%A9\"><span class=\"toc-text\">ä»£ç å‹ç¼©</span></a></li></ol></li></ol></li></ol></li></ol>","author":{"name":"X-29","slug":"blog-author","avatar":"https://i.postimg.cc/3Rd6NTPm/X.png","link":"/","description":"Welcome to this blog! Here will tell you everything about X-29.","socials":{"github":"https://github.com/X29w","twitter":"","stackoverflow":"https://stackoverflow.com/users/20511900/x29","wechat":"","qq":"","weibo":"https://weibo.com/u/7801588846","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{"title":"React-Principle","uid":"6f35d21607cc4ac40e0305fd85e2df31","slug":"React-Principle","date":"2024-11-23T16:50:47.000Z","updated":"2024-11-30T04:09:53.429Z","comments":true,"path":"api/articles/React-Principle.json","keywords":null,"cover":null,"text":"React-Principleæ­¤æ–‡ç« æ—¨åœ¨äºå‰–æ React çš„ä¸€äº›åŸºæœ¬åŸç†ï¼Œå¸®åŠ©è¯»è€…æ›´å¥½åœ°ç†è§£ React çš„å·¥ä½œåŸç†ã€‚å¹¶å†™å‡ºå±äºè‡ªå·±çš„ React ä»£ç ã€‚ å‰ç½®ä»»åŠ¡æ­å»ºç›®å½•ä»¥åŠé…ç½®ä¸€äº›å·¥å…·First of allï¼ â”œâ”€â”€ packages| â”œâ”€â”€ react| | â”œâ”€â”€ ...","link":"","photos":[],"count_time":{"symbolsCount":"26k","symbolsTime":"24 mins."},"categories":[{"name":"React","slug":"React","count":1,"path":"api/categories/React.json"}],"tags":[{"name":"React","slug":"React","count":2,"path":"api/tags/React.json"}],"author":{"name":"X-29","slug":"blog-author","avatar":"https://i.postimg.cc/3Rd6NTPm/X.png","link":"/","description":"Welcome to this blog! Here will tell you everything about X-29.","socials":{"github":"https://github.com/X29w","twitter":"","stackoverflow":"https://stackoverflow.com/users/20511900/x29","wechat":"","qq":"","weibo":"https://weibo.com/u/7801588846","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}